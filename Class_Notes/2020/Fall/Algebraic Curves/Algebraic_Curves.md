
# Lecture 1

## Field Theory

See Chapter 11 of Field Theory notes.

### Notion 1

:::{.definition title="Finitely Generated Field Extension"}
A field extension $\ell/k$ is *finitely generated* if there exists a finite set $x_1, \cdots, x_n \in \ell$ such that $\ell = k(x_1, \cdots, x_n)$ and $\ell$ is the smallest field extension of $k$.

Concretely, every element of $\ell$ is a quotient of the form ${p(x_1, \cdots, x_n) \over q(x_1, \cdots, x_n)}$ with $p, q\in k[x_1, \cdots, x_n]$.
:::

There are three different notions of finite generation for fields, the above is the weakest.

### Notion 2

The second is being finitely generated as an algebra:

:::{.definition title="Finitely Generated Algebras"}
For $R\subset S$ finitely generated algebras, $S$ is finitely generated over $R$ if every element of $S$ is a polynomial in $x_1, \cdots, x_n$, with coefficients in $R$, i.e. $S = R[x_1, \cdots, x_n]$.
:::

Note that this implies the previous definition, since anything that is a polynomial is also a quotient of polynomials.

### Notion 3

The final notion: $\ell/k$ is finite (finite degree) if $\ell$ is finitely generated as a $k\dash$module, i.e. a finite-dimensional $k\dash$vector space.


:::{.definition title="Rational Function Field"}
A *rational function field* is $k(t_1, \cdots, t_n) \da ff \qty{ k[t_1, \cdots, t_n]}$.
:::

Note that we can make a similar definition for infinitely many generators by taking a direct limit (here: union), and in fact every element will only involve finitely many generators.

:::{.exercise}
\hfill
a. Show $k(t) / k$ is finitely generated by notion (3) but not by (2).

b. Show that $k[t]/k$ is (2) but not (1).

  > Note $k[t]$ is not a field.

c. Show that it is not possible for a **field** extension to satisfy (2) but not (1).
  
  > Hint: Zariski's lemma.

d. Show that if $\ell/k$ is finitely generated by (3) and algebraic, then it satisfies (1).
:::


:::{.theorem title="Field Theory Notes 11.19"}
If $L/K/F$ are field extensions, then $L/F$ is finitely generated $\iff$ $K/F$ and $L/K$ are finitely generated.
:::

> See Artin-Tate Lemma, this doesn't necessarily hold for general rings.

:::{.definition title="Algebraically Independent"}
For $\ell/k$, a subset $\ts{x_i}\subset \ell$ is *algebraically independent* over $k$ if no finite subset satisfies a nonzero polynomial with $k$ coefficients.

In this case, $k[\ts{x_i}] / k$ is *purely transcendental* as a rational function field.
:::

:::{.theorem title="?"}
For $\ell/k$ a field extension,

a. There exists a subset $\ts{x_i}\subset \ell$ algebraically independent over $k$ such that $\ell/k(\ts{x_i})$ is algebraic. 

b. If $\ts{y_t}$ is another set of algebraically independent elements such that $\ell/k(\ts{y_t})$ is algebraic, then $\abs{\ts{x_i}} = \abs{\ts{y_t}}$.
:::

Thus every field extension is algebraic over a purely transcendental extension.
A subset as above is called a *transcendence basis*, and every 2 such bases have the same cardinality.

We have a notion of generation (similar to "spanning"), independence, and bases, so there are analogies to linear algebra (e.g. every vector space has a basis, any two have the same cardinality).
There is a common generalization: matroids.

:::{.definition title="Transcendence Degree"}
The *transcendence degree* of $\ell/k$ is the cardinality of any transcendence basis.

> Analogy: dimension in linear algebra.
:::

:::{.theorem title="Transcendence Degree is Additive in Towers"}
If $L/K/F$ are fields then $\trdeg(L/F) = \trdeg(K/F) + \trdeg(L/K)$.
:::

:::{.theorem title="Bounds on Transcendence Degree"}
Let $K/k$ be finitely degenerated, so $K = k(x_1, \cdots, x_n)$.
Then $\trdeg(K/k) \leq n$, with equality iff $K/k$ is purely transcendental.
:::

:::{.proof}
Suppose $K$ is monogenic, i.e. generated by one element. Then $\trdeg(F(x)/F) = \indic{x/F\text{ is transcendental}}$.

So the degree increases when a transcendental element is added, and doesn't change when $x$ is algebraic.

By additivity in towers, we take $k \injects k(x_1) \injects k(x_1, x_2) \injects \cdots \injects k(x_1, \cdots, x)n) = K$ to obtain a chain of length $n$. 
The transcendence degree is thus the number of indices $i$ such that $x_i$ is transcendental over $k(x_1, \cdots, x_{i-1})$.

> Similar to checking if a vector is in the span of a collection of previous vectors.

:::

:::{.definition title="Function Fields"}
For $d\in\ZZ^{\geq 0}$, an extension $K/k$ is *a function field in $d$ variables* (i.e. of dimension $d$) if $K/k$ is finitely generated of transcendence degree $d$.
:::

The study of such fields is birational geometry over the ground field $k$.
$k=\CC$ is of modern interest, things get more difficult in other fields.

The case of $d=1$ is much easier: the function field will itself be the geometric object and everything will built from that.

Main tool: valuation theory, which will correspond to points on the curve.

## Case Study: The Luroth Problem.

For which fields $k$ and $d\in \ZZ^{\geq 0}$ is it true that if $k \subset \ell \subset k(t_1, \cdots, t_d)$ with $k(t_1 ,\cdots, t_d)/\ell$ finite then $\ell$ is purely transcendental?


:::{.theorem title="Luroth"}
True for $d=1$: For any $k\subset \ell \subset k(t)$, $\ell = k(x)$.
:::

:::{.theorem title="Castelnuovo"}
Also true for $d=2, k=\CC$.
:::

:::{.theorem title="Zariski"}
No if $d= 2$, $k=\bar k$, and $k$ is positive characteristic.
Also no if $d=2, k\neq \bar k$ in characteristic zero.
:::

:::{.theorem title="Clemens-Griffiths"}
No if $d\geq 3$ and $k= \CC$.
:::

> Unirational need not imply rational for varieties.

:::{.exercise}
Let $k$ be a field, $G$ a finite group with $G\injects S_n$ the Cayley embedding.
Then $S_n$ acts by permutation of variables on $k(t_1, \cdots, t_n)$, thus so does $G$.
Set $\ell \da k(t_1, \cdots, t_n)^G$ the fixed field, then by Artin's observation in Galois theory: if you have a finite field acting effectively by automorphisms on a field then taking the fixed field yields a galois extension with automorphism group $G$.

So $\aut(k(t_1, \cdots, t_n)/ \ell) = G$.A

a. Suppose $k=\QQ$, and show that an affirmative answer to the Luroth problem implies an affirmative answer to the inverse galois problem for $\QQ$.

  > Hint: works for any field for which Hilbert's Irreducibility Theorem holds.

b. $\ell /\QQ$ need not be a rational function field, explore the literature on this: first example due to Swan with $\abs{G} = 47$.

c. Can still give many positive examples using the Shepherd-Todd Theorem.
:::

\todo[inline]{What's a global field?}

## Onto Business

:::{.definition title="?"}
For $K/k$ a field extension, set $\kappa(K)$ to be the algebraic closure of $k$ in $K$, i.e. special case of *integral closure*.
If $K/k$ is finitely generated, then $\kappa(K)/k$ is finite degree.

Here $\kappa(k)$ is called the *field of constants*, and $K$ is also a function field over $\kappa(k)$.
:::

In practice, we don't want $\kappa(k)$ to be a proper extension of $k$. 

If this isn't the case, we replace considering $K/k$ by $K/\kappa(k)$.
If $K/k$ is finitely generated, then

\begin{center}
\begin{tikzcd}
k \arrow[rr, "\text{finite}", hook] &  & \kappa(k) \arrow[rr, "\text{finitely generated}", hook] &  & K
\end{tikzcd}
\end{center}

Where we use the fact that from above, $\kappa(k)/k$ is finitely generated and algebraic and thus finite, and by a previous theorem, if $K/k$ is transcendental then $K/\kappa(k)$ is as well, and thus finitely generated.
Thus if you have a function field over $k$, you can replace $k$ by $\kappa(k)$ and regard $K$ as a function field over $\kappa(k)$ instead.





## Lecture 1, A Review

Review of lecture one:

:::{.theorem title="Finitely Generated in Towers"}
See video
:::

- Transcendence bases
- LÃ¼roth problem















# Lecture 1: Discussion

For $K/k$ a one variable function field, if we want a curve $C/k$, what are the points?
We'll use *valuations*, see NT 2.1.

See also completions, residue fields.

If $R \subset K$ a field, $R$ is a *valuation ring* of $K$ if for all $x\in K\units$, at least one of $x, x^{-1} \in R$.

:::{.example}
The valuation rings of $\QQ$ are $\ZZ_{(p)}\da \ZZ[\ts{{1\over \ell} \st \ell\neq p}]$ for all primes $p$.
:::

See also Krull valuation, takes values in some totally ordered commutative group.

:::{.exercise}
Show that a valuation ring is a local ring, i.e. it has a unique maximal ideal.
:::

:::{.example}
Where does the log come from?

There is a $p\dash$adic valuation:
\[  
v: \QQ &\to \ZZ_{(p)} \\
{a\over b} = p^n {u \over v} &\mapsto n
.\]
 
Then we recover
\[  
\ZZ_{(p)} = \ts {x\in \QQ\units \st v_p(x) \geq 0} \union \ts{0} \\
\mfm_{(p)} = \ts {x\in \QQ\units \st v_p(x) > 0} \union \ts{0} \\
.\]

There is a $p\dash$adic norm
\[  
\abs{\wait}_p: \QQ &\to \RR \\
0 & \mapsto 0 \\
x &\mapsto p^{-n} = p^{-v_p(x)}
.\]

Then we get an ultrametric function, a non-archimedean function
\[  
d_p: \QQ^2 \to \RR \\
(x, y) &\mapsto \abs{x- y}_p
.\]

We then recover $v_p(x) = -\log_p \abs{x}_p$.

See NT 1 notes.
:::

For $A\subset K$ a subring of a field, we'll be interested in the place $\tilde \Sigma = \ts{\text{Valuation rings } R_v \text{ of } K} \st A \subset R_v \subsetneq K$.
Thus the valuation takes non-negative values on all elements of $K$.
Can equip this with a topology (the "Zariski" topology, not the usual one).
This is always quasicompact, and called the *Zariski-Riemann space*.
Can determine a sheaf of rings to make this a locally ringed space.

We can define an equivalence of valuations and define the set of *places* 
\[  
\Sigma(K/k) \da \ts{\text{Nontrivial valuations } v\in K \st v(x) \geq 0\, \forall x\in k\units}
,\]
which will be the points on the curve.
Here the Zariski topology will be the cofinite topology (which is not Hausdorff).
Scheme-theoretically, this is exactly the set of closed points on the curve.

:::{.definition title="?"}
Generic point: closure is entire space.
:::

> Note we will have unique models for curves, but this won't be the case for surfaces: blowing up a point will yield a birational but inequivalent surface.

From this we can also define *divisor group* as the free $\ZZ\dash$module on $\Sigma(K/k)$, which comes with a degree map
\[  
\deg: \Div(K) \to \ZZ
\]
which need not be surjective.

We can consider principle divisors with the map
\[  
K\units &\to \Div(K) \\
f &\mapsto (f)
.\]

We can define the class group as divisors modulo principle divisors $\cl(K) = \Div(K) / \im(K\units)$ and the Riemann-Roch space $\mathcal{L}(D)$.
The Riemann-Roch theorem will then be a statement about $\dim \mathcal{L}(D)$.




# Lecture 2

## Base Extension

Given some object $A/k$ and $k\injects \ell$ is a field extension, we would like some extended object $A/\ell$.

:::{.example}
An *affine variety* $V/k$ is given by finitely many polynomials in $p_i \in k[t_1, \cdots, t_n]$, and base extension comes from the map $k[t_1, \cdots, t_n] \injects \ell[t_1, \cdots, t_n]$.

More algebraically, we have the affine coordinate ring over $k$ given by $k[V] = k[t_1,\cdots, t_n]/\gens{p_i}$, the ring of polynomial functions on the zero locus corresponding to this variety.
We can similarly replace $k$ be $\ell$ in this definition.
Here we can observe that $\ell[V] \cong k[V] \tensor_k \ell$.

:::

In general we have a map
\[  
\wait \tensor_k \ell & \\
\ts{k\dash\text{vector spaces}} &\to \ts{\ell\dash\text{vector spaces}} \\
\ts{k\dash\text{algebras}} &\to\ts{\ell\dash\text{algebras}}
.\]

Note that this will be an exact functor on the category $k\dash\text{Vect}$, i.e. $\ell$ is a flat module.
Here everything is free, and free $\implies$ flat, so things work out nicely.

What about for function fields?

Since $k$ is a $k\dash$algebra, we can consider $k\tensor_k \ell$, however this need not be a field.

> Note: tensor products of fields come up very often, but don't seem to be explicitly covered in classes!
  We'll broach this subject here.

:::{.exercise}
If $\ell/k$ is algebraic and $\ell\tensor_k \ell$ is a domain, the $\ell = k$.

> I.e. this is rarely a domain.
> Hint: start with the monogenic case, and also reduce to the case where the extension is not just algebraic but finite.

:::

Tensor products of field extensions are still interesting: if $\ell/k$ is finite, it is galois $\iff$ $\ell \tensor_k \ell \cong \ell^{[\ell: k]}$.
So its dimension as an $\ell\dash$algebra is equal to the degree of $\ell/k$, so it splits as a product of copies of $\ell$.

:::{.remark}
We'd like the tensor product of a field to be a field, or at least a domain where we can take the fraction field and get a field.
This hints that we should not be tensoring algebraic extensions, but rather transcendental ones.
:::

:::{.exercise}
For $\ell/k$ a field extension,

a. Show $k(t) \tensor_k \ell$ is a domain with fraction field $\ell(t)$.

b. Show it is a field $\iff$ $\ell/k$ is algebraic.

:::

:::{.proposition title="FT 12.7, 12.8"}
Let $k_1, k_2 / k$ are field extensions, and suppose $k_1 \tensor_k k_2$ is a domain.
Then this is a field $\iff$ at least one of $k_1/k$ or $k_2/k$ is algebraic.
:::

> Reminder: for $\ell/k$ and $\alpha\in \ell$ algebraic over $k$, then $k(\alpha) = k[\alpha]$.

So we'll concentrate on when $K \tensor_k \ell$ is a domain.
What's the condition on a function field $K/k$ that guarantees this, i.e. when extending scalars from $k$ to $\ell$ still yields a domain?
If this remains a domain, we'll take the fraction field and call it the *base change*.

:::{.exercise}
If $K/k$ is finitely generated (i.e. a function field) and $K\tensor_k \ell$ is a domain, then $ff(K\tensor_k \ell)/\ell$ is finitely generated.

> The point: if taking a function field and extending scalars still results in a domain, we'll call the result a function field as well.
:::

Most of all, we want to base change to the algebraic closure.
We'll have issues if the constant field is not just $k$ itself:

:::{.lemma}
If $K\tensor_k \bar k$ is a domain, then the constant field $\kappa(k) = k$.

:::

:::{.proof}
Use the fact that $\wait \tensor_k V$ is exact.
We then get an injection
\begin{center}
\begin{tikzcd}
\kappa(k) \tensor_k \kappa(k) \ar[rr, hookrightarrow]\ar[rd, hookrightarrow] & &
K \tensor_k \bar k \\
& \kappa(k) \tensor_k \bar k\ar[ru, hookrightarrow] & 
\end{tikzcd} 
\end{center}
Here we use the injections $\kappa(k) \injects \bar k$ and $\kappa(k) \injects K$.

We now have an injection of $k\dash$algebras, and subrings of domains are domains. 
So apply the first exercise: the only way this can happen is if $\kappa(k) = k$.
:::


:::{.exercise}
The simplest possible case: describe $\CC(t) \tensor_\RR \CC$, tensored as $\RR\dash$algebras.

> Won't be a domain by the lemma, some $\CC(t)\dash$algebra of dimension 2.
:::

In order to have a good base change for our function fields, we want to constant extension to be trivial, i.e. $\kappa(k) = k$. 
This requires that the ground field be algebraically closed.

In this case, you might expect that extending scalars to the algebraic closure would yield a field again.
This is true in characteristic zero, but false in positive characteristic.

A more precise question: if $\kappa(k) = k$, must $K\tensor_K \bar k$ be a field?
If that's true and we're in positive characteristic, recalling the for an algebraic extension this being a field is equivalent to it being a domain. 
But if that's a domain, the tensor product of every algebraic extension must be a domain, which is why this is an important case.

If so, then $K\tensor_k k^{1\over p}$ is a field, where $k^{1\over p} \da k(\ts{x^{1\over p} \st x\in k })$ is obtained by adjoining all $p$th roots of all elements.
This is a purely inseparable extension.
The latter condition (this tensor product being a field) is one of several equivalent conditions for a field to be separable.

> Note that frobenius maps $k^{1\over p} \surjects k$, so this is sort of like inverting this map.

Remember that $K/k$ is transcendental, and there is an extended notion of separability for non-algebraic extensions.
Another equivalent condition is that every finitely generated subextension is separably generated, i.e. it admits a transcendence basis $\ts{x_i}$ such that $k\injects k(\ts{x_i}) \injects F$ where $F/k(\ts{x_i})$ is algebraic and separable.
Such a transcendence basis is called a *separating transcendence basis*.
Since we're only looking at finitely generated extensions, we wont' have to worry much about the difference between separable and separably generated.

What's the point? 
There's an extra technical condition to ensure the base change is a field: the function field being separable over the ground field.

Is this necessarily the case if $\kappa(k) = k$? 
No, for a technical reason:

:::{.warnings}
This is pretty technical, yo.
:::

:::{.example}
\label{technical_example} 
Set $k = \FF_p(a, b)$ a rational function field in two variables sa the ground field.
Set 
\[  
A \da k[x, y]/ \gens{ax^p + b-y^b}
.\]
Then $A$ is a domain, so set $k = ff(A)$.

Claim: $\kappa(k) = k$, so $k$ is algebraically closed in this extension, but $K/k$ is *not* separable.
How to show: extending scalars to $k^{1\over p}$ does not yield a domain.

Let $\alpha, \beta \in \bar k$ such that $\alpha^p = a, \beta^b = b$, so
\[  
ax^p + b-y^b = (\alpha x + \beta - y)^p
,\]
which implies $K \tensor_k  k^{1\over p}$ is not a domain: $k[x, y]$ is a UFD, so the quotient of a polynomial is a domain iff the polynomial is irreducible.
However, the $p$th power map is a homomorphism, and this exhibits the image of the defining polynomial as something non-irreducible.
:::

Note that $f(x, y) = ax^p + b - y^p$ is the curve in this situation.
The one variable function field is defined by quotienting out a function in two variables and taking the function field.
Every 1-variable function field can be obtained in this way.
Therefore this polynomial is irreducible, but becomes reducible over the algebraic closure.
So we'd like the polynomial to be irreducible over both.

:::{.remark}
This is pretty technical, but we won't have to worry if $k = k^{1\over p}$. 
Equivalently, frobenius is surjective on $k$, i.e. $k$ is a perfect field.

If $k$ is not perfect, it can happen (famous paper of Tate) making an inseparable base extension can decrease the genus of the curve.
:::

Reminder: the perfect fields:

- Anything characteristic zero, every reducible polynomial is separable.
- Any algebraically closed field 
- Finite fields (frobenius is always injective)

Imperfect fields include:

- Function fields in characteristic $p$
- Complete discretely valued fields $k((t))$ in characteristic $p$

\todo[inline]{Look up uniformizing elements and valuations.}

:::{.theorem title="FT 12.20"}
For field extensions $K/k$, TFAE

1. $\kappa(k) = k$ and $K/k$ is separable

2. $K\tensor_k \bar k$ is a domain, or equivalently a field

3. For all field extensions $\ell/k$, $K\tensor_k \ell$ is a domain.

> Allows making not just an algebraic base change, but a totally arbitrary one.
:::

A field extension satisfying these conditions is called **regular**.

> Regular corresponds to nonsingularity in this neck of the woods.

:::{.remark}
The implication $2\implies 3$ is the interesting one.
To prove it, reduces to showing that if $k= \bar k$ and $R_i$ are domains that are finitely generated as $k\dash$algebras, then $R_1 \tensor_k R_2$ is also a domain.

This doesn't always happen, e.g. $\QQ(\sqrt{2}) \tensor_\QQ \QQ(\sqrt{2})$ is not a domain.
Really need algebraically closed.

This is a result in affine algebraic geometry.
An algebra that is a domain and finitely generated over a field is an *affine algebraic variety*, more precisely it is integral.
The tensor product on the coordinate ring side corresponds to taking the product of varieties.

Thus the fact here is that a product of integral varieties remains integral, as long as you're over an algebraically closed field.
Proof uses Hilbert's Nullstellensatz.
:::


:::{.exercise}
\hfill

a. Show that $k(t) / k$ is regular.

  > I.e. $k(t)\tensor_k \bar k$ is a domain.

b. Show every purely transcendental extension is regular.

c. Show that for a field $k$, every extension is regular $\iff$ $k = \bar k$.

d. Show $K/k$ is regular $\iff$ every finitely generated subextension is regular.
:::

## Example of a Non-Regular Family of Function Fields

Choose an elliptic curve $E/\QQ(t)$ with $j\dash$invariant $t$.
For $N\in \ZZ^{+}$, define $\tilde K_N \da \QQ(t)(E[N])$ the $N\dash$torsion field of $E$.

Then $\tilde K_N/\QQ(t)$ is a finite galois extension with galois group isomorphic to the image of the modular galois representation 
\[  
\rho_N: g(\QQ(t)) \to \GL(2, \ZZ/N\ZZ) \mod N
.\]

> See Cornell-Silverman-Stevens covering the proof of FLT, modular curves from the function field perspective.

:::{.proposition title="Some Facts"}
$\rho_N$ is surjective, and 
\[  
\Aut(\tilde K_N / \QQ(t))  \cong \GL(2, \ZZ/N\ZZ)
.\]

$\det \rho_N = \chi_N \mod N$, the cyclotomic character, and therefore $\chi_N$ restricted to $g(\tilde K_N)$ is trivial, so $\tilde K_N \supset \QQ(\zeta_N)$.
For $N\geq 3$, $\QQ(\zeta_N) \supsetneq \QQ$, so $\tilde K_N / \QQ(t)$ is a non-regular function field.
:::

Actually $\tilde K_N$ depends on the choice of $E$: difference choices of nonisomorphic curves with the same $j\dash$invariant differ by a quadratic twist and the $\rho_N$ differ by a quadratic character on $g(\QQ(t))$.
Importantly, this changes the kernel, and thus the field.

To fix this, we look at the *reduced galois representation*, the following composition:
\[  
\bar \rho_N: g(\QQ(t)) \to \GL(2, \ZZ/N\ZZ) \surjects \GL(2, \ZZ/N\ZZ)/\ts{\pm I}
.\]

We obtain a field theory diagram
\begin{center}
\begin{tikzcd}
\ar[dd, bend right, "{\GL(2, \ZZ/N\ZZ)}"'] \bar K_N \ar[d, bend left, "\ts{\pm I}"] &\\
K_N \ar[d, bend left, "{\GL(2, \ZZ/N\ZZ)/\ts{\pm I}}"] &\\
\QQ(t)&
\end{tikzcd}
\end{center}

So if you just take the field fixed by $\pm I$, you get $K_N$.
In this case, the reduced galois representation depends only on the $j\dash$invariant, and not on the model chosen.
So the function field $K_N/\QQ(t)$ is the "canonical" choice.

Question:
Does this make $K_N/\QQ(t)$ regular?

Answer:
No, $\rho_N(g(K_N)) = \ts{\pm I}$ and $\det(\pm I) = 1$, so we still have $K_N \supset \QQ(\zeta_N)$.

In this course, we'll identify algebraic curves over $k$ and one-variable function fields $K/k$.
The function field $K_N$ corresponds to an algebraic curve $X(N)/\QQ$ that is "nicer" over $\QQ(\zeta_N)$.
In fact, see Rohrlich: $\kappa(K_N) = \QQ(\zeta_N)$.

Our curves will have points (equal to valuations) which will have degrees. 
If the constant subfield is not just $k$, this prevents degree 1 points on the curve.

By Galois theory, for every subgroup $H \subseteq \GL(2, \ZZ/N\ZZ) / \ts{\pm I}$, we'll get a function field $\QQ(H) \da H_N^H$.
In this case, $\QQ(H)/\QQ$ is regular $\iff$ $\det(H) = (\ZZ/N\ZZ)\units$.

Later we'll understand the residues at points as the residue fields of some DVRs, then the residue field will always contain the field of constants.








# Lecture 3

Last of preliminaries.
Upcoming: one-variable function fields and their valuation rings.


## Polynomials Defining Regular Function Fields
Where's the curve: $f(x, y) = 0$.

:::{.exercise}
Let $R_1, R_2$ be $k\dash$algebras that are also domains with fraction fields $K_i$.
Show $R_1 \tensor_k R_2$ is a domain $\iff$ $K_1 \tensor_k K_2$ is a domain.[^hint_for_exc1]

[^hint_for_exc1]: Hint: use a denominator clearing argument.

:::

:::{.definition title="Geometrically Irreducible"}
A polynomial of positive degree $f\in k[t_1, \cdots, t_n]$ is **geometrically irreducible** if $f\in \bar k[t_1, \cdots, t_n]$ is irreducible as a polynomial.
:::

If $n=1$ then $f$ is geometrically irreducible $\iff$ it's linear, i.e. of degree 1.
Let $f$ be irreducible, then since polynomial rings are UFDs then $\gens{f}$ is a prime ideal (irreducibles generate principal ideals) and $k[t_1, \cdots, t_n]/\gens{f}$ is a domain.
Let $K_f$ be the fraction field.

:::{.exercise title="an easy one"}
\envlist
a. Above for $1\leq i \leq n$ let $x_i$ be the image of $t_i$ in $K_f$.
  Show that $K_f = k(x_1, \cdots, x_n)$.

b. Show that if $K/k$ is generated by $x_1, \cdots, x_n$, then it is the fraction field of $k[t_1, \cdots, t_n] /\mfp$ for some prime ideal $\mfp$ (equivalently, a height 1 ideal).
:::

:::{.proposition title="?"}
Suppose that $f$ is geometrically irreducible.

a. The function field $K/k$ is regular.

b. For all $\ell/k$, $f\in \ell[t_1, \cdots, t_n]$ is irreducible.

:::

In this case we say $f$ is *absolutely irreducible* as a synonym for geometrically irreducible.

:::{.proof}
By definition of geometric irreducibility, $\bar k[t_1, \cdots, t_n]/\gens{f} = k[t_1, \cdots, t_n]/\gens{f} \tensor_k \bar k$ is a domain.
The exercise shows that $K_f \tensor_k k$ is a domain, so $K_f$ is regular.
It follows that for all $\ell/k$, $K_f \tensor_k \ell$ is a domain, so $\ell[t_1, \cdots, t_n]/\gens{f}$ is a domain.
:::

Moral: geometrically irreducible polynomials are good sources of regular function fields.

:::{.exercise}
Let $k$ be a field, $d\in \ZZ^+$ such that $4\notdivides d$ and $p(x) \in k[x]$ be positive degree.
Factor $p(x) = \prod_{i=1}^r (x-a_i)^{\ell_i}$ in $\bar k[x]$.

a. Suppose that for some $i$, $d\notdivides \ell_i$. 
  Show that $f(x, y) \da y^d - p(x) \in k[x, y]$ is geometrically irreducible.
  Conclude that $K_f \da ff\qty{k[x, y] / \gens{y^d - p(x)}}$ is a regular one-variable function field over $k$, and thus elliptic curves yield regular function fields.[^hint_and_comment_on_exercise]

b. What happens when $4\divides d$?

[^hint_and_comment_on_exercise]: 
Referred to as *hyperelliptic* or *superelliptic* function fields.
Hint: use FT 9.21 or Lang's Algebra.

:::


:::{.exercise title="Nice, Recommended"}
Assume $k$ is a field, if necessary assuming $\ch(k) \neq 2$.

a. Let $f(x, y) = x^2 - y^2 -1$ and show $K_f$ is is rational: $K_f = k(z)$.

b. Let $f(x, y) = x^2 + y^2 - 1$.
  Show that $K_f$ is again rational.

c. Let $k = \CC$ and $f(x, y) = x^2 + y^2 + 1$, $K_f$ is rational.

d. Let $k= \RR$.
  For $f(x ,y) = x^2 + y^2 + 1$, is $K_f$ rational?[^example_genus_zero]

[^example_genus_zero]: 
This is an example of a non-rational genus zero function field.

:::

:::{.question}
Can we always construct regular function fields using geometrically irreducible polynomials?
:::

:::{.answer}
In several variables, no, since not every variety is birational to a hypersurface.
In one variable, yes, as the following theorem shows:
:::


:::{.theorem title="Regular Function Fields in One Variable are Geometrically Irreducible"}
Let $K/k$ be a one variable function field (finitely generated, transcendence degree one). 
Then

a. If $K/k$ is separable, then $K = k(x, y)$ for some $x, y\in K$.

b. If $K/k$ is regular (separable + constant subfield is $k$, so stronger) then $K \cong K_f$ for a geometrically irreducible $f\in k[x ,y]$.
:::

Recall separable implies there exists a separating transcendence basis.

:::{.proof title="of a"}
This means there exists a primitive element $x\in K$ such that $K/k(x)$ is finite and separable.
By the Primitive Element Corollary (FT 7.2), there exist a $y\in K$ such that $K = k(x, y)$.
:::

:::{.proof title="of b"}
Omitted for now, slightly technical.

:::

Importance of last result: a regular function field on one variable corresponds to a nice geometrically irreducible polynomial $f$.

:::{.remark}
Note: the plane curve module may not be smooth, and in fact usually is not possible.
I.e. $k[x ,y]/\gens{f}$ is a one-dimensional noetherian domain, which need not be integrally closed.
:::

:::{.question}
Can every one variable function field be 2-generated?
:::

:::{.answer}
Yes, as long as the ground field is perfect.
In positive characteristic, the suspicion is no: there exists finite inseparable extensions $\ell/k$ that need arbitrarily many generators.
However, what if $K/k$ has constant field $k$ but is not separable?
Riemann-Roch may have something to say about this.
:::


:::{.example}
\hyperref[technical_example]{Example from earlier lecture:}
\[
ax^p + b - y^b
\]
:::


:::{.remark}
We can find examples of nice function fields by taking irreducible polynomials in two variables.
This will define a one-variable function field.
If the polynomial is geometrical reducible, this produces regular function fields.
:::

Next:
One variable function fields and their valuations.





# Lecture 4 

## One Variable Function Fields (Ch. 1)

Since we have the field-theoretic preliminaries out of the way, we now start studying one-variable function fields in earnest.
The main technique that we use to extract the geometry will be the theory of valuations.
These may be familiar from NTII, but we will cover them in more generality here.

### Valuation Rings and Krull Valuations

Recall that NTII approach to valuations:

:::{.definition title="Valuation"}
A **valuation** on a field $K$ is a map $v:K\to \RR\union \ts\infty$ such that $v(K\units) \subset \RR$, $v(0) = \infty$, and $v$ is of the form $-\log(\abs{\wait})$ where $\abs{\wait}: K \to [0, \infty)$ is an *ultrametric norm*.[^efficient_valuation]
Recall that an *ultrametric norm* satisfies not only the triangle inequality but the ultrametric triangle inequality, i.e. $d(x, z) \leq \max(x, z)$.

[^efficient_valuation]: In other words, $e^{-v(\wait)}$ is an ultrametric norm.

:::

We now take an algebraic approach to this definition, where we'll end up replacing $\RR$ with something more general.

:::{.definition title="Valuation Ring"}
A subring $R$ of a field $K$ is a **valuation ring** if for all $x\in K\units$, at least one of $x$ or $x^{-1}$ is in $R$.
:::

:::{.remark}
This is a "largeness" property. 
It also implies that $K = \ff(R)$.
:::

:::{.definition title="Group of Divisibility"}
Given any integral domain $R$ with fraction field $K$, the **group of divisibility** $G(R)$ is defined as the *partially ordered commutative group*[^compatibility_note]

\[  
G(R) \da K\units / R\units
.\]
We will write the group law here additively.
The ordering is given by $x\leq y \iff y/x \in R$.

[^compatibility_note]: This means that the two structures are compatible.

:::

:::{.remark}
Note that the way the partial order is written, it's a relation on $K\units$, but it is not quite a partial ordering there.
It is reflexive and transitive, but need not be antireflexive: if $x/y, y/x\in R$ then $x,y$ differ by an element of $u\in R\units$ so that $x=uy$.
In particular, they need not be equal.
This gives a structure of a *quasiordering*, and if you set $x\sim y \iff x\leq y$ and $y\leq x$, this leads to an equivalence relation, and modding out by it yields a partial order.
Here this is accomplished by essentially trivializing units.
\

Another way to think of $G(R)$ is as the nonzero principal fractional ideals of $K$, since any two generators of an ideal will differ by a unit.
:::

:::{.remark}
Inside this group there is a *positive cone* $G(R)^+$ of elements that are "nonnegative": since we're in a commutative setting, the zero element is equal to 1, and the positive cone is given by $\ts{y\geq 0} = \ts{y\in R}$, and is thus given by the group $G(R)^+ = (R, \cdot)$.
\

This is very general: if you're studying factorization in integral domains, many properties are reflected in $G(R)$.
E.g. being a UFD (the most important factorization property!) implies that $G(R)$ is a free commutative group.
:::

:::{.remark}

In general this is only a *partially* ordered group and not totally ordered. 
For example, take $R = \ZZ$ and $x=2, y=3$, then neither of $2/3, 3/2$ are in $\ZZ$, so $x\not\leq y$ and $y\not\leq x$.
On the other hand, if we do have a total order, then either $x$ or $x^{-1}$ is in the ring, which are exactly valuation subring of a field.
:::

:::{.claim}
$R$ is a valuation ring $\iff$ $G(R)$ is totally ordered.
:::

:::{.remark}
Note that $\RR$ is a totally ordered group.
:::

This makes $G(R)$ the "target group" of a generalized analytic valuation.
Whenever we have a valuation ring, we have a totally ordered commutative group, and the valuation $v: K\units \to G(R)$ is a quotient map which we can extend to $K$ by $v(0) \da \infty$.
This has some familiar properties:

- (VRK1) For all $x,y\in K\units$,[^just_a_group_hopmp]

\[  
v(xy) = v(x) + v(y)
.\]

- (VRK2) For all $x,y \in K\units$ such that $x+y\neq 0$,
\[  
v(x+y) \geq \min(v(x), v(y))
.\]



[^just_a_group_hopmp]: This follows from the fact that the quotient map is a group morphism.
Note that the additive notation makes this more suggestive of what an original valuation satisfied.

For ultrametric norms, all triangles are isosceles: is that true for this type of function?
The answer is yes, by the following exercise: 

:::{.exercise title="?"}
If $v(x) \neq v(y)$, then $v(x+y) = \min(v(x), v(y))$.
:::

So the properties here are formally identical to the NTII notion of valuation, with $(\RR, +, \leq)$ replaced by $(G(R), +, \leq)$.

:::{.exercise title="?"}
Conversely, if $v: K\units \to G$ is a map into a totally ordered commutative group satisfying VRK1 and VRK2[^krull_valuation], then
\[  
R_v \da \ts {x\in K\units \st v(x) \geq 0} \union \ts{0}
\]
is a valuation ring.[^exc_hint_num1]
We can thus extract valuation rings in this situation.

[^krull_valuation]: Any such map satisfying these two properties is a **Krull valuation**, Krull's generalization of classical valuations.

[^exc_hint_num1]: Note that in a totally ordered group, either $v(x) \geq 0$ or $-v(x) \geq 0$, so we get the property that either $x, x^{-1} \in R_v$.

:::


:::{.exercise title="?"}
A valuation ring is **local**, i.e. there is a unique maximal ideal
\[  
\mathfrak{m}_v \da \ts{x\in K\units \st v(x) > 0} \union \ts{0}
.\]
:::

:::{.remark}
These two constructions are morally mutually inverse.
This doesn't hold on the nose, since there is extraneous data in the new analytic valuation.
Recall that in NTII we have a notion of equivalence of norms, and two distinct norms that are equivalent can give rise to the same valuation.
For example, given a valuation, one can scale it by $\alpha \in \RR$, and it's easy to check that this gives the same valuation.
It is possible for the valuation not to surject onto $\RR$, but this doesn't happen in practice.
The image is usually infinite cyclic, what we call a *discrete valuation*, and so one is led to the definition of the *value group* of the valuation as its image.
If you have a notion of equivalence of Krull valuations, you want to allow for isomorphisms of the value group.
The cleanest notion of equivalence is thus the following:
:::

:::{.definition title="Equivalence of Krull valuations"}
Two Krull valuations on a field $K$ are **equivalent** iff their valuation rings are *equal*.
:::

:::{.remark}
Going back to NTII, if you have two nonarchimedean norms on a field, then there are many equivalent conditions for equivalence, and this is one of them.
:::

Some general valuation theory:

- Every totally ordered commutative group is a group of divisibility.[^tot_ord_comm_div]

- A totally ordered group has **rank 1** if it is nontrivial and embeds into $\RR$
  - If the value group is trivial, $R = K$

- A Krull valuation of rank at most 1 is the NTII notion of a valuation.

[^tot_ord_comm_div]: Pete's Commutative Algebra Notes, Ch. 17.10
 

:::{.exercise title="?"}
For $n\geq 2$, put the lexicographic order on $\ZZ^n$, and show this has rank strictly larger than 1.
Thus $\ZZ^n\injects \RR$ as a commutative group, but not as a totally ordered commutative group.
:::

:::{.remark}
In fact, for any ordered group $G$, one can attach a rank: a cardinal number $r(G)$.
Here, $r((\ZZ^n, \text{lex})) = n$.
This is useful when studying $\spec(R)$ for $R$ a DVR.
:::

A valuation of rank bigger than 1 does not induce a norm on $K$ in the metric sense, although this is not so important.
A closer notion is expanding the notion of a metric space by allowing the metric to be defined on $X$ as $d: X\cross X \to R$ for some $R$ more general than $\RR$, like a totally ordered group or a nonarchimedean field.
This would yield a class of topological spaces that are reminiscent of metric spaces.

:::{.definition title="Important: Regular and Centered"}
Let $v:K\units \to (G, +)$ be a Krull valuation and let $A \subset K$ be a subring of $K$.
Then $v$ is **$A\dash$regular** or **centered in $A$** if $A$ is a subset of some valuation ring $R_v$.
In this case, $\mathfrak{p} \da \mathfrak{m}_v \intersect A \in \spec(A)$ is denoted the **center of $v$ in $A$**.[^pullback_hom]

[^pullback_hom]: 
Here $\mathfrak{m}_v$ denotes pulling back the maximal ideal along this morphism of rings.

:::

:::{.remark}
The term regularity here arises because we'll want to think of elements of $A$ as functions and the valuation as a type of point, then the notion of being a regular function at a point will carry over.
The center is the subset of $A$ with strictly positive valuation.
Also recall that pulling back prime ideals yields prime ideals, and maximal ideals are a special kind of prime ideal, but in general pulling back a maximal ideal may not result in another maximal ideal.
So somehow the valuation affects every subring on which it is regular.
:::

:::{.definition title="Key: Zariski-Riemann Space"}
For $A \subset K$, define
\[  
\Sigma(K/A) &\da \ts{\text{valuation rings } A \subset R \subsetneq K \st K = \ff(R)} \\
\tilde \Sigma(K/A) &\da \ts{\text{valuation rings } A \subset R \subseteq K \st K = \ff(R)}
.\]
The set $\tilde \Sigma(K/A)$ is the **Zariski-Riemann space**.
:::

:::{.remark}
Note that in this definition, we're taking all $A\dash$regular valuation rings $R$ in $K$.
If someone says $R$ is a valuation ring of $K$, they likely mean that $K = \ff(R)$.
Note that fields are valuation rings, so otherwise, any subfield of $K$ would also be a valuation ring of $K$.
Here, $K$ itself plays the role of a generic point. (?)
The only difference in these two definitions is that in the first, the trivial valuation ring is being excluded.
:::

:::{.definition title="Key: Places, Points of a Curve"}
If $K/k$ is a one variable function field[^def_function_field_reminder]
, then $\Sigma(K/k)$ will be the **points of the associated algebraic curve** or **places**.
These can be thought of as valuation rings, or equivalence classes of Krull valuations, where two valuations are equivalent if they have the same valuation ring.

[^def_function_field_reminder]: Finitely generated field extension of transcendence degree one.

:::

:::{.remark}
In terms of scheme theory, these will be the closed points of our algebraic curve.
We will view elements $f\in K$ as meromorphic functions on $\Sigma(K/k)$.
:::

:::{.definition title="Zariski Topology"}
The **Zariski topology** on $\Sigma(K/A)$ has a sub-base
\[  
\ts{U(f) \st f\in K } && U(f) \da \ts{v\in \tilde \Sigma(K/A) \st v(f) \geq 0} = \tilde \Sigma(K/ A[f])
.\]
and we thus take the minimal topology such that all of these sets are open.
In other words, every open set is a finite intersection and/or arbitrary unions, including empty intersections/unions.
The last term is precisely the subring generated by $A$ and $f$.
Thus a base is $U(f_1, \cdots, f_n) = \tilde \Sigma(K / A[f_1, \cdots, f_n])$.
The Zariski topology on $\Sigma(K/A)$ is defined the same way and/or via the subspace topology, since this removes a single point.
:::

:::{.remark}
We thus get the subrings of $K$ that contain $A$ and are finitely generated as $A\dash$algebras.
We'll be specifically looking at the case where $A$ is a field and $K$ is a one variable function field.
:::

:::{.theorem title="Zariski"}
$\tilde \Sigma(K/A)$ is quasi-compact.
:::

:::{.proof title="?"}
See Mazamara (?) in the chapter discussing valuation rings.
:::

Note that by definition, $v_n \not\in \Sigma(K/A)$.
In $\tilde \Sigma(K/A)$, we have a trivial valuation $v_n$ whose value group is trivial and valuation ring is $K$ itself, and $v_n$ is a generic point of $\Sigma(K/A)$: its closure is the entire space.
In other words, it is in every nonempty open subset.
Since we have at least one generic point, and in general there may be many, if $\abs{\tilde\Sigma(K/A) > 1}$ then this is not a separated ($T_1$) space since the point is not closed.[^French_note_separated]
Another example of such a space would be $\spec(R)$ for $R$ a commutative ring with positive Krull dimension, which will be Kolmogorov ($T_0$) but not separated.
Such a spectrum is the underlying topological space of some affine scheme, and in general, schemes will have these kinds of properties that are bad (but not *too* bad).

[^French_note_separated]: Note that in French, separated may be interpreted as Hausdorff, but here we mean points are closed or equivalently any two distinct points admit open neighborhoods that do not meet the other point.

In our case of interest, when $K/k$ is finitely generated of transcendence degree one, we'll see that this is the cofinite topology on an infinite space: the proper closed subsets are precisely the finite subsets, or equivalently every nonempty open subset has finite complement.
This is far from Hausdorff: the intersection of two open subsets will still have finite complement, so any two nonempty open subsets must intersect.
\

It's not generally true that just removing the generic point $v_n$ will make the space separated, but in our case, it will be.
So if we restrict to nontrivial valuation rings, then the underlying set will be infinite and we'll get the cofinite topology.
This will be the coarsest separated topology, i.e. if you want singletons to be closed, finite subsets must be closed.
If $k \subset A \subset K$ where $A$ is a Dedekind domain with fraction field $K$, we will see that if we consider not the $k\dash$regular elements but the $A\dash$regular ones, we'll get $\Sigma(K/A) = \maxspec(A)$ and both Zariski topologies are cofinite.
Note that in a Dedekind domain, trading in a prime spectrum for a max spectrum is removing a generic point, so this matches up.
The moral: the topology of $\Sigma(K/k)$ is not doing anything interesting and we won't need it much.

When $K/k$ instead has transcendence degree *bigger* than 1, then $\tilde \Sigma(K/k)$ is much more interesting.
If we were doing things scheme-theoretically, we could try to define a structure sheaf: attaching a sheaf whose stalks are local commutative rings to make it a locally ringed space.[^Schemes_in_rings_spaces]
Here, the choice of a ring is straightforward: literally $\tilde \Sigma(A, A[f_1, \cdots, f_n])$.
There's an exercise that shows that although defining a sheaf on the entire space is somewhat annoying, defining it on a basis suffices.

:::{.exercise title="?"}
Endow $\tilde \Sigma(K/k)$ with the structure of a locally ringed space.
:::

:::{.remark}
In dimension 1 (the case we're studying), the corresponding Zariski-Riemann space will be the scheme associated to the complete nonsingular model of the curve.
So this valuation-theoretic approach will take you from the function field back to a nice model of the scheme itself.
But note that in larger dimensions, there is no unique complete nonsingular model -- for example, you can blow any one up to get another -- so this pattern can't possibly continue to hold.
In fact, it's not clear if we even know if there's *one* such model!
:::

[^Schemes_in_rings_spaces]: Schemes are a full subcategory of the much larger category of locally ringed spaces.


:::{.remark}
Thus in dimension $>1$, you get something that is decidedly not a scheme, but is still relevant to the study of resolution of singularities for your function field.
Where do these come up?
Zariski used $\Sigma(K/A)$ to prove resolution of singularities [^resolution_of_singularities]
in characteristic zero and dimensions 2 and 3 in 1944, although dimension 2 was classical by the Italian school.
Later, Hironaka (1984) got the Fields medal for proving resolution of singularities for all dimensions in characteristic zero using an ingenious inductive argument that avoided Zariski-Riemann spaces entirely.
It remarkably doesn't use any new objects/tools, just uses existing ones in a clever way.
So why talk about Zariski-Riemann spaces at all?
In the last 10 years or so, work of Ternkin and Conrad has revived and generalized them.
They study *relative* such spaces.

[^resolution_of_singularities]: Resolving means given $K/k$, we want to find a complete nonsingular affine variety whose function field is $K$.

:::

:::{.problem title="Open"}
In positive characteristic, resolution of singularities is only known up to dimension $\leq 3$.
:::

The following is an extremely important result from commutative algebra:

:::{.theorem title="CA 17.17"}
Let $A \subset K$ be a subring of a field, then 
\[  
\intersect_{v\in \tilde \Sigma(K/A)} R_v
,\]
the intersection of all valuation subrings of the field, is the integral closure of $A$ in $K$.
:::

The proof is mostly a Zorn's lemma type of argument.
Note that each $R_v$ is generally big, contains $A$, and $\ff(R_v) = K$.
Moreover, each valuation ring is integrally closed, although we haven't proved this yet.

:::{.corollary title="?"}
For $K/k$  function field, $\intersect_{v\in \Sigma(K/k)} R_v = \kappa(K)$, the constant subfield of $K$.
:::


:::{.proof title="?"}
Note that $\kappa(K)$ is the integral (algebraic) closure of $k$ in $K$.
Applying the theorem directly almost works, except the theorem involves $\tilde \Sigma$.
Can we remove the tilde?
Suppose not, this can only happen if $\Sigma(K/k) = \emptyset$ and the intersection is just $K$ itself, the largest thing in the intersection.
But can the integral closure of $k$ in $K$ be $K$ itself?
No, since the transcendence degree of the function field is positive.
So $K/k$ is transcendental, while $\kappa(K) / k$ is an algebraic extension, a contradiction.
:::

:::{.remark}
Note that $\Sigma(K/k)$ is nonempty: there is a nontrivial valuation ring between $k$ and $K$ in great generality, and there are often many.
:::


:::{.claim title="Key"}
If $\trdeg(K/k) = 1$, then every $v\in \Sigma(K/k)$ is discrete and thus has value group isomorphic to $\ZZ$.
:::

So despite the fact that we've introduced a more general notion of higher rank valuations, in dimension 1, every single valuation is discrete.


:::{.proof title="?"}
Let $v\in \Sigma(K/k)$ be a place, so its a valuation ring with fraction field $K$ that is not $K$, then $R_v$ is not a field.
So its maximal ideal $\mathfrak{m}_v$ is nonzero, so choose a nonzero element $t\in \mathfrak{m}_v$.
Then $t \in R_v$ and $R_v$ contains $k$, so $k[t] \subset R_v$.
Note that $k[t]$ is a PID sitting inside a valuation ring.
So restrict this maximal ideal down: $\mathfrak{m}_v \intersect k[t]$ is a prime ideal of $k[t]$ containing $t$, and thus the center $\mathfrak{m}_v \intersect k[t] = \gens{t}$.
This follows because a prime ideal in the polynomial ring $k[t]$ which contains $t$ is necessarily generated by $t$, since there's exactly one such ideal.
\

Now restricting the valuation on $K$ to $k(t) \subset K$, $K / k(t)$ will be a finite extension (from the first lecture).
We know $k(t) \subset K$, and we can now check that $\ro{v}{k(t)}$ is the $t\dash$adic valuation $v_t$.
Note that $\mathfrak{m}_v$ can not contain any other monic irreducible polynomials, since distinct such polynomials are coprime. 
Since we're in a PID, this ideal would contain any linear combination of them and thus contain 1.
So consider the map
\[  
k[t] \injects R_b \to G(R_v) = K\units / R\units
.\]
Note that the units of $k[t]$ map trivially, using the fact that any element in $k[t]$ can be written as $u \prod p_i^{a_i}$ with the $p_i$ monic irreducible polynomials. 
The unit maps to zero, along with all of the other monic irreducibles, and thus the image is determined entirely by the image of powers of $t$.
This whole term goes to zero unless some $p_i\mapsto t$, in which case it maps to some power of $t$.
\

So suppose $t\mapsto \gamma \neq 0\in G(R)$, which is nonzero because $t$ was not a unit (since it was in the maximal ideal).
Then the image is exactly $\gamma^\NN$, the non-negative integer powers of the image of $t$.
But if we know goes on this domain, taking denominators shows where it goes on the fraction field (of a UFD), so the image is the cyclic group generated by $\gamma$, i.e. the powers of $t$ are literally the only valuations we get.
So the image of $k(t)\units$ in $G(R_v)$ is $\gamma^\ZZ$, yielding a discrete valuation.
This proves that the restriction to the rational function field $k(t)$ is discrete, and we want to use this to deduce that the original valuation is discrete.
\

We can now use NTII:[^petes_notes_note] since $K/k(t)$ is finite, it follows that $v$ is discrete iff $\ro{v}{k(t)}$ is discrete, and thus $v$ is discrete.

[^petes_notes_note]: See NTII, Corollary 1.60: a valuation on a field whose restriction to a finite index subfield is discrete is itself discrete.

:::

So every place of $K/k$ is a discrete valuation as long as the transcendence degree is one, but this is far from the case for degree $\geq 2$!
In the following example, we'll have a rational function field, which makes things easier. 
You need a theory of extending Krull valuations, since we'll define a non-rank 1 valuation on the rational function field.
But an arbitrary finitely generated field extension of degree $d$ over $k$ is a finite degree extension of the rational function field, and valuation theory will tell you that every valuation downstairs can be extended in full generality to a finite degree field extension, and the rank will not change.

:::{.exercise title="?"}
If $K/k$ is finitely generated of $\trdeg \geq 2$, then $\Sigma(K/k)$ has valuations of rank $d$.
:::

Note that the Zariski-Riemann space only consists of discrete valuations, which is a characteristic property of one variable function fields.
So these higher rank valuations may look weird, but when studying a function field of higher transcendence degree (e.g. for an algebraic surface), these occur.

:::{.exercise title="Constructing valuations of arbitrary rank and value group"}
Let $k$ be a field and $K = k(t_1, \cdots, t_n)$.
Set $G = \ZZ^n$ with the lex order, so $G^{\geq 0} = \NN^n$.

- Show that $k[t_1, \cdots, t_n] = k[G^{\geq 0}]$, where the RHS is the associated semigroup ring.

- Define $v: k[G^{\geq 0}]\nonzero \to G^{\geq 0}$ by mapping each polynomial the minimal index of a monomial in its support.
  For example,
  \[  
  v(a_1 t_1^3 t_2 + a_2 t_1^2 t_2^{10})  = (2, 10)
  ,\]
  which has support $(3, 1)$ and $(2, 10)$, and we take the min in the lex order.

- Extend $v$ to $v: K\nonzero \surjects G$ satisfying VRK1 and VRK2.
  Show that $R_v \da v^{-1}(G^{\geq 0}) \union\ts{0}$ is a valuation ring with value group $G$, and in particular, the rank is $n$.

:::

Note that doing this for $n=1$ reduces to the $t\dash$adic valuation, which just keeps track of the smallest power of $t$ appearing.
Here you can extend to fraction fields by defining $v(x/y) = v(x) - v(y)$.
The semigroup ring can't *be* the valuation ring, since polynomial rings are not local rings, so it's much bigger.
Note also that $\ZZ$ can be replaced with any group $G$, since it's never used in anything but a psychological fashion.

:::{.slogan}
There is a huge difference between $\trdeg = 1$ and $\trdeg > 1$, and so we'll only be working with the former case in this course.
:::

# Monday, November 23

# Lecture 11A: Weil's Proof of Riemann-Roch


Let $K_{/k}$ be a one variable function field, finitely generated of transcendence degree one, with $\kappa(K) = k$, so $k$ is algebraically closed in $K$.
Define the *small Adele ring* associated to $K$, as the restricted direction product with respect to $\ts{R_v \st v\in \Sigma(K/k)}$:

\[
A_k \da \prod^{\text{res}}_{v\in \Sigma(K/k)} K
= \ts{(x_v) \in K^{\Sigma(K/k)} \st x_v \in R_v \text{ for a.e. } v }
,\]
where each factor is a copy of $K$.
Note that a *restricted* direct product is when you have a family of sets, and for each set you also attach a subset.
Then if you have a tuple in the entire direct product, it's in the restricted direct product iff for all but finitely many coordinates lie in a given subset. Here the subset is the valuation ring $R_v$.
So these are tuples of elements of $K$, indexed by places, where each element has a $p\dash$adic valuation and the only restriction is that (except for finitely many cases) we want this valuation to be nonnegative.


:::{.remark}
To get the *big* Adele ring, you'd replace $K$ with its completion with respect to the $p\dash$adic valuation.
If $k$ is finite, then this is equal to the positive characteristic Adele ring from NTII. 
If you complete, then you get a complete discretely valued field whose residue field equals the residue field at the place $v$.
So for finite extensions of $k$, the residue will be finite iff $k$ is finite, and from the structure theory of discretely valued fields, this field has a natural topology: the adic topology, coming from the inverse limit.
This will be locally compact iff the residue field is finite.
Here, since the ground field is infinite, even passing to the completion wouldn't yield anything locally compact.
So there's no advantage to passing to the completion, although there's no harm either.
:::

Note that $A_k$ is a ring, and in fact a $K\dash$algebra, but we will only need its structure as a $K\dash$vector space.
This structure comes from embedding $K\injects A_k$ diagonally, so $x \mapsto [x, x, \cdots]$, and pull back $v\in \Sigma(K/k)$, remembering that every element of $K$ (a rational function) is regular except for finitely many $v$.

If we have a valuation on $K$, we can consider a place $p$ and projecting onto the $k$th factor:
\[  
A_j \surjectsvia{\pi_p} K \mapsvia{v_p} \ZZ \union \ts{\infty}
.\]

So we now attach an adelic version of the Riemann-Roch space: for $D\in \Div K$, we set
\[  
\mathcal{A}_k(D) \da \ts{ \alpha \in \mathcal{A}_K \st v_p(\alpha) \geq -v_p(D) \, \forall p \in \Sigma(K/k)}
.\]
The only difference here is that the usual space is over $K$, and here we're over $\mathcal{A}_K$, which is a much larger space.
This makes things easier, however, in the same sense that studying a large collection of local fields is easier than studying the corresponding global field.
Note that the $p\dash$adic valuation $v_p$ is just the coefficient of $p$ in the divisor, and $\mathcal{A}_K \intersect K$ yields the usual Riemann-Roch space.

:::{.exercise title="?"}
\envlist

a. Show that $\mathcal{A}_K(D)$ is an $k\dash$subspace of $\mathcal{A}_K$.[^exc_hint_1]


b. Show that (just as for the Riemann-Roch space) $D_1 \leq D_2 \implies \mathcal{A}_K(D_1) \subseteq \mathcal{A}_K(D_2)$.


[^exc_hint_1]: Consider scaling by nonzero constants, where the valuation of constants are zero.

:::

:::{.lemma title="?"}
\[  
D_1 \leq D_2 \implies \dim_k \mathcal{A}_K(D_2) / \mathcal{A}_K(D_1) = \deg D_2 - \deg D_1
.\]
:::

Note that this is the adelic analogue of our first lemma on Riemann-Roch spaces, now with an equality instead of being bounded above.


:::{.proof title="?"}
As we did before, by induction we can assume $D_2 = D_1 + p$ for some $p\in \Sigma(K/k)$, i.e. we can go from the smaller divisor to the bigger one by repeatedly adding closed points.
Then choose an element $t\in k\units$ such that $v_p(t) = v_p(D_2)$, and define a similar map
\[  
\phi \mathcal{A}_K(D_2) &\to k_p \\
\alpha &\mapsto (t\alpha p) \mod \mfm_p
.\]
Why? 
Once you multiply by $t$, note that we're looking in the $p$th component.
The condition before was that the valuation at the $p$th component was at least $-v_p(D_2)$, but now we're adding $v_p(D_2)$.
This yields a nonnegative valuation, making the image lie inside the corresponding local ring, so it makes sense to consider it modulo the maximal ideal to get an element of the residue field.
As before, it should be clear that this is $k\dash$linear, $\ker \phi = \mathcal{A}_K(D_1)$, and is surjective.
The kernel are exactly those elements such that multiplying by $t$ makes the $p\dash$adic valuation at least 1, since that's what the maximal ideal is.
This is indeed $\mathcal{A}_K(D_1)$, since $D_1$ and $D_2$ are the same except for the added condition $D_2 = D_1 + p$ at $p$.
\

So the main difference is that the map is now *surjective*, which was not true for the original Riemann-Roch space.
Why?
This is a purely local situation.
Take an element which is zero away from the $p$ component, which is easy to do since zero is in $R_v$ for any $v$.
So can you find an element of $k$ such that multiplying by $t$ and reducing modulo the maximal ideal yields every element of the residue field?
:::

:::{.theorem title="2.13"}
For all $D$,
\[  
\dim_k \mathcal{A}_K / \qty{\mathcal{A}_K(D) + K } = \iota(D) \da \ell(D) - \deg(D) + g - 1
,\]
where $\iota(D)$ is the index of speciality of the divisor, which measures the discrepancy between the degree and the dimension.
:::

:::{.remark}
This says that adding $K$ into the adelic Riemann-Roch space results in a big $k\dash$vector space, having high dimension in the infinite dimensional $k\dash$vector space $\mathcal{A}_K$.
:::


:::{.proof title="Step 1"}
For divisors $A_1 \leq A_2$, we have a short exact sequence of $k\dash$vector spaces
\[  
0 \to \mathcal{L}(A_2) / \mathcal{L}(A_1) \mapsvia{\sigma_1} \mathcal{A}_K(A_2) / \mathcal{A}_K(A_1) \mapsvia{\sigma_2} \qty{\mathcal{A}_K(A_2) + K} / \qty{\mathcal{A}_K(A_1) + K } \to 0
.\]
The first thing we did was compute the dimension of the middle quotient space, which was $\deg D_2 - \deg D_1$.
Note that $\sigma_2$ is a quotient map, but $\sigma_1$ just comes from embedding $K\injects \mathcal{A}_K$.
To show exactness, the only nontrivial part is that $\ker(\sigma_2) \subset \im(\sigma_1)$.
So take an element $\alpha\in \mathcal{A}_K(A_1) \mod \mathcal{A}_K(A_1)$ such that $\sigma_2(\alpha) = 0$, so there exists an $x\in K$ such that $\alpha-x \in \mathcal{A}_K(A_1)$ by definition of being zero in the last quotient.
Since $\mathcal{A}_K(A_1) \subseteq \mathcal{A}_K(A_2)$, we have that $x\in \mathcal{A}_K(A_2) \intersect K \da \mathcal{L}(A_2)$.
This follows because $\alpha, \alpha-x$ are both in $\mathcal{A}_K(A_2)$.
Thus we have
\[  
\alpha + \mathcal{A}_K(A_1) = x + \mathcal{A}_K(A_1) = \sigma\qty{x + \alpha(A_1)}
.\]
:::

:::{.proof title="Step 2"}
We can now compute the dimension of this quotient.
Using step 1 and Lemma 2.12, we get
\[  
\dim_k\qty{ \mathcal{A}_K(A_2) + K } / \qty{ \mathcal{A}_K(A_1) + K }
&= \dim_k \mathcal{A}_K(A_2) / \mathcal{A}_K(A_1) - \dim_k \mathcal{L}(A_2) / \mathcal{L}(A_1) \\
&= \qty{\deg A_1 - \ell(A_2) } - \qty{\deg A_1 - \ell(A_1) } \\
&= \iota(A_1) - \iota(A_2)
,\]
where the last step follows from adding and subtracting $g-1$.
:::

:::{.proof title="Step 3"}
By step 2, it is enough to show that for all $A_1 \in \Div K$, there exists a bigger divisor $A_2 \geq A_1$ such that $\iota(A_2) = 0$ (by just adding closed points) and $\mathcal{A}_K(A_2) + K = \mathcal{A}_K$.
By Riemann's inequality, we have $\iota(A_2) =0$ if $\deg A_2 \gg 0$, so choose such an $A_2 \geq A_1$.
Thus we're reduced to showing that if $\iota(B)  = 0$ for all $B\in \Div K$, then $\mathcal{A}_K = \mathcal{A}_K(B) + K$.
We'll do this by choosing another large effective divisor.[^cone_structure]

Let $B_1 \geq B$, then we have
\[  
\ell(B_1) 
&\leq \deg(B_1) + \ell(B) - \deg(B) \\
&= \deg(B_1) - g + 1
.\]
Also, Riemann's inequality gives $\ell(B_1) \geq \deg(B_1) - g + 1$, so we have equality.
Thus any divisor greater than or equal to a non-special divisor is again non-special.
\

We want to take an arbitrary element of the Adele ring and show that it differs from an element of the adelic Riemann-Roch space associated to $B$ by an element of $K$, so we'll cleverly choose a divisor in order to do this.
So take an arbitrary element $\alpha\in \mathcal{A}_K$ of the Adele ring, then we may choose $B_1 \geq B$ such that $\alpha\in \mathcal{A}_K(B_1)$.
I.e., choosing $B_1$ large enough is allowing the poles to be however bad you want them to be, and $\alpha$ is a fixed element, all but finitely many elements have valuation $\geq 0$.

We understand the relative situation well, based on what we proved.
By step 2, since $B, B_1$ are non-special, the dimension of the quotient is zero:
\[  
\dim_k(\mathcal{A}_K(B_1) + K) / (\mathcal{A}_K(B) + K) 
&= \deg \qty{B_1 - \ell(B_1)} - \qty{\deg B - \ell(B) } \\
&= (g-1) - (g-1) \\
&= 0
.\]
But then these spaces are equal to each other, so $\mathcal{A}_K(B_1) + K = \mathcal{A}_K + K$.
But we chose $B_1$ arbitrarily large so it contained $\alpha$, and we found that the resulting space is no bigger than the original.
Note that $B_1$ was chosen so that $\alpha\in \mathcal{A}_K(B_1)$ before adding $K$, which remains true when adding $K$.
But this says $\alpha$ is in the LHS, which equals the RHS.
Then $\alpha \in \mathcal{A}_K(B)$, where $\alpha$ was arbitrary, so $\alpha\in \mathcal{A}_K(B) + K$.

[^cone_structure]: This "cone structure" on divisors is very useful!

:::

:::{.corollary title="2.14"}
This can be applied to the zero divisor:
\[  
\dim_k \mathcal{A}_K( \mathcal{A}_K(0) + K ) \iota(0) = g
.\]
:::

:::{.exercise title="?"}
Corollary 2.14 shows that if $K = k(t)$ is the rational function field, then we have $\mathcal{A}_K(0) + K = \mathcal{A}_K$.[^Adele_comment]
Show this directly.

[^Adele_comment]: So every Adele differs from a rational function by an effective Adele.

:::

:::{.remark}
Note that analogy to consider $\mathcal{A}(\QQ)$, where you get $\mathcal{A}_\QQ = \hat \ZZ + \QQ$, where $\hat \ZZ$ denotes the profinite completion.
Recall that $\AA_\QQ = \prod_p' \QQ_p \cross \RR$, and inside of this we have $\AA(0) \da \prod_p \ZZ_p \cross \RR$.
Not too crazy of a fact: given an Adele, it has finitely many places where its $p\dash$adic valuation is negative, so it shouldn't be hard to find a rational number as a correction term which doesn't change the valuation.
The fact that this works for $\QQ$ is related to $\ZZ$ being a PID.
:::

# Lecture 11B: Weil's Proof of Riemann-Roch

# Lecture 11C: Weil's Proof of Riemann-Roch

# Lecture 12 (Chapter 3: Curves Over a Finite Field)

We consider $k= \FF_q$ a finite field, which by definition is a one variable global function field.
Idea: we've defined some affine dedekind domains (the holomorphy rings) had a finite nonempty set of places of the function field.
These are analogous to the ring of integers of a number field, or more generally $S\dash$integer rings.
Recall some basic results from NT1: the finiteness of the class group, and the finite generation of the unit group.
Here we have a class groups of affine Dedekind domain, and by Rosen's theorem, there are infinitely many as you vary over nonempty subsets of places of the function field, and they're all closely connected to a geometric class group: the degree zero divisor class group.
Thus by this analogy, when the field is finite, we'd expect that $\Cl^0(K)$ is finite as well, which is the main result we'll prove today.

## Base Extension

Let $K_{/\FF_q}$ be a one variable function field with constant field $\FF_q$, so that the only elements of $K$ that are algebraic over $\FF_q$ are already in $\FF_q$.
Since $\FF_q$ is a perfect field ($x\mapsto x^p$ is a surjection), every such function field is regular.

Let $\bar{\FF}_q$ be an algebraic closure, then for all $r\in \ZZ^+$ there exists a unique degree $r$ extension, which we'll denote $\FF_{q^r}$.
The extension $\FF_{q^r}/\FF_q$ is a cyclic galois extension (i.e. it's galois group is cyclic) with a canonical generator: the Frobenius map.

The galois theory of the constant field comes in when trying to study constant extensions of the function field.
There is a general theory of constant extensions, but in our case, every such extension will be cyclic or procyclic, so we don't need the entire theory.

For any positive integer $r$, define the extension $K_r \da K \FF_{q^r}$ given by extending scalars, which is a regular function field over $\fqr$.
There are two ways to obtain this: either take an algebraic closure of $K$ and take the compositum, or take $K\tensor_{\fq}\fqr$, which we proved was again a field.
This $K_r$ is what we get by extending constants, and the way regular function fields work is that if you make an arbitrary extension of the ground field, then you retain a regular function field over this new extension.
On the other hand, note that $K_R/K$ is a degree $r$ arithmetic extension of function field, whose galois group is also generated by Frobenius.
If we take any regular function field over $k$ and then take a finite galois extension $l/k$, then extending scalars in this way would give an extension of the upstairs fields which is galois and has the same galois group as the constant extension.
This is *arithmetic* because the only thing that changes going from $K$ to $K_r$ is the field of constants.

In the analogy of function fields as the meromorphic functions on a Riemann surface, this type of extension has no analog: since $\CC$ is algebraically closed, there are no constant extensions.
So arithmetic extensions are just extending scalars, and *geometric* extensions  don't change the constant field at all and instead have the property that if you extended scalars to the algebraic closure, you'd have an extension of the same degree.
Note that the Ã©tale fundamental group also has a similar decomposition into an arithmetic part and a geometric part (see Daniel Litt's course).

### Splitting of Places

:::{.question}
Given a place in $K$, how does it split (or not) in $K_r$?
:::

:::{.remark}
We can ask this question in whenever we have an extension of function fields.
This reduces to the usual ATI type of question: for $v\in \Sigma(K/\fq)$, choose an affine Dedekind domain $R$ such that $v\in \Sigma(K/R)$, i.e. the place is regular.
Let $S$ be the integral closure of $K$ in $K_r$; this place corresponds to a maximal ideal $\mathfrak{p}$, we then want to factor its pushforward $\mathfrak{p}_v S$.
So this question is a special case of how a prime ideal factors in an extension of Dedekind domains.
:::

We'll temporarily black-box the following lemma:

:::{.lemma title="?"}
Suppose $v$ is the downstairs place, $r$ is the degree of the extension, and $d\da \deg(v)$.
Then 

- $K_r/K$ is galois and we have $efg = r$.[^residual_degree_expl]

- This extension will be unramified: we in fact have $e=1$, so $g = \gcd(d, r)$ and $f = r/\gcd(d, r)$, and

- Each place $w\in \Sigma(K_r/\fqr)$ lying over $v$ has degree $d/\gcd(d, r)$.

[^residual_degree_expl]: $e$ is the prime ramification index, $f$ is the prime residual degree, and $g$ is the number of distinct primes. 
This result essentially comes from ANTI, replacing $\sum e_i f_i = r$.

:::

:::{.remark}
Note that having an extension of Dedekind domains coming from a galois extension of fields simplifies things: this makes the inertial degree and ramification indices coincide.
:::

:::{.example title="?"}
\envlist
- The extension is inert $\iff$ $\gcd(d, r) = 1$

  - I.e. $d, r$ are coprime and $g=e=1, f=r$.

- The extension splits completely $\iff$ $r \divides d$.

  - If $r=d$, i.e. we take a degree $d$ place and extend scalars to $K_d$, it splits completely into $d$ degree 1 places.

- All $w\divides v$ have degree 1 $\iff$ $d\divides r$.

:::

:::{.remark}
Suppose we have $w$ over $v$ with $w\in \Sigma(\fqr)$ and $v\in \Sigma(K/\fq)$.
If $v$ has degree $d$, this means that the residue field satisfies $k(v) \cong \FF_{q^{d}}$, since we have unique extensions in each degree.
If $f$ is the $f$ from ANTI, it is also the degree of the residual extension, so we know $[k(w): k(v)] = f$ and thus $k(w) \cong  \FF_q^{f d}$.

On the other hand, $k(w)$ is an extension of $\fqr$ of degree $\deg(w)$, so $k(w) \cong \FF_{ \qty{q^r}^{\deg(w)} } = \FF_{q^{r\deg(w)}}$.
Thus $r=fg$ and
\[  
q^{f\deg(v)} = q^{r\deg(w)} \implies \deg(w) = \qty{f\over r}\deg(v) = { \deg(v) \over g}
.\]

The residue field, if it changes at all, can only increase in size, since any extension of Dedekind domains induces an extension of residue fields.
So the size of the residue field of $w$ is at least as big as the size of the residue field of $v$.
But the degree of $w$ is measured relative to the extended field $\fqr$, since it's the degree of the residue field as an extension of $\fqr$.
So consider $\deg(w) = \deg(v)/g$, we see that even as the residue field is increasing by a factor of $f$, the degree of the point is decreasing by a factor of $g$.

**Upshot**:
The residue field grows, but its degree can only shrink.
Thus making an extension forces the degrees of the upstairs places to *decrease*.
:::

We're trying to find out in how many ways a discrete valuation extends to a finite degree field extension.
From ANTII, we have a result that describes this: if $v$ is a rank 1 valuation on $k$ and $L/K$ is a finite degree extension, then the extensions of $v$ to $L$ correspond with $\mspec(\hat{K}_v \tensor_K L)$, where the hat denotes completing $K$ with respect to the valuation. 
The $e,f,g$ can all be computed as well.[^pete_note_164]

[^pete_note_164]: See Pete's NTII notes, Theorem 1.64.

This is some finite degree $\hat{K}_v$ algebra, and if $L/K$ is separable then this decomposes as a finite product of finite degree field extensions of $K$ and $\hat{K}_v$, the number of which will be $g$.
The $e$ and $f$ can be read off because each extension will have a ramified and unramified part.


:::{.exercise title="?"}
\envlist

a. Show that $\FF_{q^d} \tensor_{\FF_q} \FF_{q^r} \cong  \FF_{q^l}^{d'}$ where $l = \lcm(d, r)$ and $d' = \gcd(d, r)$.

b. Generalize this to the case when $k_p / k$ and $\ell / k$ are both cyclic galois extensions.

:::

## Degree 1 Places and Rational Points on a Curve


Taking the lemma as a black box, for $r\in \ZZ^+$ let $N_r \da \abs{\Sigma_1(K_r/ \fqr) }$, i.e. the number of degree 1 places of the function field after making a degree $r$ extension.
Equivalently, $N_r = \abs{C(\fqr)}$ where $C$ is a unique complete nonsingular curve over $\fq$ corresponding to $K$, and this denotes the number of $\fqr$ rational points.
We'll eventually see these are finite.

:::{.remark}
Important way of thinking about these: degree one places of a function field over $k$ correspond to $k\dash$rational points of a curve.
:::

:::{.corollary title="Equivalence of data: places and rational points"}
\[  
N_r = \sum_{d\divides r} d\cdot \abs{\Sigma_d(K/ \fq)}
,\]
so knowing the number of closed points of each degree is equivalent to knowing the $\fqr\dash$points for all $r$.
:::

:::{.proof title="?"}
Let $w\in \Sigma_1(K_r/\fqr)$ be a degree 1 point and set $v \da w\intersect K$ so $w$ lies over $v$.
What is the degree of $v$?
Setting $d \da \deg(v)$, the lemma gives 
\[  
1 = \deg(w) = {d\over \gcd(d, r)}
,\]
which implies that $\gcd(d, r) = d$ and thus $d\divides r$.
So for each $d$ dividing $r$, every degree of $v\in \Sigma(K/\fq)$ contributes $\gcd(d, r) = d$ degree 1 points on $K_r$, i.e. every downstairs degree $d$ place splits into $d$ degree one places.
So for every such $d$, every degree $d$ closed point contributes $d$ degree 1 closed points lying above it, and conversely if $d$ does not divide $r$ then the upstairs point would not have degree 1, so this accounts for all of the degree 1 points.
:::

:::{.remark}
We saw that the degree 1 places and the rational points are the same information, and there is a third equivalently quantity: $A_n$, defined to be the number of effective divisors of degree $n$.
:::

## Finiteness of Places and Rational Points

:::{.lemma title="?"}
\envlist

a. For all $d$, the number of degree $d$ closed points $\Sigma_d(K/\fq)$ is finite (and therefore $N_r$ is finite), and

b. For all $n$, $A_n$ is finite.
:::

:::{.proof title="of a"}
Let $L/K$ be a degree $n$ extension of regular function fields over $\fq$.
We then have a restriction map
\[  
r: \Sigma(L/\fq) \surjects \Sigma(K/\fq)
\]
which we showed is surjective with finite fibers.
We can say a little bit more: for all places $w \in \Sigma(L/\fq)$, we have an inequality
\[  
\qty{1\over n}\deg(w) \leq \deg(r(w)) \leq \deg(w)
,\]
noting that we're now measuring all degrees over a common ground field $\fq$.
So things are now what you'd expect: the degree of the upstairs point is a multiple of the degree of the downstairs point.
The upper bound comes from the fact that the residue of the upstairs point is a finite extension of the residue field of the downstairs points.
The opposite inequality comes from ANTI: the degree of the residual extension is at most the degree of the entire extension.

So $r$ doesn't preserve degrees exactly, but preserves them up to a bounded factor, and thus $\Sigma_{\leq d}(L/\fq)$ is finite for all $d$ $\iff$ $\Sigma_{\leq d}(K/\fq)$ is finite for all $d$.
Because of this, we can reduce the situation by exchanging the function field $L/\fq$ with any other function field for which $L$ is a finite extension, and in particular we can take the rational function field $K = \FF_q(t)$.
What are the degree $d$ places of a rational function field?
There is exactly one place at infinity, and the remaining ones correspond to monic irreducible polynomials.
Since $\fq$ is finite, there are only finitely many such polynomials of any fixed degree.[^exact_formula]

[^exact_formula]: There is an exact formula for this quantity.

:::

:::{.proof title="of b"}
Left as an exercise.

Some remarks: how do you build an effective divisor of degree $n$?
Take closed points (places) and start adding them up with positive coefficients, then the degree of the divisor is the sum of the degrees of the places.
But if you only have finitely many places, each of which can only be used a bounded number of times (certainly no more than $n$ times!), thus one can only build finitely many effective divisors of each degree.
:::

## Finiteness of Class Group


:::{.proposition title="Finiteness of class group"}
The degree 0 divisor class group $\Cl^0(K)$ is finite.
:::

This is a geometric analog of the finiteness of the class group of the ring of integers of a number field.
By Rosen's theorem, as an immediate corollary, the class group of any affine dedekind domain over a finite ground field is finite.
This follows from looking at the exact sequence: a finite index subgroup of the class group of any dedekind domain is a quotient of $\Cl^0(K)$, and a finite index subgroup of a finite group is finite.

:::{.proof title="?"}
Set $\delta \da I(K)$ to be the index, i.e. the least possible degree of a divisor.[^Shmidt_theorem]

[^Shmidt_theorem]: 
By a theorem of Schmidt, we'll later prove that $\delta = 1$.

In any case, for all $n\in \ZZ$, we have
\[  
\Cl^n K = 
\begin{cases}
0 & \delta\notdivides n \\
\abs{\Cl^0 K} & \delta\divides n
\end{cases}
.\]
If you have any degree $n$ divisors, then $\Cl^n K$ will be a coset of $\Cl^0 K$.
Here we just look at the degree map, which is a group morphism onto its image, of which all nonempty fibers have the same size.
Thus we may work with $\Cl^n K$ for $n\gg 0$.
\

In particular, choose $n\geq g$ the genus such that $\delta \divides n$, and let $D \in \Div^n K$.
A Riemann-Roch computation shows that $\ell(D)$, the dimension of the linear system, is at least $n-g+1$, and so we have $\ell(D) \geq 1$ and $D$ is linearly equivalent to an effective divisor.
This shows that the map taking effective degree $n$ divisors to $\Cl^n K$ taking a divisor to its divisor class (restricted to effective divisors) is surjective.
But we just saw that the set of effective degree $n$ divisors is finite -- it was built out of finitely many closed points of bounded degrees -- forcing $\Cl^n K$ to be finite.
The result follows because $\Cl^n K$ is a coset of $\Cl^0 K$, all of which have the same size, and the index is finite.
:::

:::{.definition title="Class Number of $K$"}
The **class number** of $K$ is defined as
\[  
h \da \abs{\Cl^0 K}
.\]
:::

:::{.remark}
There is a much fancier proof: there exists a $g\dash$dimensional abelian variety $A / \FF_q$, the *Jacobian variety* of $C/\FF_q$, such that $\Cl^0 K + A(\FF_q)$.
It is built out of the degree 0 divisor class group in some functorial way.
In particular, $A$ is a projective variety, and thus embeds into some $\PP^N_{/\FF_q}$, and so $\abs{A(\FF_q)} \leq \abs{\PP^N_{/\FF_q}} < \aleph_0$.
\

As one varies over all function fields over all finite fields, there will only be finitely many whose class number is bounded by some fixed $h_0$.
E.g. there are only finitely many function fields of class number 1, and these can be explicitly listed.
So $h\to \infty$ in some sense, which is not proved by showing that $\abs{A(\fq)} \to \infty$, and we'll instead prove it using methods closer to what we're seeing in this course.
:::

Up next: setting up the zeta function.

# Lecture 13

Recall that we previously looked at the regular function fields: we took a function field in one variable and considered the class of function fields for which we could take any extension of the constant field that we wanted.
As long as the ground field is perfect, being regular is equivalent to the constant subfield being $k$ itself.
However, we haven't done anything with them yet!

If you take an algebraic closure of the finite ground field $\FF_q$, there is a unique subextension of degree $r$ for every $r$, so we call that $\FF_{q^r}$.
The extension $\FF_{q^r}/\FF_q$ is cyclic galois, with a geometric Frobenius $x\to x^q$.
Note that $\FF_{q^r}$ is the fixed field of $F^r$, the $r$th power of the Frobenius map.
We set $K_r \da K \FF_{q^r}$, which is a regular function field over $\FF_{q^r}$. 
Note that we could view this as a function field just over $\FF_q$, but it would not be regular.
Then $K_r/K$ is a degree $r$ arithmetic extension of function fields.

Question:
What happens to places when making this scalar extension?
I.e., how to places in $K$ decompose in $K_r$?

:::{.remark}
This is related to an Algebraic Number Theory I problem: for $v\in \Sigma(\kfq)$ above an affine Dedekind domain $R$ such that $v\in \Sigma(K/R)$, let $S$ be the integral closure of $K$ in $K_r$.
Then we want to factor $p_v S$?
\todo[inline]{Not quite sure.}
:::

:::{.lemma title="Key lemma about how places split."}
Suppose $d\da \deg(v)$.
Then $K_r/K$ is galois, so we have $efg=r$.
In fact, $c=1$, so $f = {r\over \gcd(d, r)}$ and $g = \gcd(d, r)$ and each place $w\in \Sigma(K_r / \FF_{q^r})$ has degree ${d\over \gcd(d, r)}$.
:::

:::{.remark}
We have the following cases:

- The extension is *inert* iff $\gcd(d, r) = 1$,

- The extension *splits completely* iff $r\divides d$,

- All $w$ dividing $v$ have degree 1 iff $d\divides r$.

:::

The last thing we proved was that the degree zero divisor class group is finite when we're over a finite ground field.
Why is this true?
Whenever there is a divisor of degree $n$, then the set of degree $n$ divisors is a coset of the degree zero divisors, all of which have the same cardinality.
We proved finiteness using the Riemann-Roch theorem, using the fact that the set of *effective* degree $n$ divisors is finite for all $n$.

The next main topic will be the zeta function, which keeps track of three equivalent packets of information: $A_n$, the number of effective divisors of degree $n$, the number of places of degree $d$ (since an effective divisor is a linear combination of these), and $N_r$ the number of degree 1 points in the degree $r$ extension, i.e. the number of $\FF_{q^r}$ rational points.

:::{.lemma title="?"}
Suppose $C\in \Cl(K)$, then 

- The number of effective divisors $D \in [C]$ is given by 
\[  
{q^{\ell(C)} -1 \over q-1} 
,\]
  where $\ell(C)$ is the dimension of the linear system associated to the divisor class $C$, and this is the dimension of a projective space over $\FF_q$.

- For all $n>2g-2$ with $\delta \divides n$, we have
\[  
A_n = h \qty{ q^{n+1-g} - 1\over q-1}
.\]
:::

:::{.proof title="?"}
\envlist

**Proof of (a)**:
The set of effective divisors linearly equivalent to $D$ is naturally viewed as the projectivization $\PP \mathcal{L}(D)$ of the one-dimensional subspaces of the linear system of that divisor class.
It is then a fact that the number of elements in a $d\dash$dimensional vector space over $\FF_q$ has dimension precisely $\frac{q^d-1}{q-1}$ elements.
The projectivization comes in because two different functions have the same divisor if one of them is a constant multiple of the other.
Note that the number of elements is computed as the number of nonzero elements divided by the number of nonzero scalars.
\

**Proof of (b)**:
This will come out of the Riemann-Roch theorem.
In order to compute the number of divisors in a divisor class, you need to know the dimension of the linear system, which is not easy in general.
However, if the divisor class has sufficiently large degree, the Riemann-Roch theorem tells you exactly what it is.
As long as $n > 2g-2$, there is no correction term, and the dimension of the linear system is equal to its degree minus the genus plus one.
So by Riemann-Roch, since $\deg(D) > 2g-2$, $D$ is non-special and $\ell([D]) = n-g+1$, which yields the desired formula for $A_n$.

:::

:::{.remark}
This is the sharpest result possible: the canonical divisor has degree $2g-2$ and is special, so this fails for the canonical class.
:::

Upshot: there are three piece of information:

- $N_r$, the number of $\FF_{q^r}$ rational points,

- $\abs{\Sigma_d(\kfq)}$ the number of closed points / places of degree $d$,

- $A_n$ the number of effective divisors of degree $n$,

and there are simple formulas relating these.
Moreover, it is enough to know only finitely many of these quantities, where the number depends on $g$.

## Hasse-Weil Zeta Functions

There is a general theory that will unify 

- The Riemann zeta function, thought of as the zeta function of $\ZZ$, 

- The Dedekind zeta function, attached to the ring of integers over a number field,

- The Hasse-Weil zeta function of a one variable function field over a finite field,

all of which will be special cases of a *Serre zeta function* which can be attached to a finite type scheme over $\ZZ$.

Note that we aren't specifically discussing schemes in this course, but you don't need to know much about what a scheme is to define the Hasse-Weil zeta function. 
Just note that an affine finite-type $\ZZ\dash$scheme corresponds to a finitely generated $\ZZ\dash$algebra, and a general finite-type $\ZZ\dash$scheme will be covered by finitely many affine ones, the zeta function will be determined by these finitely many $\ZZ\dash$algebras and some kind of inclusion-exclusion principle (since the scheme is a not necessarily disjoint union of affine schemes).

Recall that $A_n = A_n(K)$ is the number of effective divisors of degree $n$, which we've proved is finite.
We have a formula when $n> 2g-2$, namely
\[  
Z(t) = \sum_{n=0}^\infty A_n t^n = \sum_{D\in \Div^+(K)} t^{\deg(D)} \in \ZZ[[t]]
,\]
where $\Div^+$ are the effective divisors and we've collected terms based on their degree.
This is analogous to the Dedekind zeta function of a number field $K$, a formal Dirichlet series which is given by
\[  
\zeta_K(s) = \sum_{I \in \mathcal{I}\qty{\ZZ_K^\bullet}} \abs{ \ZZ_K / I}^{-s}
.\]
where the sum is now over all of the nonzero ideals of the ring of integers, where we measure the size using the *norm*, i.e. the size of the residue field.
There's an analogy between integral ideals (vs fractional ideals) and effective divisors.
We could get an Euler product decomposition for the Dedekind zeta function by only considering prime ideals, since in a Dedekind domain all ideals factor uniquely into prime ideals.
In fact, any nonzero ideal is a linear combination of prime ideals.
Similarly, the effective divisors are linear combinations of effective divisors, so an Euler product expansion is possible here too.
If we take a prime ideal, since we're in a discrete valuation ring, we can consider the local ring at that point.
We can take the residue field, which in general won't be finite, but will be a finite extension.
So a reasonable measure of the size of a prime divisor would be the dimension of its residue field as a vector space over $K$.

Note that if we wanted to make these look even more similar to each other, we could define $a_n$ (depending on $\ZZ_K$) as 
\[
a_n = \abs{\ts{I \normal \ZZ_K \st \abs{\ZZ_K/I} = n}}
,\]
which allows us to write
\[  
\zeta_K(s) = \sum_{n=1}^\infty {a_n \over n^s}
.\]

Where we're going:
How does $Z(t)$ depend on $K$?
It turns out that it only depends on $A_0, A_1, \cdots, A_{2g-2}$, and thus $Z(t)$ depends on only finitely much information.
We will 

1. Show that $Z(t) \in \ZZ(t)$, i.e. it is a rational function and can be written $Z(t) = P(t)/ Q(t)$.

  > Note: the denominator will always be the same, $(1-t)(1-qt)$, and we'll always have $\deg P = 2g$.
  > This is essentially coming from $\ell\dash$adic cohomology.
  > We'll also determine the leading coefficient.

2. Understand $\deg P$ and $\deg Q$ in terms of the genus $g$.

3. Ask about the roots of $P(t)$, and establish a Riemann hypothesis for Dedekind zeta functions (and in particular, the Riemann zeta function).

> In particular, what are their magnitudes? 
> This is what Weil did, this is the big theorem in this area.
> Note that we'll need to consider reciprocal roots, which will end up having magnitude $\sqrt{q}$.
> We'll see why this happens, and it turns out to be analogous to fact that the nontrivial zeros of the Riemann zeta function have real part $1/2$.

These are approximately in order of difficulty.
The first two will follow from Riemann-Roch, but the third will be much deeper.
This is essentially a positive characteristic analogue of the usual Riemann hypothesis.
Note that we're in a global field, the positive characteristic analog of a number field, and for number fields the Riemann hypothesis is the single outstanding problem.
In the function field case, it is a theorem!


:::{.proposition title="Formula for the zeta function exhibiting rationality"}
Let $\kfq$ have genus $g$ and $\delta = I(K)$ the index, the least positive degree of a divisor.[^delta_note]

a. If $g=0$, then
\[  
Z(t) = {1\over q-1} \qty{{q \over 1-q^\delta t^\delta} - {1 \over 1-t^\delta}}
.\]

b. If $g\geq 1$, then $Z(t) + F(t) + G(t)$ where
\[  
F(t) 
&= {1\over q-1} \sum_{0\leq \deg C \leq 2g-2} q^{\ell(C)} t^{\deg(C)} \\
G(t)
&= {h \over g-1} \qty{
{ q^{1-g} (qt)^{2g-2+\delta} \over 1 - (qt)^\delta } - {1 \over 1 - t^\delta}
}
,\]
  so $F$ involves summing over all divisor classes of degree at most $2g-2$, and $G$ is a term coming from Riemann-Roch involving the class number $h$.

[^delta_note]: It will turn out (by a theorem of Schmidt) that $\delta = 1$ in the case of a finite ground field.

:::

Note that as a consequence, it will definitely be rational in $q$, and will have a simple pole at $t=1$.

There's no major idea for the proof: when the degree of the divisor class is sufficiently large, we just have an exact formula.
If it is smaller, than the formula involves the dimension of the linear system.

## Proof of Rationality

:::{.proof title="of rationality of $Z(t)$"}
Recall that $\ell(C)$ is the dimension of the associated Riemann-Roch space.

When $g=0$, by Riemann-Roch we have $\Cl^0(K) = 0$ over any ground field $\kk$ (see exercises), and so $h=1$.
Since every $n\geq 0$ satisfies $n\geq 2g-2$ when $g=0$, if $\delta\divides n$ we have
\[  
A_n = h \qty{ q^{n+1 - g} - 1 \over q-1} = {q^{n+1} - 1 \over q-1}
,\]
and since $A_n=0$ unless $n$ is divisible by $\delta$, we have
\[  
Z(t) = \sum_{n=0}^\infty A_n t^n = \sum_{n=0}^{\infty} A_{\delta n} t^{\delta n} = \sum_{n=0}^\infty {q^{\delta n + 1} -1 \over q-1} t^{\delta n}
.\]
This can now be split into two terms, each of which will have a geometric series to sum.

Now let $g\geq 1$, and write
\[  
\infsum{n} A_n t^n = \sum_{\deg(C) \geq 0} \abs{\ts{ A\in C \st A\geq 0}}t^{\deg(C)}
,\]
where we instead count the number of divisors in each divisor class (a consequence of the previous lemma).
Continuing this computation, we separate out the part where $\deg(C) \leq 2g-2$ and pull out the $-1$ in the numerator:
\[  
\cdots 
&= \sum_{\deg(C) \geq 0} {q^{\ell(C)} - 1 \over q - 1}t^{\deg(C)} \\
&= \qty{1\over q-1} \qty{ \sum_{0\leq \deg(C) \leq 2g-2} q^{\ell(C)} t^{\deg(C)} 
+ \sum_{\deg(C) > 2g-2} q^{\deg(C) - g + 1} t^{\deg(C)} - \sum_{\deg(C) \geq 0} t^{\deg(C)}
} \\
&\da F(t) + G(t)
,\]

so we can write

\[  
F(t) &= {1\over q-1} \sum_{0\leq \deg(C) \leq 2g-2} q^{\ell(C)} t^{\deg(C)}
\\
(q-1)G(t) &= \sum_{n = {2g-2 \over \delta} + 1}^\infty  h q^{n\delta + 1 - g} t^{n\delta}  - \infsum{n} ht^{n\delta}
.\]

Note that $\delta\divides 2g-2$ since the canonical divisor has degree $2g-2$ and $\delta$ is a gcd.
Note that for $g=1$, the index divides zero, which tells you nothing about it!
This now reduces to some geometric series that can be summed, which shows these are rational functions in $t$.
:::

:::{.exercise title="?"}
Let $K = \FF_q(t)$, then $g=0, \delta = 1$, and
\[  
Z(t) = {1\over (1-qt)(1-t)}
.\]
We will see in general that the numerator is of the form $L(t)$ where $L\in \ZZ[t]$ has degree $2g$.
:::

Note that this all generalized to higher dimensional projective varieties $X_{/\FF_q}$, for which these properties were proved by the work of Deligne.
In general, $Z(t)$ will be of the form
\[  
Z_X(t) = {L_1(t) \cdots L_{2d-1}(t) \over L_0(t) \cdots L_{2d}(t)}
,\]
where $d = \dim(X)$ and $\deg L_i$ will be the dimension of the $i$th $\ell\dash$adic cohomology.
Moreover, if $X_{/\FF_q}$ is a reduction mod $q$ of a variety in characteristic zero, these will be the Betti numbers of $X_{/\CC}$.
If we take a compact Riemann surface, which has a honest topological genus of $g$, the Betti numbers are $1, 2g, 1$, and this recovers the formula above for $L(t)$ and its degree.

The next result will be the following theorem:

:::{.theorem title="Schmidt, 1910ish"}
For all $\kfq$,
\[  
\delta = I(K) = 1
.\]
:::
This will greatly simplify the previous formulas.
A useful application is if you have a genus zero curve of index 1, applying Riemann-Roch  to a divisor of degree 1 shows that the function field is rational.
Thus the only genus zero function field over $\FF_q$ is the rational function field.
Useful aside: the Riemann hypothesis here gives an estimate of the number of $\FF_{q^r}$ rational points.

# Lecture 14

Recall the that *Hasse-Weil zeta function* of a one-variable function field $K/\FF_q$ over a finite ground field is defined in the following way: 
let $A_n = A_n(K)$ be the number of effective divisors of degree $n$.
We have proved that $A_n$ is finite, and for $n>2g-2$ we have a formula
\[  
Z(t) = \sum_{n=0}^\infty A_n t^n
= \sum_{D\in \Div^+(K)} t^{\deg(D)} \in \ZZ[[t]]
,\]
which is a formal power series with integer coefficients.

:::{.remark}
Recall that we have proved that it is a rational function of $t$, and in particular when $g=0, \delta = 1$
[^delta_def_reminder] we get
\[  
Z(t) = {1 \over (1-qt)(1-t)}
.\]

We got another expression which isn't fantastic: it involves this $\delta$, which we'll work toward proving is equal to 1.
When $g>1$, we broke the zeta function into two pieces $Z(t) = F(t) + G(t)$.
For divisors of sufficiently high degree, Riemann-Roch tells you what the dimension of the Riemann-Roch space is, and $G(t)$ explains the part coming from divisors of large degree.
We obtained a formula previously for $F(t)$ and $G(t)$, and once we show $\delta=1$ the formula for $G$ will simplify.
For $F(t)$, we specifically had
\[  
F(t) = {1\over q-1} \sum_{0\leq \deg(c) \leq 2g-2} q^{\ell(c) t^{\deg(c)}}
,\]
where the sum is over divisor classes and $\ell$ is the dimension of linear system corresponding to a divisor.
But this isn't a great formula: what are these classes, dhow many are in each degree, and what is the dimension of the Riemann-Roch space?

[^delta_def_reminder]: The *index* of the function field, least positive degree of a divisor.

:::

:::{.remark}
This is analogous to the Dedekind zeta function of a number field $K$, in which case
\[  
\zeta_K(s) = \sum_{T\in \ell(\ZZ_k)}^\bullet \abs{\ZZ_k/I}^{-s}
,\]
which will be covered in a separate lecture on *Serre zeta functions*.
:::

:::{.theorem title="F.K. Schmidt"}
For all $K/\FF_q$, we have $\delta = I(K) = 1$ where $I$ is the index.
:::

This will follow from the associated, but it much weaker.
However, this is one of the facts we'd like to establish to use to *prove* the Riemann hypothesis.

:::{.remark}
Pete studied this in 2004 and found that every $I\in \ZZ^+$ arises as the index of a genus one function field $K/\QQ$.
:::

Notation: for $n\in\ZZ^+$, let $\mu_n$ denote the $n$th roots of unity in $\CC$.

:::{.lemma title="?"}
For $m, r\in \ZZ^+$, set $d \da \gcd(m, r)$.
Then
\[  
\qty{1-t^{mr/d}}^d = \prod_{\xi\in \mu_r}  1 - (\xi t)^m
.\]
:::

:::{.proof title="?"}
In $\CC[x]$, we  have
\[  
(X^{r/1} - 1)^d = \prod_{\xi\in \mu_r}(X - \xi^m)
,\]
where both sides are monic polynomials whose roots include the $(r/d)$th roots of unity, each with multiplicity $d$.
On the LHS, the distinct roots are the $r/d$th roots of unity, then raising to the $d$th power gives them multiplicity $d$.
On the RHS, this is an exercise in cyclic groups: consider the $n$th power map on $\ZZ/r\ZZ$ and compute its image and kernel.
As $\xi$ ranges over $r$th roots of unity, $\xi^m$ ranges over all $r/d$th roots of unity, each occurring with multiplicity $d$.

Substituting $X= t^{-m}$ and multiplying both sides by $t^r$ yields the original result.


> Special case: set $m=r$, so $d=r$, then the RHS is $r$ copies of 1.

:::

Next up, we want to compare the zeta function $Z(t)$ for a function field over $\FF_q$ to the zeta function obtained when extending scalars to $\QQ^r$.

:::{.proposition title="Factorization identity for the zeta function"}
Let $K/\FF_q$ be a function field, $r\in \ZZ^+$, and take the compositum $K_r$ of $K$ and $\FF_q^r$ viewed as a function field over $\FF_q^r$.
Let $Z(t)$ be the zeta function of $K/\FF_q$ and $Z_r(t)$ the zeta function of $K_r/\FF_q^r$.
Then
\[  
Z_r(t^r) = \prod_{\xi \in \mu_r} Z(\xi t)
.\]
:::

:::{.proof title="?"}
We have an Euler product formula
\[  
Z(t) = \prod_{p\in \Sigma(K/\FF_q)} (1 - t^{\deg(p)})^{-1} 
.\]
where the sum is over places of the function field.

> Proving this Euler product formula might show up in a separate lecture, but it is not any more difficult than proving it for the Riemann zeta function.

:::{.exercise title="?"}
Why is this product expansion true?
Write as a geometric series with ratio $t^{\deg(p)}$.
Here just expand each summand to get 
\[  
Z(t) = \prod_p \sum_{j=1}^\infty t^{j\deg(p)}
.\]
Multiplying this out and collecting terms is in effect multiplying out the prime divisors to get effective divisors.
:::

We now use the result about splitting that was stated (but not proved): 

:::{.claim}
If $p\in \Sigma_m(K/\FF_q)$ is a degree $n$ place and $r\in \ZZ^+$, then there exist precisely $d\da \gcd(m, r)$places $p^r$ of $K_r$ lying over $p$. 
Moreover, each place $p^r$ has degree $m/d$.
:::

In order to compare $Z_r(t)$ to $Z(t)$, we collect the $p'$ into ones that have the same fiber.
We then can range over all $p$ first, then over all $p'$ in the fiber above $p$, yielding
\[  
Z_r(t^r) = \prod_{p\in \Sigma(K_{/\FF_q})} \prod_{p'/p} {1 \over 1 - t^{r\deg(p')}}
.\]

Using the Euler product identity, we have for $p\in \Sigma_m(K_{/\FF_q})$ and $d\da \gcd(m, r)$ we can express the innermost product as

\[  
\prod_{p'/p} {1 \over 1 - t^{r\deg(p')}} = (1 - t^{rm/d})^{-d} = \prod_{\xi\in \mu_r} (1- (\xi t)^m)^{-1}
,\]
where we've used the fact that we know there are exactly $d$ places and each contributes the same degree in the first expression.
By using $-d$ in the previous lemma, we get the last term.
Combining all of this yields
\[  
Z_r(t^r) 
= \prod_{\xi \in \mu_r} \prod_{p\in \Sigma(K_{/\FF_q})} (1- (\xi t)^{\deg p})^{-1} 
= \prod_{\xi \in \mu_r} Z(\xi t)
.\]
:::


:::{.remark}
Similar to taking an abelian extension of number fields and noting that the Dedekind zeta function factors into a finite product: the original zeta function, and in general, Hecke $L$ functions.
If you do this for an abelian number field over $\QQ$, then the Dedekind zeta function of the upstairs number field will be a finite product where one of the terms in the Riemann zeta function and the others are Dirichlet $L$ functions associated to certain Dirichlet characters.
So this is some (perhaps simpler) version of that.
:::

We can finally prove Schmidt's theorem that $\delta = 1$.

:::{.proof title="$\delta = 1$"}
Take a $\delta$th root of unity $\xi \in \mu_\delta$.
Then for all places $p \in \Sigma(K_{/\FF_q})$, $\delta$ divides $\deg p$ by definition since it is a gcd, and so we have
\[  
Z(\xi t) 
= \prod_{p\in \Sigma(K_{/\FF_q})} (q - (\xi t)^{\deg p} )^{-1} 
= \prod_{p\in \Sigma_{K_{\FF_q}}} {1 \over 1 - t^{\deg p}} = Z(t)
,\]
using the fact that $\xi^{\deg p} = 1$.

We're now in a situation where we can apply the previous proposition, which gives the following identity for the zeta function over the degree $\delta$ extension:
\[  
Z_{\delta}(t^\delta) = \prod_{\xi \in \mu_\delta} Z(\xi t) = Z(t)^\delta
.\]

Our previous formulas show that any zeta function for a 1-variable function field over a finite field has a simple pole at $t=1$, and since $\ord_{t-1}(t^\delta) = 0$, we get
\[  
-1 = \ord_{t-1} Z_\delta(t^\delta) = \ord_{t-1} Z(t)^\delta) = -\delta
,\]
where for the first equality we're using the fact that the $(t-1)\dash$adic valuation of $Z_\delta(t^\delta)$ is one, and for the RHS, the ordinary zeta function has a simple pole at $t=1$ and since we have a valuation, raising something to the $\delta$th power is just $\delta$ times the original valuation.

:::

There is some modest representation theory (character theory) that shows up when looking at zeta functions of abelian extensions.

:::{.remark}
We can also conclude that every genus zero function field $\kfq$ is isomorphic to $\FF_q(t)$ and thus rational, since such a function field rational iff it has index one.
Why?
By Riemann-Roch, index one implies existence of a divisor of degree one, and taking a genus zero curve says that every divisor of nonnegative degree is linearly equivalent to an effective divisor.
Thus if you have a divisor of degree one, you have an effective divisor of degree one, which makes the function field a degree one extension of a rational function field.
:::

:::{.exercise title="?"}
Let $K = \FF_q(t)$, then show that $g=0, \delta = 1$, and
\[  
Z(t) = {1 \over (1-qt)(1-t)}
.\]

> Hint: go back to complicated formulas and substitute $\delta=1$ to simplify things.

:::

Thus for rationality of the zeta function, we can get rid of the $\delta$ cluttering up formulas.
Going back to the plan, we wanted to show

1.Rationality: $Z(t) \in \QQ(t)$ and thus $Z(t) = P(t) / Q(t)$,

2. Understand the degrees of $P$ and $Q$ in terms of the genus, and

3. Ask about the roots of $P(t)$ to understand the analog of the Riemann Hypothesis for Dedekind zeta functions

We'll want to establish a functional equation, as is the usual yoga for zeta functions, since it helps establish a meromorphic continuation to $\CC$.

The algebraic significance of the functional equation is that it aids in understand several equivalent packets of data:

- The number of effective divisors of a given degree,

- The number of places of a given degree,

- The number of rational points over each finite degree extension of the base field.

## The Functional Equation

:::{.theorem title="Functional Equation"}
Let $\kfq$ be a function field of genus $g$, then
\[  
Z(t) = q^{g-1} t^{2g-2} Z\qty{1\over qt}
.\]
:::

:::{.proof title="?"}
For $g=0$, we know that 
\[  
Z(t) = {1 \over (1-t)(1-qt)}
,\]
and plugging in ${1\over qt}$ is a straightforward calculation.
So assume $g\geq 1$.

The idea was that we wrote $Z(t) = F(t) + G(t)$.
The $F(t)$ piece came from summing over divisor classes of degree between $0$ and $2g-2$ and recording the dimension of the associated linear system.
The tricky piece $G(t)$ came from summing an infinite geometric series to get a more innocuous closed-form expression of a rational function.
So the strategy here is to separately establish the functional equation for each of $F$ and $G$ separately.
How to do this: for $g=0$, there was no $F(t)$ piece. 
If we have a closed form it's just a computational check.
For $F(t)$, we'll use our greatest weapon and dearest ally, the Riemann-Roch theorem.
This will provide the extra symmetry we need.

We essentially already applied Riemann-Roch to $G(t)$ to get the closed-form expression, but we haven't applied it to the small degree divisors.
This doesn't tell you what the dimension is, but rather gives you a duality result: ti gives the dimension in terms of the dimension of a complementary divisor.

Take a canonical divisor $\mathcal{K} \in \div(K)$, so $\deg \mathcal{K} = 2g-2$.
As $C$ runs through all divisor classes of $\mathcal{K}$ of degree $d$ with $0\leq d \leq 2g-2$, so does the complementary divisor $\mathcal{K}-C$.

We can thus write

\[  
(q-1) F(t) 
&= \sum_{0 \leq \deg C \leq 2g-2 } q^{\ell(C)} t^{\deg(C)} \\
(q-1)G(t)
&= h \qty{ {q^g t^{2g-1} \over 1-qt} - {1 \over 1-t} }
.\]

We can thus compute
\[  
(q-1) F\qty{1\over qt}
&= \sum_{0\leq \deg C \leq 2g-2} q^{\ell(C)} \qty{1\over {qt} }^{\deg C} \\
&= \sum_{0\leq \deg C \leq 2g-2} q^{\ell(\mathcal{K} - C)} \qty{1\over {qt} }^{2g-2-\deg C}
,\]
where in the second step we've exchanged $C$ for $\mathcal{K}- C$ and noted that $\deg(\mathcal{K}-C) = 2g-2-\deg(C)$.
We now do the calculation another way,
\[  
(q-1) F(t) 
&= \sum_{0\leq \deg C \leq 2g-2} q^{\ell(C)} t^{\deg C} \\
&=
q^{g-1} t^{2g-1} \sum_{0\leq \deg C \leq 2g-2} q^{\deg(C) - (2g-2) + \ell(\mathcal{K}-C)} t^{\deg(C) - (2g-2)} && \text{by Riemann-Roch} \\
&= q^{g-1} t^{2g-2} \sum_{0 \leq \deg C \leq 2g-2} q^{\ell(\mathcal{K} - C)} \qty{1\over qt}^{\deg(\mathcal{K} - C)} \\
&= q^{g-1} t^{2g-2} (q-1) F\qty{1\over qt}
.\]
where we've used Riemann-Roch to find that $\ell(C) = \ell(\mathcal{K}-C) + \deg(C) - g + 1$.
Cancelling the common factor of $(q-1)$ establishes the functional equation for $F(T)$.

Now using the fact that $\delta = 1$, we have
\[  
(q-1)G(t) = h \qty{ {q^g t^{2g-1} \over 1-qt} - {1\over 1-t} }
,\]
and thus
\[  
(q-1) q^{g-1} t^{2g-2} G\qty{1\over qt}
&= hq^{g-1} t^{2g-2} \qty{q^g \qty{1\over qt}^{2g-1} - {1\over 1 - q \qty{1\over qt}} - {1\over 1 - {1\over qt}} } \\
&=
h\qty{ {-1\over 1-t} + {q^g t^{2g-1} \over 1-qt}} \\
&= (q-1) G(t)
,\]
which establishes the functional equation for $G(t)$.
:::

## The $L$ Polynomial

:::{.definition title="The $L$ Polynomial"}
\[  
L(t) \da (1-t) (1-qt)  Z(t) \in \ZZ[t]
.\]
:::

This clears the denominators in $Z(t)$, so this is now a polynomial of degree at most $2g$.
We can thus rewrite
\[  
Z(t) = {L(t) \over (1-t)(1-qt)} = {a_{2g} t^{2g} + \cdots + a_1 t + a_0 \over (1-t)(1-qt)}
.\]
Note that if we know $L(t)$, then we know $Z(t)$, and in particular we would like to know what the coefficients $a_j$ are.
We'll be able to determine $a_0 = 1$ in all cases, as well as $a_{2g}$ in all cases pretty easily.
So it looks like it only remains to compute $a_1, \cdots, a_{2g-1}$, but the functional equation will give a "mirror" relation between pairs of coefficients.
The upshot is that the functional equation shows that we only need to know $a_1, \cdots, a_g$ to completely determine $Z(t)$.
If $g=1$, just one coefficient suffices.
It turns out that $a_1$ will be $q+1$ minus the number of degree one places.

Questions: what are the constraints on these quantities? 
Can we write the zeta function in a nice way?
Exactly what do we need to compute to determine it?

It will turn out that computing the number of rational points over $\FF_{q}, \FF_{q^2}, \cdots, \FF_{q^g}$ will be possible.
For example, for a hyperelliptic curve, we'll have an explicit defining equation and can make an explicit point count, and you only need $g$ of them.
