# Wednesday April 1st

Let $M$ be a finitely generated $R\dash$module, then we define a rank function
\begin{align*}
\rk_M: \spec R \to \NN \\
\mfp \mapsto \dim_{k(\mfp)} M \tensor_R k(\mfp)
\end{align*}
where $k(\mfp) = ff(R/\mfp)$.

Question:
If $\mfp_1 \subset \mfp_2$, how do the ranks compare?

Example:
Take $R = \ZZ$ and $M = \ZZ \oplus \ZZ/(10)$, then take $(0) \subseteq (p)$.
Then $\rk_M((0)) = \dim_\QQ M \tensor_\ZZ \QQ = 1$.
However,
\begin{align*}
\rk_M((p)) = \begin{cases}
2 & p=2,5 \\
1 & \text{else}
\end{cases}
.\end{align*}

If $M$ is locally free, e.g. projective, and $\mfp_1 \subseteq \mfp_2$ then $M_{\mfp_1} = M_{\mfp_2} \tensor_{R_{\mfp_2}} R_{\mfp_1}$ is a canonical isomorphism.
Then
\begin{align*}
R_{\mfp_1}^{\rk \mfp_1} = M_{\mfp_1} = M_{\mfp_2} \tensor_{R_{\mfp_2}}
= R^{\rk \mfp_2}_{\mfp_2} \tensor R_{\mfp_1} \cong R_{\mfp_1}^{\rk \mfp_2}
.\end{align*}

Thus $\rk(\mfp_1) = \rk(\mfp_2)$.
In other words, tensor to the fraction field and take the dimension.

Proposition
: If $M$ is finitely generated projective of constant rank $n$ then $M$ is free $\iff M$ can be generated by $n$ elements.

Lemma
: If $M$ is finitely generated projective and $I \in \mcj(R)$, then $M/IM$ free implies $M$ is free.

> Nakayama: "finite generators in quotient" lifts to finite generators in total module.

Proof
:   $M/IM \cong(R/I)^n$ since it's finitely generated and free, so this fits the hypothesis of Nakayama's lemma.
    So the last number of generators for $M$ is $n$.
    Then for any $\mfm \in \maxspec R$, then after base change we get a diagram
    \begin{center}
    \begin{tikzcd}
    \mfm \ar[r]\ar[rd] & M/IM \ar[d, "\surjects"] \\
    & M/\mfm M
    \end{tikzcd}
    \end{center}

    Since $M/\mfm M$ is free of finite rank $n$, ???????.


Corollary
: If $R$ is *semilocal* and $M$ is a finitely generated projective module, then $M$ is free $\iff \rk_M$ is constant.
