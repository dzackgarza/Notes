\newcommand{\textoperatorname}[1]{
  \operatorname{\textnormal{#1}}
}
\newcommand{\et}{\text{ét}}
\newcommand{\Et}{\text{Ét}}
\newcommand\stacksymbol[3]{
  \mathrel{\stackunder[2pt]{\stackon[4pt]{$#3$}{$\scriptscriptstyle#1$}}{
  $\scriptscriptstyle#2$}}
}
\renewcommand{\AA}[0]{{\mathbb{A}}}
\newcommand{\Af}[0]{{\mathbb{A}}}
\newcommand{\CC}[0]{{\mathbb{C}}}
\newcommand{\CP}[0]{{\mathbb{CP}}}
\newcommand{\DD}[0]{{\mathbb{D}}}
\newcommand{\FF}[0]{{\mathbb{F}}}
\newcommand{\fq}[0]{{\mathbb{F}_{q}}}
\newcommand{\fqr}[0]{{\mathbb{F}_{q^r}}}
\newcommand{\GF}[0]{{\mathbb{GF}}}
\newcommand{\GG}[0]{{\mathbb{G}}}
\newcommand{\HH}[0]{{\mathbb{H}}}
\newcommand{\HP}[0]{{\mathbb{HP}}}
\newcommand{\KK}[0]{{\mathbb{K}}}
\newcommand{\kk}[0]{{\mathbb{k}}}
\newcommand{\bbm}[0]{{\mathbb{M}}}
\newcommand{\NN}[0]{{\mathbb{N}}}
\newcommand{\OP}[0]{{\mathbb{OP}}}
\newcommand{\PP}[0]{{\mathbb{P}}}
\newcommand{\QQ}[0]{{\mathbb{Q}}}
\newcommand{\RP}[0]{{\mathbb{RP}}}
\newcommand{\RR}[0]{{\mathbb{R}}}
\newcommand{\SpSp}[0]{{\mathbb{S}}}
\renewcommand{\SS}[0]{{\mathbb{S}}}
\newcommand{\TT}[0]{{\mathbb{T}}}
\newcommand{\ZZ}[0]{{\mathbb{Z}}}
\newcommand{\znz}[0]{\mathbb{Z}/n\mathbb{Z}}
\newcommand{\zpz}[0]{\mathbb{Z}/p\mathbb{Z}}
\newcommand{\zlz}[0]{\mathbb{Z}/\ell\mathbb{Z}}
\newcommand{\zlnz}[0]{\mathbb{Z}/\ell^n\mathbb{Z}}
\newcommand{\Qp}[0]{\mathbb{Q}_{(p)}}
\newcommand{\Zp}[0]{\mathbb{Z}_{(p)}}
\newcommand{\Cx}[0]{\operatorname{Cx}}
\newcommand{\Ch}[0]{\operatorname{Ch}}
\newcommand{\ks}[0]{\operatorname{ks}}
\newcommand{\Arg}[0]{\operatorname{Arg}}
\newcommand{\PGL}[0]{\operatorname{PGL}}
\newcommand{\GL}[0]{\operatorname{GL}}
\newcommand{\Gl}[0]{\operatorname{GL}}
\newcommand{\gl}[0]{\operatorname{GL}}
\newcommand{\mat}[0]{\operatorname{Mat}}
\newcommand{\Mat}[0]{\operatorname{Mat}}
\newcommand{\Rat}[0]{\operatorname{Rat}}
\newcommand{\Perv}[0]{\operatorname{Perv}}
\newcommand{\Gal}[0]{\operatorname{Gal}}
\newcommand{\Hilb}[0]{\operatorname{Hilb}}
\newcommand{\Quot}[0]{\operatorname{Quot}}
\newcommand{\Art}[0]{\operatorname{Art}}
\newcommand{\red}[0]{\operatorname{red}}
\newcommand{\Pic}[0]{{\operatorname{Pic}}}
\newcommand{\lcm}[0]{\operatorname{lcm}}
\newcommand{\maps}[0]{\operatorname{Maps}}
\newcommand{\maxspec}[0]{{\operatorname{maxSpec}}}
\newcommand{\Tr}[0]{\operatorname{Tr}}
\newcommand{\adj}[0]{\operatorname{adj}}
\newcommand{\ad}[0]{\operatorname{ad}}
\newcommand{\ann}[0]{\operatorname{Ann}}
\newcommand{\Ann}[0]{\operatorname{Ann}}
\newcommand{\arcsec}[0]{\operatorname{arcsec}}
\newcommand{\ch}[0]{\operatorname{ch}}
\newcommand{\Sp}[0]{{\operatorname{Sp}}}
\newcommand{\syl}[0]{{\operatorname{Syl}}}
\newcommand{\ff}[0]{\operatorname{ff}}
\newcommand{\txand}[0]{{\operatorname{ and }}}
\newcommand{\Tot}[0]{\mathrm{\operatorname{Tot}}}
\newcommand{\fppf}[0]{\mathrm{\operatorname{fppf}}}
\newcommand{\Fppf}[0]{\mathrm{\operatorname{Fppf}}}
\newcommand{\zar}[0]{{\mathrm{zar}}}
\newcommand{\Zar}[0]{{\mathrm{Zar}}}
\newcommand{\qcoh}[0]{{\mathrm{QCoh}}}
\newcommand{\Qcoh}[0]{{\mathrm{QCoh}}}
\newcommand{\QCoh}[0]{{\mathrm{QCoh}}}
\newcommand{\codim}[0]{\operatorname{codim}}
\newcommand{\coim}[0]{\operatorname{coim}}
\newcommand{\ssets}[0]{\operatorname{sSets}}
\newcommand{\dom}[0]{\operatorname{dom}}
\newcommand{\txor}[0]{{\operatorname{ or }}}
\newcommand{\txt}[1]{{\operatorname{ {#1} }}}
\newcommand{\Gr}[0]{{\operatorname{Gr}}}
\newcommand{\gr}[0]{{\operatorname{gr}}}
\newcommand{\grMod}[0]{{\operatorname{grMod}}}
\newcommand{\dcoset}[3]{
    {\textstyle #1}
    \mkern-4mu\scalebox{1.5}{$\diagdown$}\mkern-5mu^{\textstyle #2}
    \mkern-4mu\scalebox{1.5}{$\diagup$}\mkern-5mu{\textstyle #3} }
\newcommand{\grdim}[0]{{\operatorname{gr\,dim}}}
\newcommand{\Aut}[0]{{\operatorname{Aut}}}
\newcommand{\aut}[0]{\operatorname{Aut}}
\newcommand{\Inn}[0]{{\operatorname{Inn}}}
\newcommand{\Out}[0]{{\operatorname{Out}}}
\newcommand{\mltext}[1]{\left\{\begin{array}{c}#1\end{array}\right\}}
\newcommand{\Fun}[0]{{\operatorname{Fun}}}
\newcommand{\SL}[0]{{\operatorname{SL}}}
\newcommand{\PSL}[0]{{\operatorname{PSL}}}
\newcommand{\SO}[0]{{\operatorname{SO}}}
\newcommand{\SU}[0]{{\operatorname{SU}}}
\newcommand{\SP}[0]{{\operatorname{SP}}}
\newcommand{\per}[0]{{\operatorname{Per}}}
\newcommand{\loc}[0]{{\operatorname{loc}}}
\newcommand{\Top}[0]{{\operatorname{Top}}}
\newcommand{\Mfd}[0]{{\operatorname{Mfd}}}
\newcommand{\Ab}[0]{{\operatorname{Ab}}}
\newcommand{\Spin}[0]{{\operatorname{Spin}}}
\newcommand{\mcTop}[0]{\mathcal{T}\operatorname{op}}
\newcommand{\hoTop}[0]{{\operatorname{hoTop}}}
\newcommand{\Sch}[0]{{\operatorname{Sch}}}
\newcommand{\sch}[0]{{\operatorname{Sch}}}
\newcommand{\Sing}[0]{{\operatorname{Sing}}}
\newcommand{\sing}[0]{{\operatorname{Sing}}}
\newcommand{\alg}[0]{\mathrm{Alg}}
\newcommand{\scalg}[0]{\mathrm{sCAlg}}
\newcommand{\calg}[0]{\mathrm{CAlg}}
\newcommand{\dR}[0]{\mathrm{dR}}
\newcommand{\poly}[0]{\operatorname{poly}}
\newcommand{\Vect}[0]{{\operatorname{Vect}}}
\newcommand{\Sh}[0]{{\operatorname{Sh}}}
\newcommand{\presh}[0]{{\operatorname{Presh}}}
\newcommand{\Presh}[0]{{\operatorname{Presh}}}
\newcommand{\ab}[0]{{\operatorname{ab}}}
\newcommand{\op}[0]{^{\operatorname{op}}}
\newcommand{\Op}[0]{{\operatorname{Op}}}
\newcommand{\Ob}[0]{{\operatorname{Ob}}}
\newcommand{\prim}[0]{{\operatorname{prim}}}
\newcommand{\Set}[0]{{\operatorname{Set}}}
\newcommand{\Sets}[0]{{\operatorname{Set}}}
\newcommand{\Grp}[0]{{\operatorname{Grp}}}
\newcommand{\Groups}[0]{{\operatorname{Groups}}}
\newcommand{\Homeo}[0]{{\operatorname{Homeo}}}
\newcommand{\Diffeo}[0]{{\operatorname{Diffeo}}}
\newcommand{\MCG}[0]{{\operatorname{MCG}}}
\newcommand{\set}[0]{{\operatorname{Set}}}
\newcommand{\Tor}[0]{\operatorname{Tor}}
\newcommand{\ext}{\operatorname{Ext} }
\newcommand{\Ext}{\operatorname{Ext}}
\newcommand{\sets}[0]{{\operatorname{Set}}}
\newcommand{\Sm}[0]{{\operatorname{Sm}}}
\newcommand{\fin}[0]{{\operatorname{fin}}}
\newcommand{\orr}[0]{{\operatorname{ or }}}
\newcommand{\annd}[0]{{\operatorname{ and }}}
\newcommand{\bung}[0]{\operatorname{Bun}_G}
\newcommand{\const}[0]{{\operatorname{const.}}}
\newcommand{\disc}[0]{{\operatorname{disc}}}
\newcommand{\id}[0]{\operatorname{id}}
\newcommand{\Id}[0]{\operatorname{Id}}
\newcommand{\im}[0]{\operatorname{im}}
\newcommand{\pt}[0]{{\{\operatorname{pt}\}}}
\newcommand{\sep}[0]{^\operatorname{sep}}
\newcommand{\tors}[0]{{\operatorname{tors}}}
\newcommand{\tor}[0]{\operatorname{Tor}}
\newcommand{\height}[0]{\operatorname{ht}}
\newcommand{\cpt}[0]{\operatorname{compact}}
\newcommand{\abs}[1]{{\left\lvert {#1} \right\rvert}}
\newcommand{\stack}[1]{\mathclap{\substack{ #1 }}} 
\newcommand{\qtext}[1]{{\quad \operatorname{#1} \quad}}
\newcommand{\qst}[0]{{\quad \operatorname{such that} \quad}}
\newcommand{\actsonl}[0]{\curvearrowleft}
\newcommand{\actson}[0]{\curvearrowright}
\newcommand{\bd}[0]{{\del}}
\newcommand{\bigast}[0]{{\mathop{\Large \ast}}}
\newcommand{\coker}[0]{\operatorname{coker}}
\newcommand{\Mor}[0]{\operatorname{Mor}}
\newcommand{\cone}[0]{\operatorname{cone}}
\newcommand{\cok}[0]{\operatorname{coker}}
\newcommand{\conjugate}[1]{{\overline{{#1}}}}
\newcommand{\converges}[1]{\overset{#1}}
\newcommand{\correspond}[1]{\theset{\substack{#1}}}
\newcommand{\cross}[0]{\times}
\newcommand{\by}[0]{\times}
\newcommand{\dash}[0]{{\hbox{-}}}
\newcommand{\dd}[2]{{\frac{\partial #1}{\partial #2}\,}}
\newcommand{\definedas}[0]{\coloneqq}
\newcommand{\da}[0]{\coloneqq}
\newcommand{\del}[0]{{\partial}}
\newcommand{\directlim}[0]{\varinjlim}
\newcommand{\inverselim}[0]{\varprojlim}
\newcommand{\disjoint}[0]{{\coprod}}
\newcommand{\Disjoint}[0]{\displaystyle\coprod}
\newcommand{\dual}[0]{^\vee}
\newcommand{\sm}[0]{\setminus}
\newcommand{\smz}[0]{\setminus\theset{0}}
\newcommand{\smts}[1]{\setminus\theset{#1}}
\newcommand{\eps}[0]{\varepsilon}
\newcommand{\floor}[1]{{\left\lfloor #1 \right\rfloor}}
\newcommand{\up}[0]{\uparrow}
\newcommand{\generators}[1]{\left\langle{#1}\right\rangle}
\newcommand{\gs}[1]{\left\langle{#1}\right\rangle}
\newcommand{\homotopic}[0]{\simeq}
\newcommand{\injectivelim}[0]{\varinjlim}
\newcommand{\inner}[2]{{\left\langle {#1},~{#2} \right\rangle}}
\newcommand{\ip}[2]{{\left\langle {#1},~{#2} \right\rangle}}
\newcommand{\union}[0]{\cup}
\newcommand{\Union}[0]{\bigcup}
\newcommand{\intersect}[0]{\cap}
\newcommand{\Intersect}[0]{\bigcap}
\newcommand{\into}[0]{\to}
\newcommand{\inv}[0]{^{-1}}
\newcommand{\mfa}[0]{{\mathfrak{a}}}
\newcommand{\mfb}[0]{{\mathfrak{b}}}
\newcommand{\mfc}[0]{{\mathfrak{c}}}
\newcommand{\mff}[0]{{\mathfrak{f}}}
\newcommand{\mfi}[0]{{\mathfrak{I}}}
\newcommand{\mfm}[0]{{\mathfrak{m}}}
\newcommand{\mfn}[0]{{\mathfrak{n}}}
\newcommand{\mfp}[0]{{\mathfrak{p}}}
\newcommand{\mfq}[0]{{\mathfrak{q}}}
\newcommand{\mfr}[0]{{\mathfrak{r}}}
\newcommand{\lieb}[0]{{\mathfrak{b}}}
\newcommand{\liegl}[0]{{\mathfrak{gl}}}
\newcommand{\lieg}[0]{{\mathfrak{g}}}
\newcommand{\lieh}[0]{{\mathfrak{h}}}
\newcommand{\lien}[0]{{\mathfrak{n}}}
\newcommand{\liesl}[0]{{\mathfrak{sl}}}
\newcommand{\lieso}[0]{{\mathfrak{so}}}
\newcommand{\liesp}[0]{{\mathfrak{sp}}}
\newcommand{\lieu}[0]{{\mathfrak{u}}}
\newcommand{\Lie}[0]{\operatorname{Lie}}
\newcommand{\nilrad}[0]{{\mathfrak{N}}}
\newcommand{\jacobsonrad}[0]{{\mathfrak{J}}}
\newcommand{\mm}[0]{{\mathfrak{m}}}
\newcommand{\pr}[0]{{\operatorname{pr}}}
\newcommand{\mapsvia}[1]{\xrightarrow{#1}}
\newcommand{\fromvia}[1]{\xleftarrow{#1}}
\newcommand{\mapstovia}[1]{\xmapsto{#1}}
\newcommand{\ms}[0]{\xrightarrow{\sim}}
\newcommand{\from}[0]{\leftarrow}
\newcommand{\mapstofrom}[0]{\rightleftharpoons}
\newcommand{\mapscorrespond}[2]{\mathrel{\operatorname*{\rightleftharpoons}_{#1}^{#2}}}
\newcommand{\injects}[0]{\hookrightarrow}
\newcommand{\injectsvia}[1]{\xhookrightarrow{#1}}
\newcommand{\surjects}[0]{\twoheadrightarrow}
\newcommand{\surjectsvia}[2][]{
  \xrightarrow[#1]{#2}\mathrel{\mkern-14mu}\rightarrow
}
\newcommand{\adjoint}[0]{\leftrightarrows}
\newcommand{\kx}[1]{k[x_1, \cdots, x_{#1}]}
\newcommand{\kxn}[0]{k[x_1, \cdots, x_{n}]}
\newcommand{\MM}[0]{{\mathcal{M}}}
\newcommand{\OO}[0]{{\mathcal{O}}}
\newcommand{\OX}[0]{{\mathcal{O}_X}}
\newcommand{\imaginarypart}[1]{{\mathcal{Im}({#1})}}
\newcommand{\mca}[0]{{\mathcal{A}}}
\newcommand{\mcb}[0]{{\mathcal{B}}}
\newcommand{\mcc}[0]{{\mathcal{C}}}
\newcommand{\mcd}[0]{{\mathcal{D}}}
\newcommand{\mce}[0]{{\mathcal{E}}}
\newcommand{\mcf}[0]{{\mathcal{F}}}
\newcommand{\mcg}[0]{{\mathcal{G}}}
\newcommand{\mch}[0]{{\mathcal{H}}}
\newcommand{\mci}[0]{{\mathcal{I}}}
\newcommand{\mcj}[0]{{\mathcal{J}}}
\newcommand{\mck}[0]{{\mathcal{K}}}
\newcommand{\mcl}[0]{{\mathcal{L}}}
\newcommand{\mcm}[0]{{\mathcal{M}}}
\newcommand{\mcp}[0]{{\mathcal{P}}}
\newcommand{\mcs}[0]{{\mathcal{S}}}
\newcommand{\mct}[0]{{\mathcal{T}}}
\newcommand{\mcu}[0]{{\mathcal{U}}}
\newcommand{\mcv}[0]{{\mathcal{V}}}
\newcommand{\mcx}[0]{{\mathcal{X}}}
\newcommand{\mcz}[0]{{\mathcal{Z}}}
\newcommand{\kfq}[0]{K_{/\mathbb{F}_q}}
\newcommand{\cl}[0]{\operatorname{cl}}
\newcommand{\Cl}[0]{\operatorname{Cl}}
\newcommand{\St}[0]{\operatorname{St}}
\newcommand{\trdeg}[0]{\operatorname{trdeg}}
\newcommand{\dist}[0]{\operatorname{dist}}
\newcommand{\Dist}[0]{\operatorname{Dist}}
\newcommand{\crit}[0]{\operatorname{crit}}
\newcommand{\diam}[0]{{\operatorname{diam}}}
\newcommand{\gal}[0]{\operatorname{Gal}}
\newcommand{\diff}[0]{\operatorname{Diff}}
\newcommand{\diag}[0]{\operatorname{diag}}
\newcommand{\soc}[0]{\operatorname{Soc}}
\newcommand{\hd}[0]{\operatorname{Head}}
\newcommand{\grad}[0]{\operatorname{grad}}
\newcommand{\hilb}[0]{\operatorname{Hilb}}
\newcommand{\minpoly}[0]{{\operatorname{minpoly}}}
\newcommand{\Frame}[0]{{\operatorname{Frame}}}
\newcommand{\OFrame}[0]{{\operatorname{OFrame}}}
\newcommand{\UFrame}[0]{{\operatorname{UFrame}}}
\newcommand{\smooth}[0]{{\operatorname{sm}}}
\newcommand{\Hom}[0]{{\operatorname{Hom}}}
\newcommand{\shom}{\mathscr{H}\operatorname{\kern -3pt {\calligra\large om}}}
\newcommand{\HHom}{\mathscr{H}\kern-2pt\operatorname{om}}
\newcommand{\Map}[0]{{\operatorname{Map}}}
\newcommand{\multinomial}[1]{\left(\!\!{#1}\!\!\right)}
\newcommand{\nil}[0]{{\operatorname{nil}}}
\newcommand{\normalneq}{\mathrel{\reflectbox{$\trianglerightneq$}}}
\newcommand{\normal}[0]{{~\trianglelefteq~}}
\newcommand{\norm}[1]{{\left\lVert {#1} \right\rVert}}
\newcommand{\pnorm}[2]{{\left\lVert {#1} \right\rVert}_{#2}}
\newcommand{\notdivides}[0]{\nmid}
\newcommand{\notimplies}[0]{\centernot\implies}
\newcommand{\onto}[0]{\twoheadhthtarrow}
\newcommand{\ord}[0]{{\operatorname{Ord}}}
\newcommand{\pic}[0]{{\operatorname{Pic}}}
\newcommand{\projectivelim}[0]{\varprojlim}
\newcommand{\rad}[0]{{\operatorname{rad}}}
\newcommand{\ralg}[0]{\operatorname{R-alg}}
\newcommand{\kalg}[0]{k\dash\operatorname{alg}}
\newcommand{\rank}[0]{\operatorname{rank}}
\newcommand{\realpart}[1]{{\mathcal{Re}({#1})}}
\newcommand{\Log}[0]{\operatorname{Log}}
\newcommand{\reg}[0]{\operatorname{Reg}}
\newcommand{\restrictionof}[2]{ {\left.{{#1}} \right|_{{#2}} } }
\newcommand{\ro}[2]{{ \left.{{#1}} \right|_{{#2}} }}
\newcommand{\rk}[0]{{\operatorname{rank}}}
\newcommand{\evalfrom}[0]{\Big|}
\renewcommand{\mod}{\pmod}
\newcommand{\rmod}[0]{{R\dash\mathrm{mod}}}
\newcommand{\modr}[0]{{\mathrm{mod}\dash R}}
\newcommand{\mmod}[0]{{\dash\operatorname{mod}}}
\newcommand{\mods}[1]{{{#1}\dash\operatorname{mod}}}
\newcommand{\kmod}[0]{{k\dash\operatorname{mod}}}
\newcommand{\Mod}[0]{{\operatorname{Mod}}}
\newcommand{\rotate}[2]{{\style{display: inline-block; transform: rotate(#1deg)}{#2}}}
\newcommand{\selfmap}[0]{{\circlearrowleft}}
\newcommand{\semidirect}[0]{\rtimes}
\newcommand{\sgn}[0]{\operatorname{sgn}}
\newcommand{\sign}[0]{\operatorname{sign}}
\newcommand{\spanof}[0]{{\operatorname{span}}}
\newcommand{\spec}[0]{\operatorname{Spec}}
\newcommand{\mspec}[0]{\operatorname{mSpec}}
\newcommand{\Jac}[0]{\operatorname{Jac}}
\newcommand{\stab}[0]{{\operatorname{Stab}}}
\newcommand{\stirlingfirst}[2]{\genfrac{[}{]}{0pt}{}{#1}{#2}}
\newcommand{\stirling}[2]{\genfrac\{\}{0pt}{}{#1}{#2}}
\newcommand{\strike}[1]{{\enclose{horizontalstrike}{#1}}}
\newcommand{\st}[0]{{~\mathrel{\Big|}~}}
\newcommand{\supp}[0]{{\operatorname{supp}}}
\newcommand{\sym}[0]{\operatorname{Sym}}
\newcommand{\Sym}[0]{\operatorname{Sym}}
\newcommand{\Wedge}[0]{\Lambda}
\newcommand{\Vee}[0]{\bigvee}
\newcommand{\tensor}[0]{\otimes}
\newcommand{\connectsum}[0]{\mathop{\Large \#}}
\newcommand{\theset}[1]{\left\{{#1}\right\}}
\newcommand{\ts}[1]{\left\{{#1}\right\}}
\newcommand{\infsum}[1]{\sum_{{#1=0}}^\infty}
\newcommand{\gens}[1]{\left\langle{#1}\right\rangle}
\newcommand{\thevector}[1]{{\left[ {#1} \right]}}
\newcommand{\tv}[1]{{\left[ {#1} \right]}}
\newcommand{\too}[1]{{\xrightarrow{#1}}}
\newcommand{\transverse}[0]{\pitchfork}
\newcommand{\trianglerightneq}{\mathrel{\ooalign{\raisebox{-0.5ex}{\reflectbox{\rotatebox{90}{$\nshortmid$}}}\cr$\triangleright$\cr}\mkern-3mu}}
\newcommand{\tr}[0]{\operatorname{Tr}}
\newcommand{\uniformlyconverges}[0]{\rightrightarrows}
\newcommand{\abuts}[0]{\Rightarrow}
\newcommand{\covers}[0]{\rightrightarrows}
\newcommand{\units}[0]{^{\times}}
\newcommand{\nonzero}[0]{^{\bullet}}
\newcommand{\wait}[0]{{\,\cdot\,}}
\newcommand{\wt}[0]{{\operatorname{wt}}}
\renewcommand{\bar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}
\renewcommand{\div}[0]{\operatorname{Div}}
\newcommand{\Div}[0]{\operatorname{Div}}
\newcommand{\Prin}[0]{\operatorname{Prin}}
\newcommand{\Frac}[0]{\operatorname{Frac}}
\renewcommand{\hat}[1]{\widehat{#1}}
\renewcommand{\mid}[0]{\mathrel{\Big|}}
\renewcommand{\qed}[0]{\hfill\blacksquare}
\renewcommand{\too}[0]{\longrightarrow}
\renewcommand{\vector}[1]{\mathbf{#1}}
\newcommand*\dif{\mathop{}\!\operatorname{d}}
\newcommand{\ddt}{\tfrac{\dif}{\dif t}}
\newcommand{\ddx}{\tfrac{\dif}{\dif x}}
\renewcommand{\labelitemiii}{$\diamondsuit$}
\renewcommand{\labelitemiv}{$\diamondsuit$}
\newcommand\vecc[2]{\textcolor{#1}{\textbf{#2}}}
\newcommand*{\vertbar}{\rule[-1ex]{0.5pt}{2.5ex}}
\newcommand*{\horzbar}{\rule[.5ex]{2.5ex}{0.5pt}}
\newcommand\aug{\fboxsep=-\fboxrule\!\!\!\fbox{\strut}\!\!\!}
\newcommand\rref{\operatorname{RREF}}
\newcommand{\interior}[0]{^\circ}
\newcommand{\increasesto}[0]{\nearrow}
\newcommand{\decreasesto}[0]{\searrow}
\newcommand\jan{\operatorname{Jan}}
\DeclareMathOperator{\righttriplearrows} {{\; \tikz{ \foreach \y in {0, 0.1, 0.2} { \draw [-stealth] (0, \y) -- +(0.5, 0);}} \; }}
\DeclareMathOperator{\Exists}{\exists}
\DeclareMathOperator{\Forall}{\forall}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclareMathOperator*{\hocolim}{hocolim}
\DeclareMathOperator*{\mapbackforth}{\rightleftharpoons}
\DeclareMathOperator*{\eq}{=}
\DeclareMathOperator{\Endo}{End}
\DeclareMathOperator{\Ind}{Ind}
\DeclareMathOperator{\ind}{Ind}
\DeclareMathOperator{\coind}{Coind}
\DeclareMathOperator{\proj}{Proj}
\DeclareMathOperator{\Proj}{Proj}
\DeclareMathOperator{\res}{Res}
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\Hol}{Hol}
\DeclareMathOperator{\Br}{Br}
\DeclareMathOperator{\coh}{coh}
\DeclareMathOperator{\colspace}{colspace}
\DeclareMathOperator{\rowspace}{rowspace}
\DeclareMathOperator{\codom}{codom}
\DeclareMathOperator{\range}{range}
\DeclareMathOperator{\nullspace}{nullspace}
\DeclareMathOperator{\nullity}{nullspace}
\DeclareMathOperator{\projection}{Proj}
\DeclareMathOperator{\Der}{Der}
\newcommand{\Suchthat}[0]{\middle\vert}
\newcommand{\suchthat}[0]{{~\mathrel{\Big|}~}}
\newcommand{\delbar}[0]{\bar{\del}}


\newcommand{\contains}[0]{\supseteq}
\newcommand{\containing}[0]{\supseteq}

\newcommand{\cat}[1]{\mathcal{#1}}
\newcommand{\thecat}[1]{\mathbf{#1}}
\newcommand{\sheaf}[1]{\operatorname{\mathcal{#1}}}

\newcommand\rrarrows{\rightrightarrows}
\newcommand\rrrarrows{
    \mathrel{\substack{\textstyle\rightarrow\\[-0.6ex]
        \textstyle\rightarrow \\[-0.6ex]
        \textstyle\rightarrow}}
}

\newcommand{\colim}{\operatornamewithlimits{\underset{\longrightarrow}{colim}}}


\newcommand\fp[1]{\underset{\scriptscriptstyle {#1} }{\times}}
\newcommand\ul[1]{\underline{#1}}
\newcommand\ol[1]{\overline{#1}}
\newcommand\univcover[1]{\overline{#1}}
\newcommand\capprod{\frown}
\newcommand\Path{\mathcal{P}}
\newcommand\gradient{\nabla}

\newcommand\Hc[0]{{\check{H}}}
\newcommand\Cc[0]{{\check{C}}}
\newcommand\cupp[0]{\smile}
\newcommand\capp[0]{\frown}
\newcommand\sig[0]{\operatorname{sig}}

\def\contradiction
{
\tikz[baseline, x=0.2em, y=0.2em, line width=0.04em]
\draw (0,0) -- ({4*cos(45)},{4*sin(45)})
    (-1,1) -- ({-1 + 4*cos(45)},{1 + 4*sin(45)})
    (-1,3) -- ({-1 + 4*cos(315)},{3 + 4*sin(315)})
    (0,4) -- ({0 + 4*cos(315)},{4 + 4*sin(315)});
}

# Thursday, January 14

See website for notes on books, intro to class.

- Youtube Playlist: <https://www.youtube.com/playlist?list=PLA0xtXqOUji8fjQysx4k8a6h-hOZ7x5ue>

- Free copies of textbook: <https://www.dropbox.com/sh/rv5j222kn74bjhm/AABZ1qcR1rOnpaBsa5CL3P_Ea?dl=0&lst=>

- Course website: ?

Paul's description of the course:

"This course is an introduction to arithmetic "beyond $\ZZ$", specifically arithmetic in the ring of “integers” in a finite extension of $\QQ$.  (Among many other things) we’ll prove three important theorems about these rings: 

 - Unique factorization into ideals. 
 - Finiteness of the group of ideal classes. 
 - Dirichlet’s theorem on the structure of the unit group."

## Motivation

Solving Diophantine equations, i.e. polynomial equations over $\ZZ$.


:::{.example title="?"}
Consider $y^2 = x^3 + x$.


:::{.claim}
$(x, y) = (0, 0)$ is the only solution.
:::

To see this, write $y^2 = x(x^2+1)$, which are relatively prime, i.e. no $D\in \ZZ$ divides both of them.
Why?
If $d \divides x$ and $d \divides x+1$, then $d\divides (x^2+1) + (-x) = 1$.
It's also the case that both $x^2+1$ and $x^2$ are squares (up to a unit), so $x^2, x^2 + 1$ are consecutive squares in $\ZZ$.
But the gaps between squares are increasing: $1, 2, 4, 9, \cdots$.
The only possibilities would be $x=0, y=1$, but in this case you can conclude $y=0$. 

:::


:::{.example title="Fermat"}
Consider $y^2 = x^3-2$.


:::{.claim}
$(3, \pm 5)$ are the only solutions.
:::

Rewrite 
\[
x^3 = y^2+2 &= (y+ \sqrt{-2})(y - \sqrt{-2}) \\ 
&\in
\ZZ[\sqrt{-2}] \da \ts{a+b\sqrt{-2} \st a,b,\in \ZZ} \leq \CC
.\] 
This is a subring of $\CC$, and thus at least an integral domain.
We want to try the same argument: showing the two factors are relatively prime.
A little theory will help here:

:::{.definition title="Norm Map"}
For \( \alpha\in \ZZ[\sqrt{-2}] \) define $N \alpha = \alpha\bar \alpha$.
:::

:::{.lemma title="?"}
Let \( \alpha, \beta \in \ZZ[\sqrt{-2}] \).
Then 

1. \( N(\alpha \beta) = N(\alpha) N(\beta) \)
2. $N( \alpha) \in \ZZ_{\geq 0}$ and $N(\alpha) = 0$ if and only if \( \alpha= 0 \).

3. \( N(\alpha) = 1 \iff \alpha\in R\units \) 
:::

:::{.proof title="?"}

1. Missing, see video (10:13 AM).

2. \( N(\alpha) = a^2 + 2b^2 \geq 0 \), so this equals zero if and only if \( \alpha= \beta= 0 \)  

3. Write \( 1 = \alpha\bar \alpha \) if \( N(\alpha) = 1 \in R\units\).
Conversely if \( \alpha\in R\units \) write \( \alpha \beta = 1 \), then 
\[ 
1 = N(1) = N(\alpha \beta) = N(\alpha ) N(\beta ) \in \ZZ_{\geq 0} 
,\] 
which forces both to be 1.


:::


:::{.claim}
The two factors \( y \pm \sqrt 2 \) are *coprime* in \( \ZZ[\sqrt{-2}] \), i.e. every common divisor is a unit.
:::


:::{.proof title="?"}



Suppose \( \delta\divides y\pm \sqrt{-2} \), then \( y + \sqrt{-2} = \delta \beta \) for some \( \beta\in \ZZ[\sqrt{-2}] \).
Take norms to obtain 
\( y^2 + 2 = N \delta N \beta \), and in particular 

- \( N \delta y^2 +2 \) 
- \( \delta \divides (y+ \sqrt{-2} ) - (y - \sqrt{-2} ) = 2 \sqrt{-2} \) and thus \( N \delta \divides N(2 \sqrt{-2} ) = 8 \).

In the original equation \( y^2 = x^3-2 \), if $y$ is even then $x$ is even, and $x^3 - 2 \equiv 0-2 \mod 4 \equiv 2$, and so $y^2 \equiv 2 \mod 4$.
But this can't happen, so $y$ is odd, and we're done: we have \( N \delta\divides 8 \) which is even or 1, but \( N \delta\divides y^2 +2 \) which is odd, so \( N \delta = 1 \).

:::

We can identify the units in this ring:
\[
\ZZ[\sqrt{-2} ]\units = \ts{ a + b \sqrt{-2} \st a^2 + 2b^2 = 1}
\]
which forces $a^2 \leq 1, b^2 \leq 1$ and thus this set is $\ts{\pm 1}$.

So we have \( x^3 = ab \) which are relatively primes, so $a,b$ should also be cubes.
We don't have to worry about units here, since $\pm 1$ are both cubes.
So e.g. we can write 
\[
y + \sqrt{-2} = (a + b \sqrt{-2} )^3 = (a^3-6ab^2) + (3a^2b -2b^3) \sqrt{-2}
.\]
Comparing coefficients of 
\( \sqrt{-2} \)  yields 
\[ 1 = b(3a^2b - 2b^2) \in \ZZ \implies b \divides 1
,\] and thus $b\in \ZZ\units$, i.e. $b\in \ts{\pm 1}$.
By cases:

- If $b=1$, then $1 = 3a^2 -2 \implies a^2 = 1 \implies a = \pm 1$.
  So 
\[
y = \sqrt{-2} = (\pm 1 + \sqrt{-2} )^3 = \pm 5 + \sqrt{-2}
,\] 
  which forces $y=\pm 5$, the solution we already knew.

- If $b = -1$, then \( 1 = -(3a^2 - 1) \) which forces $1=3a^2 \in \ZZ$, so there are no solutions.

:::


:::{.example title="?"}
Consider $y^2 = x^3 - 26$.
Rewrite this as \[
x^3 = y^2 + 26 = (y + \sqrt{-26} )(y - \sqrt{-26} )
,\] 
then the same lemma goes through with $2$ replaced by $26$ everywhere where the RHS factors are still coprime.
Setting $y + \sqrt{-26} = (a + b \sqrt{-26} )^3$ and comparing coefficients, you'll find $b=1, a = \pm 3$.
This yields $x=35, y=\pm 207$.
But there are more solutions: $(x, y) = (3, \pm 1)$!
The issue is that we used unique factorization when showing that $ab$ is a square implies $a$ or $b$ is a square (say by checking prime factorizations and seeing even exponents).
In this ring, we can have $ab$ a cube with *neither* $a,b$ a cube, even up to a unit.
:::


:::{.question}
When does a ring admit unique factorization?
Do you even *need* it?
:::

This will lead to a discussion of things like the **class number**, which measure the failure of unique factorization.
In general, the above type of proof will work when the class number is 3!

# Lecture 2 (Tuesday, January 19)

Today: Ch.2 of the book, "Cast of Characters".
Note that all rings will be commutative and unital in this course.

Last time: looked at factorization in $\ZZ[\sqrt 2], \ZZ[\sqrt{26}]$. 
Where do rings like this come from?

:::{.definition title="Number Field"}
A **number field** is a subfield $K \subseteq \CC$ such that $[K: \QQ] < \infty$.
:::

:::{.remark}
Some authors don't require $K \subseteq \CC$, but any finite extension of $\QQ$ will embed into $\CC$ so there's no harm in this extra requirement.
:::

:::{.example title="?"}
$\QQ[\sqrt[3]{2}, \QQ[\sqrt 2, \sqrt[5]{7}]$ or $\QQ(\theta)$ where $\theta$ is a root of $x^5 - x - 1$ (which you can check is irreducible.
Now that the round vs. square brackets here won't make a difference, since we're adjoining algebraic numbers.
:::

:::{.proposition title="?"}
Let $K_{/\QQ}$ be a finite extension, say of degree $n\da [K: \QQ]$.
Then there are $n$ distinct embeddings
[^embedding_means]
of $K$ into $\CC$

[^embedding_means]: 
An injective ring morphism.

:::

:::{.proof title="?"}
We have $K_{/\QQ}$, which is necessarily separable since $\ch(\QQ) = 0$.
By the primitive element theorem, we can write $K = \QQ(\theta)$ where \( \theta \) is a root of some degree $n$ irreducible polynomial $f(x) \in \QQ[x]$.
Since $\CC$ is algebraically closed, $f$ splits completely over $\CC$ as \( f = \prod_{i=1}^n (x- \theta_i \) which each \( \theta_i \in CC \) distinct since $f$ was irreducible and we're in characteristic zero.
Then for each $i$ there is an embedding $K = \QQ[\theta]$ given by
\[
\iota_i: \QQ[\theta] &\injects \CC \\
g(\theta) &\mapsto g(\theta_i)
.\]
There are some easy things to check:

- This is well-defined: elements in $K$ are polynomials in \( \theta \) but they all differ by a multiple of the minimal polynomial of \( \theta \),
- This is an inject homomorphism and thus an embedding, and
- For distinct $i$ you get distinct embeddings: just look at the image $\iota_i(\theta)$, these are distinct numbers in $\CC$.

:::

:::{.definition title="Real and Nonreal embeddings"}
Let $K_{/\QQ}$ be a finite extension of degree $n = [K : \QQ]$.
We'll say an embedding \( \sigma:K \to \CC \) is **real** if \( \sigma(K) \subseteq \RR \) , otherwise we'll say the embedding is **nonreal**.
:::

:::{.remark}
If \( \sigma \) is a nonreal, then \( \bar \sigma \) is a nonreal embedding, so this embeddings come in pairs.
As a consequence, the total number of embeddings is given by $n = r_1 + 2r_2$, where $r_1$ is the number of real embeddings and $r_2$ is the number of nonreal embeddings.
:::

:::{.example title="?"}
Let $K = \QQ(\sqrt[3]{2})$.
Here $n=3$ since this is the root of a degree 3 irreducible polynomial.
Using the proof we can find the embeddings: factor 
\[
x^3 - 2 = (x - \sqrt[3]{2})(x - \omega \sqrt[3]{2}) (x - \omega^2 \sqrt[3]{2})
.\]
where \( \omega = e^{2\pi i / 3} \) is a complex cube root of unity.
We can form an embedding by sending $\sqrt[3]{2} \to \omega^j \sqrt[3]{2}$ for $j=0,1,2$.
The case $j=0$ sends $K$ to a subset of $\RR$ and yields a real embedding, but the other two will be nonreal. 
So $r_1 = 1, r_2 = 1$, and we have $3 = 1 + 2(1)$ and this is consistent.
:::

:::{.remark}
We've only been talking about fields, since unique factorization is trivial since there are no primes.
There are thus "too many" units, compared to the rings we were considering before, so we'll restrict to subrings.
The question is: where is the arithmetic?
Given a number field $K$, we want a ring $\ZZ_K$ that fits this analogy:


\begin{tikzcd}
\QQ \ar[dd] & \leadsto & K\ar[dd] \\
\\
\ZZ & \leadsto & \ZZ_K = ?
\end{tikzcd}

:::

:::{.definition title="Algebraic Numbers"}
Given \( \alpha\in \CC \) we say \( \alpha \) is an **algebraic number** if and only if \( \alpha \) is algebraic over $\QQ$, i.e. the root of some polynomial in $\QQ[x]$.
:::

:::{.remark}
We know that if we define $\bar \QQ \da \ts{\alpha\in \CC \st \alpha \text{ is algebraic over } \QQ}$, we can alternatively describe this as $\bar \QQ = \ts { \alpha\in \CC \st [\QQ(\alpha) : \QQ] < \infty }$.
This is convenient because it's easy to see that algebraic numbers are closed under sums and products, just using the ways degrees behave in towers.
:::

:::{.corollary title="?"}
$\bar \QQ \injects \CC$ is a subfield and every number field is a subfield of $\bar \QQ$.
:::

These are still fields, so lets define some interesting subrings.

:::{.definition title="$\bar \ZZ$ "}
Define $\bar \ZZ \da \ts{ \alpha\in \CC \st \alpha\text{ is the root of a monic polynomial }f\in \ZZ[x]}$.
:::

:::{.theorem title="$\bar \ZZ$ is a ring"}
$\bar \ZZ$ is a ring, and in fact a domain since it's a subring of $\CC$.
:::

We'll use an intermediate criterion to prove this:

:::{.proposition title="Integrality Criterion"}
Let \( \alpha\in \CC \) and suppose there is a finitely generated $\ZZ\dash$submodule of $\CC$ with \( \alpha M \subseteq M \neq 0\).
Then \( \alpha\in \bar \ZZ \), i.e. \( \alpha \) is the root of a monic polynomial with integer coefficients.
:::

:::{.proof title="of integrality criterion"}
Chasing definitions, take $M$ and choose a finite list of generators \( \beta_1, \beta_2, \cdots, \beta_m \) for $M$.
Then \( \alpha M \subseteq M \implies \alpha \beta_i \in M \) for all \( M \), and each \( \alpha \beta_i \) is a $\ZZ\dash$linear combination of the \( \beta_i \) .
I.e. we have
\[
\alpha 
\begin{bmatrix}
\beta_1 
\\
\vdots  
\\
\beta_n  
\end{bmatrix}
= 
\begin{bmatrix}
a_{11} & a_{12} & \cdots
\\
a_{21} &  a_{22} & 
\\
 \vdots &  &\ddots  
\end{bmatrix}
\begin{bmatrix}
\beta_1 
\\
\vdots  
\\
\beta_n  
\end{bmatrix}
\da A \vec{\beta}
,\]
where $A \in \Mat(n\times m, \ZZ)$.
We can rearrange this to say that 
\[
\qty{ \alpha \id - A} 
\begin{bmatrix}
\beta_1 
\\
\vdots  
\\
\beta_n  
\end{bmatrix}
=
\vector{0}
.\]
Not  all of the $\beta_i$ can be zero since $M\neq 0$, and thus \( \alpha \id - A \) is singular and thus has determinant zero, so $\det(x \id - A)\evalfrom_{x=a} = 0$.
We have 
\[
x\id - A = 
\begin{bmatrix}
x - a_{1,} &  & &
\\
&  x - a_{2, 2} & & 
\\
&  & \ddots &
\\
& &  & x - a_{m, m}
\end{bmatrix}
,\]
where the off-diagonal components are constants in $\ZZ$ coming from $A$.
Taking the determinant yields a monic polynomial: the term of leading degree comes from multiplying the diagonal components, and expanding over the remaining minors only yields terms of smaller degree.
So $\det (x\id - A) \in \ZZ[x]$ is monic.

:::

:::{.proof title="of theorem"}
We want to show that \( \bar \ZZ \) is a ring, and it's enough to show that 

- \( 1\in \bar \ZZ \), which is true since $x-1$ is monic.
- It's closed under $+, \cdot$.

Note that the first property generalizes to $\ZZ \subseteq \bar \ZZ$, since $x-n$ is monic for any $n\in \ZZ$.
For the second, let \( \alpha, \beta \in \bar \ZZ \).
Define $M \da \ZZ[\alpha, \beta]$, then it's clear that \( (\alpha + \beta)M \subseteq M \) and \( (\alpha \beta)M \subseteq M \) since $\ZZ[\alpha, \beta]$ are polynomials in \( \alpha, \beta \) and multiplying by these expression still yields such polynomials.
It only remains to check the following:

:::{.claim}
$M$ is finitely-generated.
:::


:::{.proof title="?"}
Let \( \alpha \) be a root of $f \in \ZZ[x]$ and \( \beta \) a root of $g$, both monic with $\deg f = n, \deg g = m$.
We want to produce a finite generating set for \( M\da \ZZ[\alpha, \beta] \), and the claim is that the following works: \( \ts{ \alpha^i \beta^j} _{\substack{0\leq i < n \\ 0 \leq j < m} } \), i.e. every element of $M$ is some $\ZZ\dash$linear combination of these.

Note that this is clearly true if we were to include $n, m$ in the indices by collecting terms of any polynomial in \( \alpha, \beta \), so the restrictions are nontrivial.
It's enough to show that for any $0 \leq I, J \in \ZZ$, the term \( \alpha^I \beta^J \) is a $\ZZ\dash$linear combination of the restricted elements above.
Divide by $f$ and $g$ to obtain $x^I = f(x) q(x) + r(x)$ and $x^J = g(x) \tilde q(x) \tilde r(x)$ where $r(x) = 0$ or $\deg r < n$ and similarly for $\tilde r$, where (importantly) all of these polynomials are in $\ZZ[x]$.

We're not over a field: $\ZZ[x]$ doesn't necessarily have a division algorithm, so why is this okay?
The division algorithm only requires inverting the leading coefficient, so in general $R[x]$ admits the usual division algorithm whenever the leading coefficient is in $R\units$.

Now plug \( \alpha \) into the first equation to obtain \( \alpha^I = r(\alpha) \) where $\deg r < n$, which rewrite \( \alpha^I \) as a sum of lower-degree terms.
Similarly writing \( \beta^J = r(\beta) \), we can express 
\[
\alpha^I \beta^J = r(\alpha) r(\beta)
,\]
which is what we wanted.

:::


:::

:::{.remark}
We've just filled in another part of the previous picture:

\begin{tikzcd}
\QQ \ar[dd] & K\ar[dd] & \bar \QQ \ar[dd]\\
\\
\ZZ & \ZZ_K & \bar \ZZ
\end{tikzcd}

:::

:::{.definition title="Ring of Integers"}
Define $\ZZ_K = \bar \ZZ \intersect K$, the **ring of integers** of $K$.
Note that this makes sense since the intersection of rings is again a ring.
:::

:::{.remark}
Why not just work in $\bar \ZZ$?
It doesn't have the factorization properties we want, e.g. there are no irreducible elements.
Consider $\sqrt 2$, we can factor is into two non-units (noting that $\sqrt 2$ is not a unit) as $\sqrt{\sqrt 2} \cdot \sqrt{\sqrt 2}$, and it's easy to check that if $a$ is not a unit then $\sqrt a$ is not a unit.
So this would yield arbitrarily long factorizations, and is thus not Noetherian.
:::

The following is a reality check, and certainly a property we would want:

:::{.proposition title="The ring of integers of $\QQ$ is $\ZZ$ "}
$\ZZ_\QQ = \ZZ$.
:::

:::{.proof title="of proposition"}
\( \subseteq \): easy, since \( \ZZ \subseteq \bar \ZZ \) and \( \ZZ \subseteq \QQ \), and is thus in their intersection \( \ZZ_\QQ \) .

\( \supseteq \) : Let \( \alpha\in \ZZ_\QQ = \QQ \intersect\bar \ZZ \) , so \( \alpha \) is a root of \( x^n - a_{n-1}x^{n-1} + \cdots + a_1x + a_0 \in \ZZ[x] \).
We know \( \alpha= a/b \) with \( a,b \in \ZZ \), and we can use the rational root test which tells us that \( a\divides a_0, b\divides 1 \), so \( b = \pm 1, \alpha = a/\pm 1 = \pm a \in \ZZ \) and thus \( \alpha \in \ZZ \).

:::

We'll want to study $\ZZ_K$ for various number fields $K$, but we'll need more groundwork.

:::{.proposition title="Easy criterion to check if an integer is algebraic"}
Let \( \alpha \in \bar \QQ \), then \[ \alpha\in \bar \ZZ \iff \min_ \alpha \in \ZZ[x], \] where \( \min_ \alpha(x) \) is the unique monic irreducible polynomial in $\QQ[x]$ which vanishes at \( \alpha \).
:::

:::{.proof title="?"}
$\impliedby$: Trivial, if the minimal polynomial already has integer coefficients, just note that it's already monic and thus \( \alpha \in \bar \ZZ \) by definition.

$\implies$: Why should the minimal polynomial have *integer* coefficients?
Choose a monic $f(x) \in \ZZ[x]$ with \( f(\alpha) = 0 \), using the fact that \( \alpha\in \bar \ZZ \) , and factor \( f(x) = \prod_{i=1}^n (x- \alpha_i) \in \CC[x] \).
Note that each \( \alpha_i \in \bar \ZZ \) since they are all roots of $f$ (a monic polynomial in \( \ZZ[x] \)).
Use the fact that \( \min_ \alpha(x) \) divides every polynomial which vanishes on \( \alpha \) over $\QQ$, and thus divides $f$ (noting that this still divides over $\CC$).
Moreover, every root of \( \min_ \alpha(x) \) is a root of $f$, and so every such root is some \( \alpha_i \).

Now factor \( \min_ \alpha(x) \)  over \( \CC \) to obtain \( \min_ \alpha(x) = \prod_{i=1}^m (x - \beta_i) \) with all of the \( \beta_i \in \bar \ZZ \).
What coefficients appear after multiplying things out?
Just sums and products of the \( \beta_i \), so all of the coefficients are in \( \bar \ZZ \) . 
Thus \( \min_ \alpha(x) \in \bar \ZZ [x] \).
But the coefficients are also in $\QQ$ by definition, so the coefficients are in $\bar \ZZ \intersect\QQ = \ZZ$ and thus \( \min_ \alpha(x) \in \ZZ[x] \).
:::

:::{.example title="Showing an integer is not algebraic using minimal polynomials"}
$\sqrt{5}/ 3 \not\in \bar \ZZ$ since $\min_ \alpha(x) = x^2 - 5/9 \not\in \ZZ[x]$, so this is not an algebraic integer.
:::

:::{.proposition title="$\ff(\ZZ_K) = K$ "}
\envlist

a. $\bar \ZZ$ has $\bar \QQ$ as its fraction field, and
b. For any number field $K$, $\ZZ_K$ has $K$ as its fraction field.

Moreover, both of these statements follow from:

c. If \( \alpha\in \bar \QQ \) then \( d \alpha\in \bar \ZZ \) for some \( d\in \ZZ^{\geq 0} \) 
:::

:::{.remark}
Thus the subring is "big" in the sense that if you allow taking quotients, you recover the entire field.
That $c\implies a,b$: suppose you want to write $\alpha \in \bar \QQ$ as $\alpha=p/q$ with $p,q \in \bar \ZZ$.
Use $c$ to produce $d\alpha\in \bar \ZZ$, then just take $d\alpha /d$.
The same argument works for $b$.
:::

:::{.exercise title="?"}
Prove the proposition!
:::

:::{.proposition title="?"}
Suppose \( \alpha\in \bar \CC \) and \( \alpha \) is a root of a monic polynomial in \( \bar{\ZZ} [x] \).
Then \( \alpha\in \bar \ZZ \).
:::

:::{.remark}
This says that if a number \( \alpha \) is the root of a monic polynomial whose coefficients are *algebraic* integers, then \( \alpha \) itself is an algebraic integer coefficients.
This corresponds to the fact that integral over integral implies integral in commutative algebra.

:::

:::{.exercise title="Prove the proposition."}
Prove this!
Can use the integrality criterion (slightly challenging), can also use Galois theory.

:::

















# Lecture 3 (Thursday, January 21)

Today: roughly corresponds to chapter 3 in the book.
Goal: do all of the big theorems in the setting of quadratic number fields, then redo everything for general number fields.

## Quadratic Number Fields

Simplest case: $\QQ$, a degree 1 number field, so the next simplest case is degree 2.

:::{.definition title="Quadratic Number Fields"}
A field $K$ is a **quadratic number field** if and only if $K$ is a number field and $[K: \QQ] = 2$.
:::

:::{.remark}
Some notation: if $d\in \RR\units$, then $\sqrt d$ means the *positive* square root of $d$ if $d \geq 0$, and if $d<0$ this denotes $i\sqrt{\abs{d}}$.
:::

:::{.proposition title="?"}
If $K$ is a quadratic number field, then $K = \QQ(\sqrt{d})$ for some squarefree 
[^note_squarefree]
$d\in \ZZ$.
Moreover, this $d$ is uniquely determined by $K$, so all quadratic number fields are parameterized by the set of squarefree integers.

[^note_squarefree]: 
*Squarefree* means not divisible by $n^2$ for any $n > 1\in \ZZ$, or equivalently not divisible by the square of any primes.

:::

:::{.proof title="?"}
**Existence**: 
Since $[K: \QQ] = 2$, we have $K\supsetneq \QQ$ so pick \( \alpha\in K\sm \QQ \) then $K = \QQ(\alpha)$.
Note that we could also furnish this \( \alpha \) from the primitive element theorem, although this is overkill here.
So \( \alpha \) is a root of some degree 2 $p\in \QQ[x]$, and by scaling coefficients we can replace this by $p\in \ZZ[x]$.
So write $p(x) = Ax^2 + Bx + C$, in which case we can always write \( \alpha = {-B \pm \sqrt{B^2 - 4AC} \over 2A} \) where $A\neq 0$ since this would imply that \( \alpha\in\QQ \).
Writing \( \Delta\da B^2 - 4AC \), we have $K = \QQ(\alpha) = \QQ(\sqrt{\Delta})$.
This is close to what we want -- it's $\QQ$ adjoin some integer -- but we'd like it to be squarefree.

Now let $f\in \ZZ^{\geq 0}$ be chosen such that $f^2 \divides \Delta$ and $f$ is as large as possible, i.e. the largest square factor of \( \Delta \).
Writing \( \Delta = f^2 - d \) where $d$ is whatever remains.
Then $d$ must be squarefree, otherwise if $d$ had a square factor bigger than 1, say $d = r^2 d'$, in which case $f^2 r^2 > f^2$ would be a larger factor of \( \Delta \).
So $d$ is squarefree, and \( \Delta = f \sqrt d \) and thus \( \QQ(\Delta) = \QQ(\sqrt{d}) \).

**Uniqueness**: 
Well use some extra machinery.


:::{.definition title="Norm and Trace"}
Let $K$ be a number field with $K_{/\QQ}$ Galois.
For each \( \alpha\in K \) define
\[
N(\alpha) &\da \prod_{\sigma\in \Gal(K_{/\QQ})} \sigma(\alpha) && \text{the norm} \\
\Tr(\alpha) &\da \sum_{\sigma\in \Gal(K_{/\QQ})} \sigma(\alpha) && \text{the trace}
.\]
:::


:::{.remark}
Why use these kind of sum at all?
Applying any element in the Galois group just permutes the elements.
Note that $N( \alpha), \Tr( \alpha)$ are $G(K_{/\QQ})\dash$invariant, and thus rational numbers in $\QQ$.
The norm is multiplicative, and the trace is additive and in fact $\QQ\dash$linear: $\Tr(a \alpha + b \beta) = a \Tr( \alpha) + b \Tr( \beta)$ for all \( \alpha, \beta\in K \) and all \( a,b \in \QQ \).
:::

What do the norm and trace look like for a quadratic field?
We can write $K = \ts{a + b \sqrt d \st a,b \in \QQ}$ and there is a unique (non-identity) element \( g\in \Gal(K_{/\QQ}) \) with \( \sigma(a + b \sqrt d = a - b \sqrt{d} \).
We'll refer to this automorphism as **conjugation**.
We can compute
\[
N(a + b \sqrt{d} ) &= a^2 - db^2 \\
\Tr(a + b \sqrt{d} ) &= 2a
.\]

Returning to the proof, suppose otherwise that $K = \QQ(\sqrt{d_1} ) = \QQ ( \sqrt{d_2} )$ with $d_1\neq d_2$ squarefree integers.
Note that they must have the same sign, otherwise one of these extensions would not be a subfield of $\RR$.
We know \( \sqrt{d_1} \in \QQ( \sqrt{d_2} ) \) and thus \( \sqrt{d_1} = a + b \sqrt{d_2} \) for some $a, b\in \QQ$.
Taking the trace of both sides, the LHS is zero and the RHS is $2a$ and we get $a=0$ and \( \sqrt{d_1} = b \sqrt{d_2} \).
Write $b = u/v$ with $u,v\in \QQ$.
Squaring both sides yields $v^2 d_1 = u^2 d_2$.
Let $p$ be a prime dividing $d_1$; then since $d_1$ is squarefree there is only one copy of $p$ occurring in its factorization.
Moreover there are an even number of copies of $p$ coming from $v^2$, thus forcing $d_2$ to have an odd power of $p$.
This forces $p\divides d_2$, and since this holds for every prime factor $p$ of $d_1$, we get $d_1 \divides d_2$ since $d_1$ is squarefree.
The same argument shows that $d_2 \divides d_1$, so they're the same up to sign: but the signs must match and we get $d_1 = d_2$.

:::

Note that this results holds for every squarefree number not equal to 1.


:::{.question}
If $K = \QQ( \sqrt{d} )$, what is the ring of integers $\ZZ_K$?
Some more machinery will help here.
:::

:::{.definition title="The Field Polynomial of an Element"}
Assume $K_{/\QQ}$ is a Galois number field and for \( \alpha\in K \) define 
\[
\varphi_{\alpha}(x) \da \prod_{ \sigma\in \Gal(K_{/\QQ})} \qty{ x - \sigma(\alpha)}
.\]

:::

:::{.remark}
For the same reasons mentioned for the norm/trace, we get \( \varphi_{\alpha} \in \QQ[x] \), and moreover \( \varphi_{ \alpha } (\alpha) = 0 \).
:::

When is \( \alpha\in \ZZ_K \)? 
We have the following criterion:


:::{.proposition title="?"}
\[
\alpha\in \ZZ_K \iff \varphi_{ \alpha } (x) \in \ZZ[x]
.\]

:::


:::{.proof title="?"}
$\impliedby$:
This is easy, since if \( \varphi_\alpha \) is a monic polynomial with integer coefficients, meaning that \( \alpha \) is an algebraic integer and thus in $\ZZ_K$.

$\implies$:
If \( \alpha \in \ZZ_K \) then it's the root of some monic polynomial in $\ZZ[x]$, and the same is true for \( \sigma(\alpha) \) and thus each \( \sigma(\alpha) \in \bar\ZZ \).
So \( \varphi_{ \alpha}(x) \in \bar \ZZ[x] \).
We said \( \varphi_{ \alpha} \) has coefficients in $\QQ$ too, and thus in $\bar \ZZ \intersect \QQ = \ZZ$.
So the problem is reduced to finding out when \( \varphi_{\alpha}(x) \) has integer coefficients.

If $\deg(K_{/\QQ}) = n$, then 
\[
\varphi_{ \alpha}( \alpha) = \prod x- \sigma(\alpha) = x^n - \Tr(\alpha)x^{n-1} + \cdots + (-1)^n N( \alpha)
.\]
If $n=2$, these are the only terms, and so if $K$ is a quadratic number field then \( \alpha\in K \) is in $\ZZ_K$ if and only if $\Tr( \alpha), N(\alpha) \in \ZZ$.
:::




:::{.example title="?"}
Let $K = \QQ( \sqrt{5} )$, then is it true that $\ZZ_K = \ZZ[\sqrt{5} ]$?
Since $1, \sqrt{5} \in \ZZ_K$, we have $\supseteq$ since $1, \sqrt{5}$ are algebraic.
The answer is **no**: take \( \alpha\da {1 + \sqrt{5} \over 2} \), then \( N( \alpha) -4/4 = -1 \) and \( \Tr( \alpha) = 1 \).
These are integers, so \( \alpha\in \ZZ_K \), and in fact \( \alpha \) is a root of $x^2 - x - 1 \in \ZZ[x]$.
:::


:::{.theorem title="?"}
Let $K = \QQ( \sqrt{d} )$ be a quadratic number field.
Then if $d = 2,3 \mod 4$, then $\ZZ_K = \ts { a + b \sqrt{d} \st a, b\in \ZZ}$.
If $d=1 \mod 4$, then $\ZZ_K = \ts{ {1 + b \sqrt{d} \over 2} \st a,b\in \ZZ,\, a\equiv b \mod 2}$.
:::


:::{.remark}
For $d=1$, if $a, b$ are even then we just recover the $d=2,3$ case, so we're picking up extra elements from when $a,b$ both odd.
:::


:::{.proof title="?"}
Let \( \alpha\in K \) and write \( \alpha = A + B \sqrt{d} \) with $A, B\in \QQ$.


:::{.exercise title="?"}
Check that \( N( \alpha), \Tr( \alpha) \in \ZZ \) for both cases.
:::

Assuming now that $N( \alpha), \Tr( \alpha) \in \ZZ$, then $A^2 - dB^2 \in \ZZ$.
Multiply this by 2 to get $(2A)^2 - d(2B)^2 \in 4\ZZ$.
Recalling that \( \Tr( \alpha) = 2 A \), we have $(2A)^2 \in \ZZ$ and thus $d(2B)^2 \in \ZZ$ as well.
The claim now is that $2B \in \ZZ$: we know $2B\in \QQ$.
If $2B\not\in \ZZ$, then the denominator has some prime factor.
This prime factor appears twice in $(2B)^2$, and $d(2B)^2 \in \ZZ$ then means that two copies of $p$ appear in $d$ in order to cancel -- however, we assumed $d$ was squarefree.
We now know that $A, B \in {1\over 2}\ZZ$, so write $A = (1/2)a'$ and $B = (1/2)b'$.
Writing \( \alpha= (1/2)a' + (1/2)b' \sqrt{d} \), we find that $N( \alpha) = ((a')^2 - d(b')^2) / 4 \in \ZZ$.
So the numerator is a multiple of 4, which yields $(a')^2 \equiv d(b')^2 \mod 4$.
We proceed by cases.

**Case 1:**
$d = 2,3 \mod 4$.
If $b'$ is odd then $(b')^2 = 1\mod 4$, which holds for any odd number.
But then $(a')^2 = d(b')^2 = d \mod 4$, which is a problem -- squares modulo 4 can only be $0$ or $1$.
This is a contradiction, so $b'$ must be even.
Then $(b')^2 \mod 4 = 0$, which forces $a' \equiv 0 \mod 4$ and $a'$ must be even.
But if $a', b'$ are both even, $(1/2)a', (1/2)b'\in \ZZ$ and we obtain \( \alpha\in \ZZ + \sqrt{d} \ZZ \) .


**Case 2:**
If $d\equiv 1 \mod 4$, then $(a')^2 \equiv (b')^2 \mod 4$.
We can conclude that $a', b'$ are either both odd or both even, otherwise we'd get $0\equiv 1 \mod 4$, and thus we can write $a' \equiv b' \mod 2$.
But this was exactly the condition appearing in the theorem.
:::


:::{.remark}
Let $K$ be a quadratic number field.
Then we can reformulate the previous results as:

\[
\ZZ_K = 
\begin{cases}
\ZZ[ \sqrt{d} ] &  d \equiv 2,3 \mod 4
\\
\ZZ\left[{1 + \sqrt{d} \over 2}\right] & d \equiv 1 \mod 4.
\end{cases}
\]

We've also shown that $\ZZ_K$ is a free \(\ZZ\dash\)module of rank 2, with basis either \( \ts{ 1, \sqrt{d} } \) or \( \ts{ 1, {1 + \sqrt{d} \over 2 } } \).
:::


:::{.remark}
What is true for general number fields?
Important theorem: $\ZZ_K$ is always a free \(\ZZ\dash\)module, i.e. there always exists an *integral basis*.
Surprisingly, the it's not always true that $\ZZ_K = \ZZ[\ell]$ for $\ell$ a single element.
:::









# Lecture 4 (Wednesday, January 27)

Today: the failure of unique factorization.
Roughly corresponds to chapter 4: "Paradise Lost"!

Setup: $K$ is a quadratic field, a degree 2 extension of $\QQ$, which can be written as $K = \QQ(\sqrt{d})$ with $d$ squarefree.
Last time, we completely described $\ZZ_K$ (the algebraic integers in $K$):
\[
\ZZ_K = 
\begin{cases}
\ZZ[ \sqrt{d} ] &  d \equiv 2,3 \mod 4
\\
\ZZ\left[{1 + \sqrt{d} \over 2}\right] & d \equiv 1 \mod 4.
\end{cases}
\]
We saw that the second admitted a different description as $\ts{ {a + b \sqrt{d} \over 2}}$ where $a,b$ are either both even or both odd.
Note that we can do interesting arithmetic in $\ZZ_K$, but it's not necessarily well-behaved: $\ZZ_K$ is not always a UFD.
Letting $d=-5$, we have $\ZZ_K = \ZZ[ \sqrt{-5} ]$ where $6$ factors in two ways: $6 = (1 + \sqrt{5} )(1 - \sqrt{-5} ) = (2)(3) = 6$.

Note that this isn't quite enough to show failure of unique factorization, e.g. we can factor $16 = (4)(4) = (2)(8)$.
Here you should check that all 4 factors are irreducible, and that the factors on the right aren't unit multiples of the ones on the left.
For example, $21 = (-7)(-3) = (7)(3)$, but the factors only differ by the unit $-1\in \ZZ\units$.
The key to checking all of those: the **norm map**:
\[
N(a + b \sqrt{-5} ) = (a + b \sqrt{-5} ) (a - \sqrt{-5} ) = a^2 + 5b^2
.\]
where the second factor was the *conjugate*, i.e. the image of the element under the nontrivial element of the Galois group of $K_{/\QQ}$.
If $a + b \sqrt{-5} \in \ZZ_K$, then $N(a + b \sqrt{-5} \in \ZZ_{\geq 0}$ and is equal to zero if and only if $a + b \sqrt{-5} = 0$.
Moreover, this is a unit if and only if its norm is 1,
[^why_norm_argument]
i.e. $a^2 + 5b^2 = 1$, which forces $b=0$ and $a=\pm 1$.
So $U(\ZZ[ \sqrt{-5} ] ) = \ts{\pm 1}$.


[^why_norm_argument]: 
$\impliedby$: If the norm is 1, the conjugate is the inverse. 
For the reverse direction, the argument was more complicated, and reduced to showing norms of units are $\pm 1$, and positivity forces it to be $1$.


We'll show one of the factors is irreducible, $1 + \sqrt{-5}$.
Recall that $x\in R$ a domain is *irreducible* if and only if whenever $x = ab$, one of $a,b$ is a unit.
It itself is not a unit, since $N(1 + \sqrt{-5 }) = 6 \neq 1$.
So suppose $1 + \sqrt{-5} = \alpha \beta$.
Then
\[
6 = N(\alpha \beta ) = N( \alpha) N( \beta)
,\]
and so up to reordering, we have $N \alpha = 2, N \beta= 3$.
Writing \( \alpha= a + b \sqrt{-5} \)  and taking norms yields $2 = a^2 + 5b^2$, which has no solutions: considering the equation $\mod 5$ yields $2\equiv a^2$, but $2$ is not a square in $\ZZ/5\ZZ$.
$\contradiction$

Note that the only other way of factoring $6$ is $6=(1)(6)$, and taking norms shows that one factor is a unit.
So if we assume \( \alpha, \beta \)  aren't units, both $N \alpha, N \beta > 1$, which leads to the previous situation.
By similar arguments, all 4 factors are irreducible.

To see that the LHS factors aren't unit multiples of the RHS factors, we can use the fact that the units are $\pm 1$, and multiplying the LHS by $\pm 1$ can't yield $2$ or $3$.
So this is a genuine counterexample to unique factorization.

## Factorization Theory

What went wrong in the previous example?
We'll use a big of terminology from an area of algebra called *factorization theory*.
Many concepts related to divisibility can be discussed in this language!

:::{.definition title="Monoid"}
A **monoid** is a nonempty set with a commutative associative binary operation $\cdot$ with an identity $1$.
We say a monoid is **cancellative** if and only if whenever \( \alpha \beta= \beta \alpha \) or \( \beta \alpha = \gamma \alpha \) then \( \beta = \gamma \).
:::


:::{.definition title="Terminology for Cancellative Monoids"}
A bunch of definitions: let $M$ be a cancellative monoid.

- \( \alpha\divides \beta \) if and only if \( \beta= \alpha \gamma \) for some \( \gamma \).
- \( \epsilon \) is a **unit** if \( \epsilon\divides 1 \).
- \( \alpha , \beta \) are **associates** if \( \alpha = \epsilon \beta \) for some unit \( \epsilon \) 
- \( \pi\in M \) is **irreducible** if and only if \( \pi \) is a unit and whenever \( \pi= \alpha \beta \) then either \( \alpha \) or \( \beta \) is a unit.
- \( \pi \in M \) is **prime** whenever \( \pi\divides \alpha \beta \) then \( \pi\divides \alpha \) or \( \pi\divides \beta \).
- \( \delta \in M \) is a greatest common divisor of \( \alpha, \beta \) if and only if \( \delta \) is a common divisor that is divisible by every other common divisor.
- $M$ is a **unique factorization monoid** if and only if every nonunit element in $M$ factors uniquely as a product of irreducibles (uniqueness up to order and associates).

:::



:::{.remark}
Given $R$ an integral domain, then $R\smz$ with multiplication is a cancellative monoid.
Moreover, $R\smz$ is a unique factorization monoid if and only if $R$ is a UFD.
:::


:::{.question}
How do you show something is a UFD?
:::

How does this proof go for $\ZZ$?

- Use existence of a division algorithm
- Prove Euclid's lemma: every irreducible is prime
- Use factorization into irreducibles and proceed by induction (writing out two factorizations and cancelling things out in a combinatorial way)

So we'd like

1. To know that irreducibles are prime, and
2. Everything to factor into irreducibles.



:::{.definition title="Atomic"}
For $M$ a cancellative monoid, $M$ is **atomic** if every nonunit element of $M$ is a product of irreducibles.
:::


:::{.proposition title="?"}
Let $M$ be a cancellative monoid, then $M$ is a UFM if and only if $M$ is atomic and every irreducible is prime in $M$.
:::


:::{.proof title="?"}
Omitted -- no new ideas when compared to proof of unique factorization in $\ZZ$.
:::

Note that in $\ZZ$, working in $\ZZ_{\geq 0}$ is useful because the only positive unit is $1$, and so any elements differing by a unit are in fact equal.
Can we emulate this for cancellative monoids?
The answer is yes, by modding out by the equivalence relation of being equivalent up to a unit.

:::{.definition title="Reduced Monoid"}
Define $M_{\red}\da M/\sim$ where $a\sim b \iff a-b\in M\units$.
The operation on $M$ descends to well-defined operation on $M_{\red}$, and irreducibles and primes are the same in $M$ and $M_{\red}$.
:::


:::{.example title="?"}
This is supposed to look like $\ZZ_{\geq 0}$, where $-7\in M \mapsto 7 \in M_{\red}$. 
:::


:::{.proposition title="?"}
$M$ is a UFM if and only if $M_{\red}$ is a UFM if and only if every element of $M_{\red}$ factors uniquely as a product of irreducibles, up to order.
:::

What did this buy us? We didn't have to worry about associates in the above statement, and the only unit is 1.


:::{.question}
Why isn't $\ZZ[ \sqrt{-5} ]$ is UFD?
:::


:::{.answer}
It doesn't have enough elements to make unique factorization work!
:::


:::{.example title="?"}
In $\ZZ^+$, write $210 = 21\cdot 10 = 14 \cdot 15$.
These two factorizations differ but admit a common refinement to $(7\cdot 3)(2\cdot 5) = (7\cdot 2)(3\cdot 5)$, where it becomes clear that these factorizations are equal up to ordering.
This is **Euler's Four Number Theorem**, which turns out to be equivalent to unique factorization.
:::


:::{.theorem title="?"}
Let $M$ be a cancellative atomic reduced monoid.
Then $M$ is a UFM if and only if whenever \( \alpha, \beta, \gamma, \delta \in M \) such that \( \alpha \beta = \gamma \delta \), there are \( \rho, \sigma, \tau, \nu \) with 
\[
\alpha &= \rho \sigma \\
\beta &= \tau \nu \\
\gamma &= \rho \tau \\
\delta &= \sigma \nu
.\]

Note that plugging these in on the LHS and RHS respectively yield the same factors, just reordered.

:::


:::{.proof title="?"}
Omitted, exercise in chasing definitions.
The interesting part is that you can go backward!
:::

Let $M_{\red} \da \qty{\ZZ[ \sqrt{5} ] \smz}_{\red}$, motivated by the fact that $\ZZ[ \sqrt{-5} ]$ is not a UFD if $\ZZ[ \sqrt{-5} ] \smz$ is not a UFM, or equivalently its reduction is not a UFM.
Then $M$ is a not a UFM.
Noting that $M$ is reduced under an equivalence relation, write $\gens{ \alpha}$ for the class of \( \alpha \) in $M$ for any \( \alpha\in \ZZ[ \sqrt{-5} ] \).

Our original counterexample for unique factorization now reads
\[
\gens{ 1 + \sqrt{-5} } \gens{ 1 - \sqrt{5} } = \gens{2} \gens{3}
.\]
This is still a counterexample since these pairs admit no common refinement.

Why are there "not enough elements" in $\ZZ[ \sqrt{-5} ]$?
Recall that for integral domains (as rings), two elements differ by a unit precisely when they generate the same ideal.
So we can think of elements of $M_{\red}$ as nonzero principal ideals of $M$, which we'll write as $\Prin( \ZZ [ \sqrt{-5} ])$.
To make this set of ideals into a monoid, one define \( \gens{ \alpha } \gens{ \beta }= \gens{ \alpha \beta }    \), where it's easy to check that this is well-defined.
So the failure of unique factorization is a failure of factorization in this set of ideals.
We can embed this in a larger collection of ideals by just deleting the word "principal", which will restore unique factorization.


:::{.definition title="Multiplication of Ideals"}
Let $R$ be a commutative ring (always with 1).
If $I, J \normal R$ are ideals, we define 
\[
IJ \da \gens{ \ts{ \alpha_i \beta_i \st \alpha_i \in I, \beta_i \in J }} = \ts{ \sum \alpha_i \beta_i \st \alpha_i \in I, \beta_i \in J}
.\]

If $R$ is a domain, define the monoid $\Id(R)$ the collection of nonzero ideals of $R$ with the above multiplication.
:::


:::{.remark}
Note that the naive definition $IJ \da \ts{ij\st i\in I, j\in J}$ is not necessarily an ideal, since it may not be closed under addition.
Taking the smallest ideal containing all products fixes this.
:::


:::{.proposition title="?"}
Let $R$ be a commutative ring.
Then

- $\cdot$ for ideals is commutative
- $\cdot$ for ideals is associative
- The identity is \( \gens{ 1 }= R  \).
- Multiplication distributes over addition of ideals, i.e. $I(J+K) = IJ + IK$.
- $IJ \subseteq I \intersect J$.
- If \( I = \gens{ \alpha_1, \cdots, \alpha_j }  \) and \( J = \gens{ \beta_1, \cdots, \beta_k }  \) then \( IJ = \gens{ \alpha_1 \beta_1, \cdots, \alpha_j \beta_k }  \) is generated by all of the $jk$ pairwise products.
- If $R$ is a domain and $I, J$ are nonzero then $IJ$ is nonzero.

As a consequence, $\Id(R)$ is a monoid when $R$ is a domain.
:::

So instead of working in $\Prin( \ZZ [\sqrt{-5} ])$, we'll work in $\Id(\ZZ [\sqrt{-5} ])$.

:::{.claim}
We can refine our bad factorizations.
:::


Define

- \( I\da \gens{ 1 + \sqrt{-5} , 2 }  \) 
- \( I'\da \gens{ 1 - \sqrt{-5} , 2 }  \) 
- \( J\da \gens{ 1 + \sqrt{-5} , 3 }  \) 
- \( J'\da \gens{ 1 - \sqrt{-5} , 3 }  \) 

Then 

- \( IJ = \gens{ 1 + \sqrt{-5} }  \)  
- \( I'J' = \gens{ 1 - \sqrt{-5} }  \)  
- \( JJ' = \gens{ 3 }  \) 
- \( II' = \gens{ 2 }  \) 


We can then write
\[
\gens{ 1 + \sqrt{-5} } \gens{ 1 - \sqrt{-5} } = \gens{ 2 } \gens{ 3 } \implies (IJ)(I'J') = (II')(JJ')    
,\]
where the same terms are occurring in a different order.

For an example of how to work these out, let's compute $IJ$.
We get 
\[
IJ 
&= \gens{ (1 + \sqrt{-5} )^2, 3(1 + \sqrt{-5} ), 2(1 + \sqrt{-5} ), 6 }  \\
&= \gens{ 1 + \sqrt{-5} } \gens{ 1 + \sqrt{-5} , 3, 2, 1 - \sqrt{-5} } \\  
&= \gens{ 1 + \sqrt{-5} } \gens{ 1 }  \\
&= \gens{ 1 + \sqrt{-5} }
,\]
using the fact that $3-2=1$ is in the ideal on the second line.

We'll see later that this process allows you to recover unique factorization in $\ZZ_K$ for any number field $K$.



















# Ch. 5: Euclidean Quadratic Fields (Thursday, January 28)


:::{.remark}
In a first algebra course, one process that if $R$ is a Euclidean domain, then the arithmetic of $R$ is very interesting:

- $R$ is a PID, and as a consequence
- $R$ is a UFD

:::

:::{.definition title="Euclidean Domain"}
A domain $R$ is **Euclidean** if and only if there is a function $\varphi R\smz \to \ZZ^{\geq 0}$ such that for all $a,b\in R$ with $b\neq 0$ there are $q, r\in R$ with $a = bq + r$ with $r=0$ or \( \varphi(r) < \varphi(b) \).
\( \varphi \) is referred to as a **Euclidean function**.
:::

:::{.example title="Examples of Euclidean functions"}
\envlist

- For $R=\ZZ$, one can take \( \varphi(\wait) \da \abs{\wait} \).
- $R = F[t]$ for $F$ a field with \( \varphi(\wait) = \deg(\wait) \).
:::

:::{.remark}
Given a number field $K$, does $\ZZ_K$ have nice factorization, i.e. is it a UFD?
Not always, as we saw last time.
If it were Euclidean, then yes!
:::

:::{.question}
Which quadratic fields $K$ have $Z_K$ Euclidean?
:::

:::{.definition title="Euclidean and Norm-Euclidean Number Fields"}
If $K$ is a quadratic field, then 

- $K$ is **Euclidean** if and only if $\ZZ_K$ is a Euclidean domain,

- $K$ is **norm-Euclidean** if and only if $\ZZ_K$ is Euclidean with respect to \( \varphi(\wait) \da \abs{N(\wait)} \).

:::

:::{.proposition title="Characterization of norm-Euclidean quadratic fields"}
Let $K$ be a quadratic field.
Then $K$ is norm-Euclidean if and only if for all \( \beta\in K \) there is a \( \gamma\in \ZZ_K \) such that \( \abs{ N(\beta- \gamma) } < 1 \).
In other words, $K$ is norm-Euclidean if and only if  every element can be approximated by an element in $\ZZ_K$.
:::

:::{.proof title="?"}
$\impliedby$:
Let \( a,b \in \ZZ_k \) with \( b\neq 0 \).
Define \( \beta\da a/b \in K \), then by assumption choose \( \gamma \) such that \( \abs{N({a\over b} - \gamma}< 1  \).
Multiplying both sides by \( N(b) \) and using the fact that $N(\wait), \abs{\wait}$ are multiplicative, we have 
\[
\abs{N(a - b \gamma)} < \abs{N(b)} 
.\]
Then $a = bq + r \da b \gamma + (a - b \gamma)$.
:::

## Norm-Euclidean Imaginary Quadratic Fields

:::{.remark}
Suppose $K = \QQ( \sqrt{d} )$ with $d<0$ squarefree, so we can write
\[
K = \ts{ a + b \sqrt{d} \st a,b, \in \QQ }
K = \ts{ a + b i\sqrt{\abs{d}} \st a,b, \in \QQ } \subseteq \CC
.\]
Geometrically, this is a dense subset of $\CC$, so it's not easy to draw.
But we can draw $\ZZ_K$ -- what does it look like?
We know that $d=2,3 \mod 4$ then $\ZZ_K = \ts{a + b \sqrt{d} \st a,b,\in \ZZ}$:

\begin{tikzpicture}
    \draw [thick, gray,-latex] (-5, 0) -- (7, 0);% Draw x axis
    \draw [thick, gray,-latex] (0, -5) -- (0, 5);% Draw y axis

    \clip (-5,-5) rectangle (10cm,10cm); % Clips the picture...
    %\pgftransformcm{1}{0.6}{0.7}{1}{\pgfpoint{0cm}{0cm}}
          % This is actually the transformation matrix entries that
          % gives the slanted unit vectors. 
    \draw[style=help lines,dashed] (-14,-14) grid[step=2cm] (6,5);
          % Draws a grid in the new coordinates.
          %\filldraw[fill=gray, fill opacity=0.3, draw=black] (0,0) rectangle (2,2);
              % Puts the shaded rectangle
    \foreach \x in {--3,-2,-1,0,1,2}{% Two indices running over each
      \foreach \y in {-2,-1, ..., 2}{% node on the grid we have drawn 
        \node[draw,circle,inner sep=2pt,fill] at (2*\x,2*\y) {};
            % Places a dot at those points
      }
    }
        \node[draw,red, circle,inner sep=2pt,fill] at (0, 0) {};

	\draw [decorate,decoration={brace,amplitude=10pt},xshift=-4pt,yshift=0pt] (6.5,2.0) -- (6.5,0.1) node [black,midway,xshift=25pt] {\footnotesize $\sqrt{\abs{d}}$};
	\draw [decorate,decoration={brace,amplitude=10pt},xshift=-4pt,yshift=0pt] (6.5,-0.1) -- (6.5,-2) node [black,midway,xshift=25pt] {\footnotesize $\sqrt{\abs{d}}$};

\end{tikzpicture}

When $d \equiv 1 \mod 4$, we have $\ZZ_k = \ts{ {1\over 2}(a + b \sqrt{d} ) \st a,b,\in \ZZ,\, a\equiv b \mod 2}$.
On the real axis, if $b=0$ then $a$ is an even integer and $\ts{(1/2)a}$ is all integers.
To get the remaining elements, we don't just shift up and down: setting $b=1$ yields elements that look like $(1/2)a + \sqrt{d}$ where $a$ is odd, so we get the following:

\begin{tikzpicture}
    \draw [thick, gray,-latex] (-5, 0) -- (7, 0);% Draw x axis
    \draw [thick, gray,-latex] (0, -5) -- (0, 5);% Draw y axis

    \clip (-5,-5) rectangle (10cm,10cm); % Clips the picture...
    %\pgftransformcm{1}{0.6}{0.7}{1}{\pgfpoint{0cm}{0cm}}
          % This is actually the transformation matrix entries that
          % gives the slanted unit vectors. 
    \draw[style=help lines,dashed] (-14,-14) grid[step=2cm] (6,5);
          % Draws a grid in the new coordinates.
          %\filldraw[fill=gray, fill opacity=0.3, draw=black] (0,0) rectangle (2,2);
              % Puts the shaded rectangle
    \foreach \x in {--3,-2,-1,0,1,2}{% Two indices running over each
      \foreach \y in {-2,-1, ..., 2}{% node on the grid we have drawn 
        \node[draw,circle,inner sep=2pt,fill] at (2*\x,2*\y) {};
            % Places a dot at those points
      }
    }
\foreach \x in {--2,-3,-1,0,1,2,-2}{% Two indices running over each
      \foreach \y in {-2,-1, ..., 2}{% node on the grid we have drawn 
        \node[draw, circle,inner sep=2pt,fill] at (2*\x+1,2*\y+1) {};
            % Places a dot at those points
      }
    }
        \node[draw,red, circle,inner sep=2pt,fill] at (0, 0) {};

	\draw [decorate,decoration={brace,amplitude=10pt},xshift=-4pt,yshift=0pt] (6.5,1.0) -- (6.5,0.1) node [black,midway,xshift=25pt] {\footnotesize ${1\over 2} \sqrt{\abs{d}}$};
	\draw [decorate,decoration={brace,amplitude=10pt},xshift=-4pt,yshift=0pt] (6.5,-0.1) -- (6.5,-1) node [black,midway,xshift=25pt] {\footnotesize ${1\over 2} \sqrt{\abs{d}}$};
\draw [decorate,decoration={brace,amplitude=10pt},xshift=-4pt,yshift=0pt] (6.5,1.95) -- (6.5,1.05) node [black,midway,xshift=25pt] {\footnotesize ${1\over 2} \sqrt{\abs{d}}$};

\end{tikzpicture}

Now we can think of the criterion for an imaginary quadratic field to be norm-Euclidean: what does it mean to be within norm 1 of an element of $\ZZ_K$?
If $z\in K$, we can write $N(z) = z \bar z = \abs{z}^2$, and thus reformulate our criterion: $K$ is norm-Euclidean if and only if for all \( \beta\in K \) there exists a \( \gamma\in \ZZ_K \) such that \( \abs{\beta- \gamma}<1  \).
Note this this is the familiar geometric distance in $\CC$.

:::


:::{.example title="?"}
$\QQ(i)$ is norm-Euclidean: the ring of integers is $\ZZ(i)$, which is the integer lattice in $\CC$.
Note one can cover $\CC$ by open circles of radius 1:

\begin{tikzpicture}
    \draw [thick, gray,-latex] (-5, 0) -- (7, 0);% Draw x axis
    \draw [thick, gray,-latex] (0, -5) -- (0, 5);% Draw y axis

    \clip (-5,-5) rectangle (10cm,10cm); % Clips the picture...
    %\pgftransformcm{1}{0.6}{0.7}{1}{\pgfpoint{0cm}{0cm}}
          % This is actually the transformation matrix entries that
          % gives the slanted unit vectors. 
    \draw[style=help lines,dashed] (-14,-14) grid[step=2cm] (6,5);
          % Draws a grid in the new coordinates.
          %\filldraw[fill=gray, fill opacity=0.3, draw=black] (0,0) rectangle (2,2);
              % Puts the shaded rectangle
    \foreach \x in {--3,-2,-1,0,1,2}{% Two indices running over each
      \foreach \y in {-2,-1, ..., 2}{% node on the grid we have drawn 
        \node[draw,circle,inner sep=2pt,fill] at (2*\x,2*\y) {};
            % Places a dot at those points
      }
    }
        \node[draw,red, circle,inner sep=2pt,fill] at (0, 0) {};

\filldraw[dotted, fill=blue!50, draw=blue, very thick, fill opacity=0.2] (2,0) circle (2cm);
\filldraw[dotted, fill=blue!50, draw=blue, very thick, fill opacity=0.2] (0,0) circle (2cm);
\filldraw[dotted, fill=blue!50, draw=blue, very thick, fill opacity=0.2] (-2,0) circle (2cm);
\node at (5, 1) {$\cdots$};
\end{tikzpicture}


Continuing this way, every point with rational coordinates can be covered by some open disc of radius 1:

\begin{tikzpicture}
    \draw [thick, gray,-latex] (-5, 0) -- (7, 0);% Draw x axis
    \draw [thick, gray,-latex] (0, -5) -- (0, 5);% Draw y axis

    \clip (-5,-5) rectangle (10cm,10cm); % Clips the picture...
    %\pgftransformcm{1}{0.6}{0.7}{1}{\pgfpoint{0cm}{0cm}}
          % This is actually the transformation matrix entries that
          % gives the slanted unit vectors. 
    \draw[style=help lines,dashed] (-14,-14) grid[step=2cm] (6,5);
          % Draws a grid in the new coordinates.
          %\filldraw[fill=gray, fill opacity=0.3, draw=black] (0,0) rectangle (2,2);
              % Puts the shaded rectangle
    \foreach \x in {--3,-2,-1,0,1,2}{% Two indices running over each
      \foreach \y in {-2,-1, ..., 2}{% node on the grid we have drawn 
        \node[draw,circle,inner sep=2pt,fill] at (2*\x,2*\y) {};
\filldraw[dotted, fill=blue!50, draw=blue, very thick, fill opacity=0.2] (2*\x,2*\y) circle (2cm);

            % Places a dot at those points
      }
    }
        \node[draw,red, circle,inner sep=2pt,fill] at (0, 0) {};


\node at (5, 1) {$\cdots$};
\end{tikzpicture}

:::


:::{.remark}
Note that this doesn't work for arbitrary $d$, since the distance between the horizontal lines grows with $d$.
It's not hard to work out the exact list where everything *is* covered:

:::

:::{.theorem title="?"}
$K$ is norm-Euclidean if and only if $d\in \ts{-1,-2,-3,-7,-11}$.
:::

:::{.corollary title="?"}
For these $d$, $\ZZ_K$ is a PID and thus a UFD.
:::

:::{.remark}
So we've classified all norm-Euclidean imaginary quadratic fields.
What about removing the word "norm"?
We restricted to $\abs{N(\wait)}$ because there was a particularly nice geometric interpretation, whereas being Euclidean involves a mysterious \( \varphi \).
Remarkably, it can be done, and it's the same list!


:::

:::{.theorem title="Motzkin"}
For $K$ an imaginary quadratic field, $K$ is Euclidean if and only if $d\in \ts{-1,-2,-3,-7,-11}$.
:::

:::{.remark}
If $\ZZ_K$ were never a PID in these cases, we could immediately conclude it wasn't Euclidean either. 
But there are values of $d$ not on this list for which $\ZZ_K$ is a PID, e.g. $d=-19$.
Since $-19 \equiv 1 \mod 4$, one can write $\ZZ_K = \ZZ\left[ {1 + \sqrt{-19} \over 2}\right]$, and by Motzkin's theorem this is a PID which is not a Euclidean domain.
:::

We'll prove this theorem!
First we need a few lemmas.

:::{.lemma title="?"}
Let $K$ be an imaginary quadratic field, then $U(\ZZ_K) = \ts{\pm 1 }$ except if $d=-1, -3$.
:::

:::{.proof title="of lemma (Important!)"}
We know that the units $u$ satisfy $\abs{N(u)} = 1$, and for imaginary quadratic fields norms are non-negative, so we know $N(u) = 1$.
What are the solutions this equation?
Suppose $d=2,3 \mod 4$, then we can write \( \alpha = a + b \sqrt{d} \)  with \( a,b\in \ZZ \) and \( 1 = N \alpha = a^2 - db^2 = a^2 + \abs{d}b^2  \).
If \( \abs{d}= 1  \) then this will have four solutions: $(a, b) = (\pm 1, 0), (0, \pm 1)$.
Otherwise if \( \abs{d}> 1  \) then $b=0$ and $a^2=1 \implies a = \pm 1$ and thus  \( \alpha = \pm 1 \).
So in this case, the only units are $\pm 1$, unless \( \abs{d} = 1 \).
But the only negative squarefree integer of absolute value 1 is $-1$.

Suppose $d \equiv 1 \mod 4$.
In this case, we need 
\[
1 = {a^2 + \abs{d} b^2 \over 4} \implies a^2 + \abs{d}b^2 = 4  
.\]
Note that $d<0$ is $1\mod 4$, so it's possible that $d=-3$ -- but this was one of the exceptions in the theorem, so assume otherwise.
Thus \( \abs{d}\geq 7  \), which forces $b=0 \implies a^2 = 4 \implies a = \pm 2$.
Then \( \alpha= \pm 1 \).
:::

:::{.remark}
For the excluded cases, the units can be explicitly computed.
When $d=-1$, $U(\ZZ[i]) =\ts{\pm 1, \pm i}$, yielding 4 units.
When $d=-3$, 
\[
U\qty{\ZZ\left[ {1 + \sqrt{-3} \over 2 } \right]} = \ts{\pm 1, {\pm 1 \pm \sqrt{-3} \over 2}}
,\]
yielding 6 units.
Note that in the first case, these are exactly the 4th roots of unity, and in the second case these are the sixth roots.
This is a general phenomenon that will appear again!
:::

:::{.lemma title="?"}
Let $K$ be any quadratic field and \( \alpha\in \ZZ_K \).
Then \( \# \ZZ_k / \gens{ \alpha } = \abs{N( \alpha )}   \).
:::

## Proof of Motzkin's Theorem

:::{.proof title="of Motzkin's Theorem"}
We want to show that being Euclidean implies $d=-1,-2,-3,-7,-11$.
Suppose $\ZZ_K$ is Euclidean with respect to \( \varphi \).
Choose \( \beta\in \ZZ_K \) nonzero and not a unit with \( \varphi(\beta) \) minimal among all such \( \beta \).

:::{.claim}
\[
\# \ZZ_K / \gens{ \beta } \leq 3 
.\]
:::

:::{.proof title="of claim"}
For any \( \alpha\in \ZZ_K \) and consider it in the quotient.
Since $\ZZ_K$ is Euclidean, we can write \( \alpha = \beta + \gamma+ \rho \) where either \( \rho=0 \) or \( \varphi(\rho ) < \varphi (\beta ) \).
How can the second possibility occur?
\( \beta \)  was chosen to have a minimal \( \varphi \) value, so the only smaller elements are units.
So \( \rho = 0 \) or \( \rho \)  is a unit.
Reducing $\mod \beta$, we obtain \( \alpha= \rho \mod \beta \), and hence \( \# \ZZ_K / \gens{ \beta }  \leq 1 + \# U(\ZZ_K) \) where the 1 comes from the zero element and everything else in the quotient has a representative that is a unit.
This is bounded above by $3$ when $d\neq -1, -3$, which is one of the exclusions in the theorem.
:::

Now we have \( N( \beta) \leq 3 \) and this can be solved -- if $d$ is large, these solutions are widely distributed.
If $d = 2, 3 \mod 4$ then \( \beta= a + b \sqrt{d} \)  with \( a, b \in ZZ \) and \( a^2 + \abs{d}b^2 \leq 3  \).
We can assume \( \abs{d}> 3  \), since $d=-1, -2$ are excluded.
Then $b=0$ is forced, and $a = 0, \pm 1$.
But why can't \( \beta=0, \pm 1 \)?
It was chosen to be minimal among *nonzero nonunits*.
$\contradiction$

If $d \equiv 1 \mod 4$, then \( \beta= {a + b \sqrt{d} \over 2} \) where $a,b\in \ZZ,\, a\equiv b \mod 2$.
Then 
\[
{a^2 + \abs{d}b^2 \over 4} \leq 3 \implies a^2 + \abs{d}b^2 \leq 12  
.\]
Now considering that $-d\equiv 1 \mod 4 \implies -d \in \ts{ -3, -7, -11, \cdots}$, the first three of which are on our list of exclusions.
So we can assume \( \abs{d}\geq 15  \), which forces $b=0$, $a$ must be even, and $a^2 \leq 12$.
So $a=0, \pm 2 \implies \beta= 0, \pm 1$.
$\contradiction$

:::

:::{.remark}
What's the story for real quadratic fields?
We understand norm-Euclidean ones, although the proofs aren't nearly as simple.
Things worked out nicely here because we had circles in the plane; in the real case these end up being complicated hyperbolas.
One can prove that if $d > 73$ then $K \da \QQ(\sqrt d)$ is not norm-Euclidean.
What are the Euclidean real quadratic fields?
The situation is much different, and there are two open conjectures.
:::

:::{.conjecture}
For real quadratic fields $K$, $\ZZ_K$ is a PID for infinitely many $d> 0$.
We don't even know about to prove there are just infinitely many *number* fields satisfying this condition!
We believe this is true since it happens a positive proportion of the time experimentally.
:::

:::{.conjecture}
If $\ZZ_K$ is a PID, then $\ZZ_K$ is Euclidean with respect to some norm function.
This is a consequence of a certain generalization of the RH.
This is not true for imaginary quadratic fields.
Why is it different here?
The unit group plays a large role, and is infinite here.
The real conjecture is that for $K$ any number field, if $\ZZ_K$ is a PID with infinitely many units then $\ZZ_K$ is Euclidean.
:::

:::{.remark}
There has been some progress, a result along the lines of there being at most two exceptions, but we don't know if those exceptions exist.
:::















# Ch. 6: Ideal Theory and Quadratic Fields (Tuesday, February 02)

Recall that if $R$ is a domain, we defined $\Id(R)$ as the set of nonzero ideals of $R$, which is a monoid.
We want to get to the following theorem:


:::{.theorem title="Fundamental Theorem of Ideal Theory (for Quadratic Fields)"}
Let $K$ be a quadratic field, then $\Id(\ZZ_K)$ is a UFM.
:::


:::{.remark}
This means that everything factors into irreducibles, and when you have unique factorization, irreducible is the same as prime.
Note that "prime" here means in this monoidal sense -- does this match up with the existing notion of a prime ideal? 
I.e. that \( \mathfrak{p}  \) is prime if and only if \( R/ \mathfrak{p}  \) is a domain, or $ab\in \mathfrak{p}\implies a,b \in \mathfrak{p}$? 
:::


:::{.proposition title="?"}
"Prime" in the usual ring-theoretic sense is equivalent to "prime" in the monoidal sense for $\Id(\ZZ_K)$.
:::


:::{.remark}
Recall though that $\Id(\ZZ_K)$ is a reduced monoid, so the only unit is the identity, so uniqueness is just up to ordering and doesn't involve additional units.
We can restart the unique factorization theorem:
:::

:::{.proposition title="?"}
Every nonzero ideal of $\ZZ_K$ factors uniquely as a product of prime ideals in $\ZZ_K$.
:::

Can we explicitly understand what ideals of $\ZZ_K$ look like for quadratic fields?

:::{.definition title="Standard Bases of Ideals"}
Let $K = \QQ(\sqrt{d})$, so $\ZZ_K = \ZZ[\sqrt d]$ if $d=2,3 \mod 4$ or $\ZZ\left[ {1 + \sqrt{d} \over 2} \right]$ if $d=1 \mod 4$.
Define $\tau = \sqrt{d}$ or $(1 + \sqrt{d}) /2$ accordingly and write $\ZZ_k = \ZZ[\tau]$.
:::


:::{.remark}
Note that \( \ts{ 1, \tau } \)  is a \( \ZZ\dash \)basis of $\ZZ_K$.
An ideal of $\ZZ_K$ is a submodule as a $\ZZ\dash$module, which is free, so any ideal is free of rank at most 2.
Can we write down such a basis?
:::


:::{.lemma title="?"}
Let $I$ be a nonzero ideal of $\ZZ_K$, then $I$ contains a nonzero integer and an element of the form $a + b \tau$ where $b\neq 0$.
:::


:::{.proof title="of lemma"}
How to produce a nonzero rational integer: let \( \alpha\in I \) be nonzero and take the norm.
Then \( N \alpha \) is a nonzero integer, and since \( \bar{\alpha}\in \ZZ_K \) we have \( N \alpha = \alpha \bar{ \alpha} \in I \).
Now since \( \tau\in \ZZ_K \) and $I$ absorbs multiplication we can set $b \da N \alpha(\tau) \in I$.
:::

We wanted a nice description of bases for ideals -- here it is!

:::{.proposition title="Constructing a standard basis for an ideal"}
Let $I \normal \ZZ_K$ be a nonzero ideal. 
Choose $n\in \ZZ^+$ such that $I \intersect\ZZ = n\ZZ$.[^why_intersect_z]
Choosing \( B \in \ZZ^+ \) such that \( \ts{ b\in \ZZ \st a + b \tau\in I \text{ for some } a \in \ZZ} = B\ZZ \).[^why_B_exists]
Since $B$ is in the LHS, pick $A\in \ZZ$ with $A + B\tau \in I$.
Then $\ts{n, A+B\tau}$ is a $\ZZ\dash$basis for $I$.
Any such basis is referred to as a **standard basis** for $I$

[^why_B_exists]: 
The LHS is the set of coefficients of \( \tau \), which is an ideal of $\ZZ$, and we can take it to be positive since the LHS is not the zero ideal by the lemma.



[^why_intersect_z]: 
Why does this $n$ exist?
Every ideal in $\ZZ$ is of the form $n\ZZ$, and it's easy to check $I \intersect\ZZ$ is an ideal in $\ZZ$ since its an ideal of $\ZZ_K$ intersected with $\ZZ$.
How do we know it's not the zero ideal?
This is exactly given by the last lemma.

:::

:::{.remark}
Note that this is only determined up to $A \mod n$.
:::

:::{.proof title="?"}
Take any element in $I$, which can be represented as \( a + b \tau \), we want to show that this can be expressed in terms of the proposed basis.
Note that $B\divides b$ by its definition, since $B$ generated the ideal of \( \tau \) coefficients.
So write \( b = Bs \), then
\[
( a + b \tau) - (A + b \tau)s \in \ZZ \intersect I = \gens{ n } 
.\]
So write this difference as $nr$ for some $r\in \ZZ$, then rearranging yields
\[
a + b \tau = nr + (A + B \tau)s
,\]
which is a $\ZZ\dash$linear combination of the standard basis elements.
Uniqueness is easy and follows from the fact that every element in $\ZZ_K$ has a unique representation in terms of $1, \tau$.
:::

## Ideal Norms

In the previous section, we used the fact that for $a\in \ZZ_k$, the number of elements in $\ZZ_K / \gens{ n }$ is $\abs{ N a }$. 
That will be a consequence of the theory we develop here.

:::{.definition title="?"}
If $I\normal \ZZ_K$ is a nonzero ideal, define the **norm of $I$** as $N(I) = \abs{\ZZ_K / I}$. 
:::

:::{.remark}
It's not completely obvious, but this quotient is always finite.
We can use the fact that $I\leq \ZZ_K$ is a $\ZZ\dash$submodule of rank exactly 2.
It's then a general fact from algebra that $A/B$ is finite when $\rank(A) = \rank(B)$, and there are ways of figuring out the number of elements (see normal forms).
:::

:::{.proposition title="?"}
Suppose that $I\normal \ZZ_K$ is a nonzero ideal and let $n, A+B \tau$ be a standard basis for $I$.
Then $N(I) = nB \in \ZZ^+$.
:::

:::{.proof title="?"}
Check that $\ts{ a + b \tau \st 0\leq a \leq n,\, 0 \leq b \leq B}$ is a complete and irredundant set of representatives for $\ZZ_K/I$.
:::


:::{.remark}
So given a standard basis, it's easy to compute norms!
What does this have to do with the previous notion of norms for elements?
:::


:::{.theorem title="?"}
Let $I \normal \ZZ_K$ be nonzero and define $\bar{I} = \ts{ \bar\alpha \st \alpha \in I } \normal \ZZ_K$.
Then $I \bar I = \gens{ N(I) }$. 
:::


:::{.lemma title="?"}
Let $n, A + B \tau$ be a standard basis for $I$. 
Then $B\divides n$ and $B\divides A$.
:::


:::{.proof title="of lemma"}
Recall that $B$ was a generator for \( \tau \) components of elements of $I$, so we just need to find an element of $I$ with \( \tau \) component $n$, and \( n \tau \in I \) works.

Now compute $(A + B \tau) \tau\in I$.
This is equal to
\[
A \tau + B \tau^2
.\]
Note that this could in principle be done in cases: if $\tau = \sqrt{d}$, $Bd$ would be an integer and $A$ would be the \( \tau \) coordinate. 
Then since $B$ divides every \( \tau \) coefficient, we'd be done.
But let's try this in a more unified way: we know \( \tau \) is a root of a monic degree 2 polynomial, namely \( (x - \tau) (x - \bar{\tau}) = x^2 - \Tr( \tau)x + N( \tau) \), and thus we can write 
\[
\tau^2 = \Tr( \tau) \tau - N( \tau)
.\]
Substituting yields 
\[
(A + B \tau) \tau
&= A \tau + B \tau^2 \\
&= A \tau + B ( \Tr( \tau) \tau - N( \tau) ) \\
&= - B N( \tau) + (A + B \Tr( \tau ) ) \tau
.\]
The coefficient of \( \tau \) must be a multiple of $B$, which forces $B\divides A$.
:::


:::{.proof title="of theorem"}
Let $n, A + B \tau$ be a standard basis for $I$. 
Then $I = \gens{ n, A+ B \tau }$, which is a generating set as a $\ZZ_K\dash$module since they generate $I$ over $\ZZ$ and subset containment both ways can be readily checked.
We can then write $\bar{I} = \gens{ n, A+B \bar \tau }$, since conjugating ordinary integers doesn't change them.
Using the lemma, we can write 
\[
I &= \gens{ Bn', BA' + B \tau }\\
\bar{I} &= \gens{ Bn', BA' + B \bar{\tau} }
.\]

We can factor out a $B$ to get 
\[
I &= \gens{ B } \gens{ n', A' + \tau} \\  
\bar{I} &= \gens{ B } \gens{ n', A' + \bar{\tau} } 
.\]

Now multiplying the two yields
\[
I \bar{I} = \gens{ B^2 } \gens{ (n')^2, n'(A' + \bar{ \tau} ), n'(A' + \tau), N(A' + \tau) }  
.\]
It's tempting to factor out $n'$, but it isn't obviously in the last factor.
But it is!
Note that $N(A' + \tau) \in \gens{ A' + \tau, n' }$ and thus \( B N(A' + gt) \in \gens{ B } \gens{ A' + \tau, n' } = I   \). 
But the first expression is an ordinary integer, i.e. in $I \intersect\ZZ = \gens{ n }$ and thus a multiple of $n$.
So $Bn' = n \divides BN(A' + \tau)$, and thus $n' \divides N(A' + \tau)$.
So we can rewrite 
\[
I \bar{I} 
&= \gens{ B^2 } \gens{ n' } \gens{ n', A' + \bar{ \tau} , A' + \tau, { N(A' + \tau) \over n'} }   \\
&= \gens{ B^2 n' } 
\gens{ n', A' + \bar{ \tau} , A' + \tau, { N(A' + \tau) \over  n'} }   
.\]

We can now note that $B^2 n' = B^2(n/B) = nB = N(I)$.
We've thus shown that 
\[
I \bar{I} 
= \gens{ N(I) } 
\gens{ n', A' + \bar{ \tau} , A' + \tau, { N(A' + \tau) \over  n'} }   
.\]
We'd really like the second term to just be \( \gens{ 1 }  \).
Note that this factor contains some integers: $n', N(A' + \tau)/n'$, and $(A' + \bar \tau) + (A' + \tau) = \Tr(A' + \tau)$.
So let 
\[
J \da \gens{ n, N(A' + \tau)/n', \Tr(A' + \tau) } \normal \ZZ
,\] 
then it's enough to show $J = \gens{ 1 } \normal \ZZ$.
Why? 
If so, $1$ is a $\ZZ\dash$linear combination of these elements, but every $\ZZ\dash$linear combination is also a $\ZZ_K\dash$linear combination.
Every such combination will be in the original ideal appearing in $I \bar{I}$, which we want to show is the unit ideal.
We can write $J = d\ZZ$ where $d\in \ZZ^+$ and suppose toward a contradiction that $d>1$.
Consider \( \alpha \da (A' + \tau) / d \in K \).
Taking the trace is $\QQ\dash$linear, so $\Tr( \alpha) = (1/d) \Tr(A' + \tau) \in \ZZ$.
This follows because the trace $\Tr(A' + \tau)$ is in $J$, thus a multiple of $d$.
We can also compute \( N \alpha = N(A' + \tau) / d^2 \) using that $d\bar{d} = d^2$ since $d$ is rational.

The claim is that $N \alpha$ is also an integer: since $N(A' + \tau)/n', \Tr(A' + \tau)$ are in $J$, $d$ divides both.
So we know that $d^2 \divides (n') (N(A' + \tau) / n') = N(A' + \tau)$, which forces $N \alpha\in \ZZ$.
So we know $N \alpha, \Tr \alpha \in \ZZ$, which forces \( \alpha\in \ZZ_K \) since \( \alpha \) is a root of $x^2 - \Tr(\alpha) + N \alpha$.
But \( \alpha \) can't be in \( \ZZ_K \), since these consist only of $\ZZ\dash$linear combinations of $1, \tau$ -- however here the coefficient of \( \tau \) is $1/d \not \in \ZZ$, and thus \( \alpha = A'/d + (1/d) \tau \not\in \ZZ_K \).
:::


:::{.remark}
This is a long proof!
It's nice in that it's direct, but less nice in that it required some clever steps.
When we do the case for general number fields, we'll be able to use a more conceptual approach that avoids some of these computations.
Many other facts fall out of these theorem -- in fact, there are nice results as long as $I \bar I$ is a principal ideal.
:::






















